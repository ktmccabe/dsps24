<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Science for Political Science - 7&nbsp; Prediction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./08-Regression.html" rel="next">
<link href="./06-Loops.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./07-Prediction.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Prediction</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Data Science for Political Science</a> 
        <div class="sidebar-tools-main">
    <a href="./Data-Science-for-Political-Science.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Course Notes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-Description.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Description</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-CausalityI.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Causation with Experiments</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-Visualization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Visualization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-Causalityii.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Causality with Non-Experimental Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-Loops.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Loops in R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-Prediction.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Prediction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-Regression.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Prediction with Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-Fairness.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Fairness and Ethics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./10-Uncertainty.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Uncertainty</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./11-TextasData.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Text as Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./12-Maps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Mapping</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./13-ChooseYourOwnAdventure.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Choose Your Own Adventure</span></span></a>
  </div>
</li>
    </ul>
    </div>
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Section Contents</h2>
   
  <ul>
  <li><a href="#prediction-overview" id="toc-prediction-overview" class="nav-link active" data-scroll-target="#prediction-overview"><span class="header-section-number">7.1</span> Prediction Overview</a></li>
  <li><a href="#process-of-prediction" id="toc-process-of-prediction" class="nav-link" data-scroll-target="#process-of-prediction"><span class="header-section-number">7.2</span> Process of Prediction</a></li>
  <li><a href="#example-forecasting-2020-us-election-based-on-2016-results" id="toc-example-forecasting-2020-us-election-based-on-2016-results" class="nav-link" data-scroll-target="#example-forecasting-2020-us-election-based-on-2016-results"><span class="header-section-number">7.3</span> Example: Forecasting 2020 US Election based on 2016 Results</a>
  <ul>
  <li><a href="#choose-approach" id="toc-choose-approach" class="nav-link" data-scroll-target="#choose-approach"><span class="header-section-number">7.3.1</span> Choose Approach</a></li>
  <li><a href="#assess-accuracy" id="toc-assess-accuracy" class="nav-link" data-scroll-target="#assess-accuracy"><span class="header-section-number">7.3.2</span> Assess Accuracy</a></li>
  <li><a href="#iterate-to-improve-predictions" id="toc-iterate-to-improve-predictions" class="nav-link" data-scroll-target="#iterate-to-improve-predictions"><span class="header-section-number">7.3.3</span> Iterate to improve predictions</a></li>
  </ul></li>
  <li><a href="#example-using-polls-to-predict-the-2020-election-results" id="toc-example-using-polls-to-predict-the-2020-election-results" class="nav-link" data-scroll-target="#example-using-polls-to-predict-the-2020-election-results"><span class="header-section-number">7.4</span> Example: Using polls to predict the 2020 election results</a>
  <ul>
  <li><a href="#choose-an-approach-lets-analyze-some-polls" id="toc-choose-an-approach-lets-analyze-some-polls" class="nav-link" data-scroll-target="#choose-an-approach-lets-analyze-some-polls"><span class="header-section-number">7.4.1</span> Choose an approach: Let’s analyze some polls</a></li>
  <li><a href="#loop-through-all-states" id="toc-loop-through-all-states" class="nav-link" data-scroll-target="#loop-through-all-states"><span class="header-section-number">7.4.2</span> Loop through all states</a></li>
  <li><a href="#check-accuracy" id="toc-check-accuracy" class="nav-link" data-scroll-target="#check-accuracy"><span class="header-section-number">7.4.3</span> Check Accuracy</a>
  <ul class="collapse">
  <li><a href="#quantitative-measures-of-accuracy" id="toc-quantitative-measures-of-accuracy" class="nav-link" data-scroll-target="#quantitative-measures-of-accuracy"><span class="header-section-number">7.4.3.1</span> Quantitative Measures of Accuracy</a></li>
  <li><a href="#classification" id="toc-classification" class="nav-link" data-scroll-target="#classification"><span class="header-section-number">7.4.3.2</span> Classification</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="prediction" class="quarto-section-identifier"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Prediction</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>In this section, we move to our next social science goal</p>
<ul>
<li>Describe</li>
<li>Explain, evaluate, and recommend <span class="math inline">\(\rightarrow\)</span> Causality</li>
<li><strong><em>Predict</em></strong></li>
<li>Discover</li>
</ul>
<p>Most of the tools we have been working on thus far have focused on first describing our data and then conducting tests through different types of comparisons and visualizations, in order to assess a deductive hypothesis, explaining the relationship between two variables.</p>
<p>Now we turn to a different goal.</p>
<p>Recall the difference between Correlation vs.&nbsp;Causality using our graphic showing the popularity of <em>Duck Dynasty</em> in different parts of the country. In 2016, researchers at the <a href="https://www.nytimes.com/interactive/2016/12/26/upshot/duck-dynasty-vs-modern-family-television-maps.html">NY Times</a> noticed that areas in the country where the television show Duck Dynasty was popular also tended to support Donald Trump at higher rates.</p>
<p><img src="images/duckdynasty.png" class="img-fluid" style="width:70.0%"></p>
<p>For those used to working with the goal of explanation, shifting to prediction and classification may mean we need to shift what types of information we think is important.</p>
<ul>
<li>Correlation: Areas that watch Duck Dynasty are more likely to support Trump (degree to which two variables ``move together”)</li>
<li>Causality: Watching Duck Dynasty (vs.&nbsp;not watching) causes you to support Trump.</li>
</ul>
<p>If we were interested in the goal of explaining voting decisions (what causes someone to vote a certain way?), we might not care if someone watches the show. However, if we were just interested in predicting vote share or voting decisions, a strong correlation could still be useful. Without spending a single dollar on surveying a community, we might have a general sense of their support for a candidate.</p>
<section id="prediction-overview" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="prediction-overview"><span class="header-section-number">7.1</span> Prediction Overview</h2>
<p>Our goal: Predict (estimate/guess) some unknown using information we have as accurately and precisely as possible</p>
<ul>
<li>Prediction could involve estimating a numeric outcome. Alternatively, prediction also involves classification– predicting a categorical outcome (e.g., prediction of who wins vs.&nbsp;who loses).</li>
</ul>
<p>Some political science examples of this might include</p>
<ol type="1">
<li>Categorizing comments on social media as being toxic/nasty/uncivil</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/instagramhate.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Wired</figcaption>
</figure>
</div>
<ol start="2" type="1">
<li>Detecting Fake news and misinformation</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/fakenewsai.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">PBS</figcaption>
</figure>
</div>
<ol start="3" type="1">
<li>Forecasting election results</li>
</ol>
<p><img src="images/forecast22.png" class="img-fluid"></p>
<p>Other examples</p>
<ul>
<li>Trying to detect hate speech online</li>
<li>Predicting where or when an attack might occur</li>
<li>Trying to classify a large amount of text into subject or topic categories for analysis</li>
</ul>
<p>What other types of things might we try to predict or classify in political science?</p>
</section>
<section id="process-of-prediction" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="process-of-prediction"><span class="header-section-number">7.2</span> Process of Prediction</h2>
<p>Predict (estimate/guess) some unknown using information we have – and do so as accurately and precisely as possible.</p>
<ol type="1">
<li>Choose an approach
<ul>
<li>Using an observed (known) measure as a direct proxy to predict an outcome</li>
<li>Using one or more observed (known) measures in a regression model to predict an outcome</li>
<li>(Beyond the course) Using a statistical model to select the measures to use for predicting an outcome</li>
</ul></li>
<li>Assess accuracy and precision
<ul>
<li>Prediction error: <span class="math inline">\(Prediction - Truth\)</span></li>
<li>Bias: Average prediction error: <span class="math inline">\(\text{mean}(Prediction - Truth)\)</span>
<ul>
<li>A prediction is `unbiased’ if the bias is zero (If the prediction is on average true)</li>
</ul></li>
<li>Root-mean squared error: <span class="math inline">\(\sqrt{\text{mean}((Prediction - Truth)^2)}\)</span>
<ul>
<li>Like `absolute’ error– the average magnitude of the prediction error</li>
<li>the typical distance the prediction is from the truth</li>
</ul></li>
<li>Confusion Matrix
<ul>
<li>A cross-tab of predictions you got correct vs.&nbsp;predictions you got wrong (misclassified)</li>
<li>Gives you true positives and true negatives vs.&nbsp;false positives and false negatives</li>
</ul></li>
</ul></li>
<li>Iterate to improve the prediction/classification
<ul>
<li>Often, we repeat steps 1-3 until we are confident in your method for predicting.</li>
</ul></li>
<li>Danger Zone: Eventually, after you have tested the approach and are satisfied with the accuracy, you may start applying it to new data for which you do not know the right answer.</li>
</ol>
</section>
<section id="example-forecasting-2020-us-election-based-on-2016-results" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="example-forecasting-2020-us-election-based-on-2016-results"><span class="header-section-number">7.3</span> Example: Forecasting 2020 US Election based on 2016 Results</h2>
<p>Let’s try to predict the 2020 election results using just the 2016 results.</p>
<p><em>For a video explainer of the code for this application, see below. (Via youtube, you can speed up the playback to 1.5 or 2x speed.)</em></p>
<div class="ratio ratio-16x9"><iframe src="https://www.youtube.com/embed/zWDxZogRwOs" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>results2020 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"elecresults2020.csv"</span>, <span class="at">stringsAsFactors =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Variables</p>
<ul>
<li><code>state</code>: state or state and district</li>
<li><code>called</code>: result of 2020 election</li>
<li><code>margin2016</code>: two-party margin in 2016. Positive values indicate Democratic win, negative indicate Republican win</li>
<li><code>EV</code>: Electoral votes associated with a state/ district of a state</li>
</ul>
<p><img src="images/result2020.png" class="img-fluid" style="width:80.0%"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(results2020<span class="sc">$</span>EV[results2020<span class="sc">$</span>called <span class="sc">==</span> <span class="st">"R"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 232</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(results2020<span class="sc">$</span>EV[results2020<span class="sc">$</span>called <span class="sc">==</span> <span class="st">"D"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 306</code></pre>
</div>
</div>
<section id="choose-approach" class="level3" data-number="7.3.1">
<h3 data-number="7.3.1" class="anchored" data-anchor-id="choose-approach"><span class="header-section-number">7.3.1</span> Choose Approach</h3>
<ol type="1">
<li>Choose an approach: Using an observed (known) measure as a direct proxy to predict an outcome</li>
</ol>
<ul>
<li>Let’s use the 2016 result as a direct proxy to predict 2020.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>results2020<span class="sc">$</span>predicted2020 <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(results2020<span class="sc">$</span>margin2016 <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">"R"</span>, <span class="st">"D"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>results2020<span class="sc">$</span>predicted2020 <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(results2020<span class="sc">$</span>predicted2020)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="assess-accuracy" class="level3" data-number="7.3.2">
<h3 data-number="7.3.2" class="anchored" data-anchor-id="assess-accuracy"><span class="header-section-number">7.3.2</span> Assess Accuracy</h3>
<ol start="2" type="1">
<li>Assess accuracy</li>
</ol>
<p>What proportion of states did we get correct?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(results2020<span class="sc">$</span>predicted2020 <span class="sc">==</span> results2020<span class="sc">$</span>called)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8928571</code></pre>
</div>
</div>
<p>Classification</p>
<p>We want to correctly predict the winner of each state</p>
<p>Prediction of binary outcome variable = classification problem</p>
<ul>
<li>true positive: correctly predicting Biden to be the winner</li>
<li>false positive: incorrectly predicting Biden to be the winner (misclassification)</li>
<li>true negative: correctly predicting Biden to be the loser</li>
<li>false negative: incorrectly predicting Biden to be the loser (misclassification)</li>
</ul>
<p>We define one outcome as the “positive” and one as the “negative.” Here we will say a Biden win is the positive and a Trump win is the negative. You could flip this and make a Trump win the positive and a Biden win the negative. This terminology comes from settings where there is a more objective positive vs.&nbsp;negative result (e.g., a positive medical test result) than most social science settings. The key thing is that we are trying to identify different types of correct classifications vs.&nbsp;misclassifications.</p>
<p>Confusion Matrix: Tells us how we went right, how we went wrong.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">predicted=</span>results2020<span class="sc">$</span>predicted2020, <span class="at">actual =</span> results2020<span class="sc">$</span>called)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         actual
predicted  D  R
        D 22  0
        R  6 28</code></pre>
</div>
</div>
<p>Which states did we get wrong?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>results2020<span class="sc">$</span>state[results2020<span class="sc">$</span>predicted2020 <span class="sc">!=</span> results2020<span class="sc">$</span>called]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] Arizona               Georgia               Michigan             
[4] Nebraska 2nd District Pennsylvania          Wisconsin            
56 Levels: Alabama Alaska Arizona Arkansas California Colorado ... Wyoming</code></pre>
</div>
</div>
</section>
<section id="iterate-to-improve-predictions" class="level3" data-number="7.3.3">
<h3 data-number="7.3.3" class="anchored" data-anchor-id="iterate-to-improve-predictions"><span class="header-section-number">7.3.3</span> Iterate to improve predictions</h3>
<p>Start back at step one. We continue to repeat steps 1 and 2 until we are confident in our predictions.</p>
<p>How could we improve our predictions of elections? What other information could we use?</p>
</section>
</section>
<section id="example-using-polls-to-predict-the-2020-election-results" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="example-using-polls-to-predict-the-2020-election-results"><span class="header-section-number">7.4</span> Example: Using polls to predict the 2020 election results</h2>
<p><em>For a video explainer of the code for this application, see below. (Via youtube, you can speed up the playback to 1.5 or 2x speed.)</em></p>
<div class="ratio ratio-16x9"><iframe src="https://www.youtube.com/embed/zWDxZogRwOs" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<p>Many forecasters use pre-election polls in their models to predict election outcomes. In 2016 and 2020, polling-based forecasts received a lot of criticism</p>
<p>Prior to the 2016 elections, forecasts that used polls seemed confident that Hillary Clinton would win the election. <a href="https://www.youtube.com/watch?v=zerWCVpXTr8">Political analysts</a> also seemed to think the polls were favorable to Clinton.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/clintonupshot.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption"><em>NY Upshot</em></figcaption>
</figure>
</div>
<p>We all know that afterwards, Clinton did not win.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/afterpolls.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption class="figure-caption"><em>Pew</em></figcaption>
</figure>
</div>
<p>This led public opinion scholars and practitioners to do a deep investigation into the quality of pre-election polling. Like 2016, following the 2020 election, a similar team investigated the quality of pre-election polling in 2020. Here, while many polls pointed to a favorable outcome for Biden, the results seemed closer than one might have anticipated.</p>
<p><img src="images/aaportitle.png" class="img-fluid"></p>
<p>The results of these findings are in the <a href="https://www.aapor.org/AAPOR_Main/media/MainSiteFiles/AAPOR-Task-Force-on-2020-Pre-Election-Polling_Report-FNL.pdf">AAPOR report</a>.</p>
<section id="choose-an-approach-lets-analyze-some-polls" class="level3" data-number="7.4.1">
<h3 data-number="7.4.1" class="anchored" data-anchor-id="choose-an-approach-lets-analyze-some-polls"><span class="header-section-number">7.4.1</span> Choose an approach: Let’s analyze some polls</h3>
<p>We are going to do our own analysis of pre-election polls as a prediction of the 2020 election results. We will use a large number of state polls conducted from May-November 2020 that were made available to the public on FiveThirtyEight.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>polls2020 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"pollsandresults2020.csv"</span>, <span class="at">stringsAsFactors =</span> T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Variables</p>
<ul>
<li><code>TrumpPoll, BidenPoll</code>: Poll-based vote share for Biden or Trump</li>
<li><code>TrumpResult, BidenResult</code>: Actual vote share for Biden or Trump</li>
<li><code>EV</code>: Electoral votes associated with state/CD</li>
<li><code>days_to_election</code>: Days until Election Day</li>
<li><code>stateid</code>: state abbreviation</li>
<li><code>fte_grade</code>: FiveThirtyEight Pollster grade</li>
<li><code>sample_size</code>: Poll sample size</li>
</ul>
<p>Can we predict the outcome of an election using polls?</p>
<p>Let’s create our outcome variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Biden's margin of victory (or defeat) in  the polls</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>polls2020<span class="sc">$</span>polldiff <span class="ot">&lt;-</span> polls2020<span class="sc">$</span>BidenPoll <span class="sc">-</span> polls2020<span class="sc">$</span>TrumpPoll</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Biden's margin of victory (or defeat) in the actual election result</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>polls2020<span class="sc">$</span>resultdiff <span class="ot">&lt;-</span> polls2020<span class="sc">$</span>BidenResult <span class="sc">-</span> polls2020<span class="sc">$</span>TrumpResult</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Positive numbers mean Biden was ahead/won. Negative mean Trump was ahead/won.</p>
<p><img src="images/result2020.png" class="img-fluid" style="width:80.0%"></p>
<p>Let’s predict the amount of electoral votes for Biden based on polls in each state close to Election Day.</p>
<p>Let’s start with 1 state.</p>
<ul>
<li>Let’s grab all polls within 2 weeks of the election or the most recent day polled (for areas that did not have recent polls)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Iteration vector</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="fu">unique</span>(polls2020<span class="sc">$</span>stateid)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>states[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] AL
55 Levels: AK AL AR AZ CA CO CT DC DE FL GA HI IA ID IL IN KS KY LA MA ... WY</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Subset to just Alabama</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>subdata <span class="ot">&lt;-</span> <span class="fu">subset</span>(polls2020, stateid <span class="sc">==</span> states[<span class="dv">1</span>])</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Further subset to the "latest polls"</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>subdata <span class="ot">&lt;-</span> <span class="fu">subset</span>(subdata, days_to_election <span class="sc">&lt;</span> <span class="dv">15</span> <span class="sc">|</span> </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>                      days_to_election <span class="sc">==</span> <span class="fu">min</span>(subdata<span class="sc">$</span>days_to_election) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now let’s extract the actual margin for Biden, the poll-based predicted margin, and finally, let’s assign electoral votes based on our prediction.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Find the margin for the actual result</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>result.marginAL <span class="ot">&lt;-</span> <span class="fu">mean</span>(subdata<span class="sc">$</span>resultdiff)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>result.marginAL</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -25.4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Find the margin for our prediction</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>polls.marginAL <span class="ot">&lt;-</span> <span class="fu">mean</span>(subdata<span class="sc">$</span>polldiff)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>polls.marginAL</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -21.16667</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Allocate votes for Biden according to the margin</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>bidenvotesAL <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">mean</span>(subdata<span class="sc">$</span>polldiff) <span class="sc">&gt;</span> <span class="dv">0</span>, </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">unique</span>(subdata<span class="sc">$</span>EV), <span class="dv">0</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>bidenvotesAL</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>We predicted Biden would lose Alabama because the <code>polls.marginAL</code> is negative. Therefore, we assigned Biden 0 electoral votes in this example.</p>
</section>
<section id="loop-through-all-states" class="level3" data-number="7.4.2">
<h3 data-number="7.4.2" class="anchored" data-anchor-id="loop-through-all-states"><span class="header-section-number">7.4.2</span> Loop through all states</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Iteration vector</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>states <span class="ot">&lt;-</span> <span class="fu">unique</span>(polls2020<span class="sc">$</span>stateid)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="do">## Container vector</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>polls.margin <span class="ot">&lt;-</span> result.margin <span class="ot">&lt;-</span> bidenvotes <span class="ot">&lt;-</span> </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">length</span>(states))</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(polls.margin) <span class="ot">&lt;-</span> <span class="fu">names</span>(result.margin) <span class="ot">&lt;-</span> </span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(bidenvotes)  <span class="ot">&lt;-</span><span class="fu">as.character</span>(<span class="fu">unique</span>(states))</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Loop</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(states)){</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  subdata <span class="ot">&lt;-</span> <span class="fu">subset</span>(polls2020, stateid <span class="sc">==</span> states[i] )</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>  subdata <span class="ot">&lt;-</span> <span class="fu">subset</span>(subdata, days_to_election <span class="sc">&lt;</span> <span class="dv">15</span> <span class="sc">|</span> </span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>                      days_to_election <span class="sc">==</span> <span class="fu">min</span>(subdata<span class="sc">$</span>days_to_election) )</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  result.margin[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(subdata<span class="sc">$</span>resultdiff)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  polls.margin[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(subdata<span class="sc">$</span>polldiff)</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>  bidenvotes[i] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">mean</span>(subdata<span class="sc">$</span>polldiff) <span class="sc">&gt;</span> <span class="dv">0</span>, </span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>                            <span class="fu">unique</span>(subdata<span class="sc">$</span>EV), <span class="dv">0</span>)</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(bidenvotes) <span class="co"># predicted</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 351</code></pre>
</div>
</div>
</section>
<section id="check-accuracy" class="level3" data-number="7.4.3">
<h3 data-number="7.4.3" class="anchored" data-anchor-id="check-accuracy"><span class="header-section-number">7.4.3</span> Check Accuracy</h3>
<section id="quantitative-measures-of-accuracy" class="level4" data-number="7.4.3.1">
<h4 data-number="7.4.3.1" class="anchored" data-anchor-id="quantitative-measures-of-accuracy"><span class="header-section-number">7.4.3.1</span> Quantitative Measures of Accuracy</h4>
<p>Let’s calculate two common measures of prediction error: bias (the average prediction error) and root-mean-squared error (a typical magnitude of the prediction error).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Calculate Bias (Predicted Biden - True Biden)</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>predictionerror <span class="ot">&lt;-</span> polls.margin <span class="sc">-</span>result.margin </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>bias <span class="ot">&lt;-</span> <span class="fu">mean</span>(predictionerror)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Root Mean Squared Error</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">mean</span>((predictionerror)<span class="sc">^</span><span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6.052873</code></pre>
</div>
</div>
<p>On average, the poll-based prediction was more than 4 points larger for Biden’s margin than the actual result.</p>
<p>We can create a plot similar to the left plot from the AAPOR report.</p>
<p><img src="images/aaporhist20.png" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Histogram of Prediction Errors to Show Bias</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(predictionerror, </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Prediction Error (Predicted Biden Margin - Actual)"</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Histogram of Prediction Error in Latest Polls"</span>)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="fu">mean</span>(predictionerror), <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="07-Prediction_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<details>
<summary>
Bonus: Another way to visualize the prediction error
</summary>
<ul>
<li>Let’s create our own version of this AAPOR Plot</li>
</ul>
<p><img src="images/aapor20.png" class="img-fluid"></p>
<p>We will plot the prediction error on the x-axis, and list the corresponding states on the y-axis.</p>
<ul>
<li>We will sort the prediction error to make it easier to see the pattern of results.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x=</span><span class="fu">sort</span>(predictionerror), <span class="at">y=</span><span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(predictionerror),</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Average Prediction Error by State </span><span class="sc">\n</span><span class="st"> Biden - Trump Margin"</span>,</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"State"</span>,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"Prediction Error (Predicted Biden Margin - Actual Margin)"</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">yaxt=</span><span class="st">"n"</span>,</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">bty=</span><span class="st">"n"</span>,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">15</span>)) </span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">2</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(predictionerror), <span class="at">labels=</span><span class="fu">names</span>(<span class="fu">sort</span>(predictionerror)), <span class="at">las=</span><span class="dv">1</span>, </span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">cex.axis=</span>.<span class="dv">5</span>,<span class="at">tick=</span>F)</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a><span class="fu">axis</span>(<span class="dv">1</span>, <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">15</span>, <span class="dv">5</span>), <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">15</span>, <span class="dv">5</span>))</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">15</span>, <span class="st">"Poll Margin </span><span class="sc">\n</span><span class="st"> Skewed Toward Trump"</span>, <span class="at">cex=</span>.<span class="dv">7</span>)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="dv">8</span>, <span class="dv">15</span>, <span class="st">"Poll Margin </span><span class="sc">\n</span><span class="st"> Skewed Toward Biden"</span>, <span class="at">cex=</span>.<span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="07-Prediction_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</details>
</section>
<section id="classification" class="level4" data-number="7.4.3.2">
<h4 data-number="7.4.3.2" class="anchored" data-anchor-id="classification"><span class="header-section-number">7.4.3.2</span> Classification</h4>
<p>Instead of quantifying how far we were off, let’s see where we were right vs.&nbsp;where we were wrong.</p>
<p>Classification</p>
<ul>
<li>true positive: correctly predicting Biden to be the winner</li>
<li>false positive: incorrectly predicting Biden to be the winner</li>
<li>true negative: correctly predicting Biden to be the loser</li>
<li>false negative: incorrectly predicting Biden to be the loser</li>
</ul>
<p>Confusion Matrix</p>
<p>Let’s classify our predictions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>actualwins <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(result.margin <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"Biden Won"</span>, <span class="st">"Trump Won"</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>predictedwins <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(polls.margin <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">"Biden Won"</span>, <span class="st">"Trump Won"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(predictedwins, actualwins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             actualwins
predictedwins Biden Won Trump Won
    Biden Won        28         3
    Trump Won         0        24</code></pre>
</div>
</div>
<p>Where did the polls get it wrong?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>actualwins[actualwins <span class="sc">!=</span> predictedwins]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         FL         ME2          NC 
"Trump Won" "Trump Won" "Trump Won" </code></pre>
</div>
</div>
<p>What’s your conclusion?</p>
<ul>
<li>Are the polls alright?</li>
<li>How could you improve the prediction?</li>
<li>Wait a second… why even poll?</li>
</ul>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./06-Loops.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Loops in R</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./08-Regression.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Prediction with Regression</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>