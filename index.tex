% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
\PassOptionsToPackage{dvipsnames,svgnames,x11names}{xcolor}
%
\documentclass[
  letterpaper,
  DIV=11,
  numbers=noendperiod]{scrreprt}

\usepackage{amsmath,amssymb}
\usepackage{iftex}
\ifPDFTeX
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
\usepackage{lmodern}
\ifPDFTeX\else  
    % xetex/luatex font selection
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\setlength{\emergencystretch}{3em} % prevent overfull lines
\setcounter{secnumdepth}{5}
% Make \paragraph and \subparagraph free-standing
\ifx\paragraph\undefined\else
  \let\oldparagraph\paragraph
  \renewcommand{\paragraph}[1]{\oldparagraph{#1}\mbox{}}
\fi
\ifx\subparagraph\undefined\else
  \let\oldsubparagraph\subparagraph
  \renewcommand{\subparagraph}[1]{\oldsubparagraph{#1}\mbox{}}
\fi

\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{241,243,245}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.40,0.45,0.13}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\BuiltInTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\ExtensionTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.28,0.35,0.67}{#1}}
\newcommand{\ImportTok}[1]{\textcolor[rgb]{0.00,0.46,0.62}{#1}}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\NormalTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.68,0.00,0.00}{#1}}
\newcommand{\RegionMarkerTok}[1]{\textcolor[rgb]{0.00,0.23,0.31}{#1}}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.07,0.07,0.07}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.13,0.47,0.30}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.37,0.37,0.37}{\textit{#1}}}

\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother

\KOMAoption{captions}{tableheading}
\makeatletter
\makeatother
\makeatletter
\@ifpackageloaded{bookmark}{}{\usepackage{bookmark}}
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\AtBeginDocument{%
\ifdefined\contentsname
  \renewcommand*\contentsname{Table of contents}
\else
  \newcommand\contentsname{Table of contents}
\fi
\ifdefined\listfigurename
  \renewcommand*\listfigurename{List of Figures}
\else
  \newcommand\listfigurename{List of Figures}
\fi
\ifdefined\listtablename
  \renewcommand*\listtablename{List of Tables}
\else
  \newcommand\listtablename{List of Tables}
\fi
\ifdefined\figurename
  \renewcommand*\figurename{Figure}
\else
  \newcommand\figurename{Figure}
\fi
\ifdefined\tablename
  \renewcommand*\tablename{Table}
\else
  \newcommand\tablename{Table}
\fi
}
\@ifpackageloaded{float}{}{\usepackage{float}}
\floatstyle{ruled}
\@ifundefined{c@chapter}{\newfloat{codelisting}{h}{lop}}{\newfloat{codelisting}{h}{lop}[chapter]}
\floatname{codelisting}{Listing}
\newcommand*\listoflistings{\listof{codelisting}{List of Listings}}
\makeatother
\makeatletter
\@ifpackageloaded{caption}{}{\usepackage{caption}}
\@ifpackageloaded{subcaption}{}{\usepackage{subcaption}}
\makeatother
\makeatletter
\@ifpackageloaded{tcolorbox}{}{\usepackage[skins,breakable]{tcolorbox}}
\makeatother
\makeatletter
\@ifundefined{shadecolor}{\definecolor{shadecolor}{rgb}{.97, .97, .97}}
\makeatother
\makeatletter
\makeatother
\makeatletter
\makeatother
\ifLuaTeX
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\urlstyle{same} % disable monospaced font for URLs
\hypersetup{
  pdftitle={Data Science for Political Science},
  colorlinks=true,
  linkcolor={red},
  filecolor={Maroon},
  citecolor={Blue},
  urlcolor={Blue},
  pdfcreator={LaTeX via pandoc}}

\title{Data Science for Political Science}
\author{}
\date{2024-09-01}

\begin{document}
\maketitle
\ifdefined\Shaded\renewenvironment{Shaded}{\begin{tcolorbox}[sharp corners, breakable, boxrule=0pt, interior hidden, frame hidden, enhanced, borderline west={3pt}{0pt}{shadecolor}]}{\end{tcolorbox}}\fi

\renewcommand*\contentsname{Section Contents}
{
\hypersetup{linkcolor=}
\setcounter{tocdepth}{3}
\tableofcontents
}
\bookmarksetup{startatroot}

\hypertarget{course-notes}{%
\chapter*{Course Notes}\label{course-notes}}
\addcontentsline{toc}{chapter}{Course Notes}

\markboth{Course Notes}{Course Notes}

This document will include important links and course notes for
01:790:391:01: Data Science for Political Science for the fall 2024
semester.

\begin{itemize}
\item
  This site will be updated throughout the semester with new content.
\item
  The Canvas modules will provide links to the relevant sections to
  review for a given week of the course.
\item
  The primary text for the course is
  \href{https://qss.princeton.press/qss-an-introduction/}{Quantitative
  Social Science: An Introduction} by Kosuke Imai. We will refer to this
  as QSS in the notes.
\item
  This is a living document. If you spot errors or have questions or
  suggestions, please email me at k.mccabe@rutgers.edu or post to the
  course Canvas site.
\item
  Occasionally the notes are updated with embedded video explainers of
  portions of the code in different sections.
\end{itemize}

\bookmarksetup{startatroot}

\hypertarget{introduction}{%
\chapter{Introduction}\label{introduction}}

\hypertarget{what-have-i-signed-up-for}{%
\section{What have I signed up for?}\label{what-have-i-signed-up-for}}

First: What is Data Science?

\begin{itemize}
\tightlist
\item
  Data Science involves a combination of math/statistics and
  programming/coding skills, which, for our purposes, we will combine
  with social science knowledge.

  \begin{itemize}
  \tightlist
  \item
    \href{http://drewconway.com/zia/2013/3/26/the-data-science-venn-diagram}{Drew
    Conway} has a nice venn diagram of how these different skill sets
    intersect.
  \item
    Note: This course will not assume prior familiarity with data
    science in general or coding, specifically. For those brand new to
    data science, the idea of learning to code may seem intimidating,
    but anyone can succeed with a bit of patience and an open mind.
  \end{itemize}
\end{itemize}

\includegraphics{images/venn.png}

Next: What is political science?

\begin{itemize}
\tightlist
\item
  The science of politics, of course! Politics focuses on studying
  governance and the distribution of power in society, broadly
  conceived.

  \begin{itemize}
  \tightlist
  \item
    How else might you define politics and political science? What do we
    study in political science?
  \end{itemize}
\end{itemize}

\hypertarget{data-science-can-help-social-scientists}{%
\subsection{Data Science Can Help Social
Scientists}\label{data-science-can-help-social-scientists}}

\textbf{\emph{Example: Mapping poverty using mobile phone and satellite
data}}

Researchers used modern data sources, including mobile phone data, as a
way to \textbf{\emph{predict}} and \textbf{\emph{describe}} poverty in
different geographic regions. These tools helped social scientists come
up with methods that are much more cost-effective and efficient, but
still as accurate as traditional methods for this type of measurement.

\begin{itemize}
\tightlist
\item
  How might measures of global poverty be useful to political
  scientists?
\end{itemize}

\includegraphics[width=0.9\textwidth,height=\textheight]{images/blum.jpg}

\href{https://royalsocietypublishing.org/doi/10.1098/rsif.2016.0690}{Steele
et al.~2017}: ``Poverty is one of the most important determinants of
adverse health outcomes globally, a major cause of societal instability
and one of the largest causes of lost human potential. Traditional
approaches to measuring and targeting poverty rely heavily on census
data, which in most low- and middle-income countries (LMICs) are
unavailable or out-of-date. Alternat emeasures are needed to complement
and update estimates between censuses. This study demonstrates how
public and private data sources that are commonly available for LMICs
can be used to provide novel insight into the spatial distribution of
poverty.We evaluate the relative value of modelling three traditional
poverty measures using aggregate data from mobile operators and widely
available geospatial data.''

\hypertarget{course-goals}{%
\subsection{Course Goals}\label{course-goals}}

\textbf{\emph{Social Science Goals}}

We have several goals in social science. Here are four that data science
can help us pursue:

\begin{itemize}
\tightlist
\item
  \textbf{Describe} and measure

  \begin{itemize}
  \tightlist
  \item
    Has the U.S. population increased?
  \end{itemize}
\item
  \textbf{Explain}, evaluate, and recommend (study of causation)

  \begin{itemize}
  \tightlist
  \item
    Does expanding Medicaid improve health outcomes?
  \end{itemize}
\item
  \textbf{Predict}

  \begin{itemize}
  \tightlist
  \item
    Who will win the next election?
  \end{itemize}
\item
  \textbf{Discover}

  \begin{itemize}
  \tightlist
  \item
    How do policies diffuse across states?
  \end{itemize}
\end{itemize}

What are other examples of these goals?

Note: In this course, we are exploiting the benefits of quantitative
data to help achieve goals of social science. However, quantitative data
have their shortcomings, too. We will also discuss the limitations of
various applications of social science data, and we encourage you to
always think critically about how we are using data.

This course will provide you with a taste of each of these social
science goals, and how the use of data can help achieve these goals. By
the end of the course, you should be able to

\begin{itemize}
\tightlist
\item
  Provide examples of how quantitative data may be used to help answer
  social science research questions.
\item
  Compare and contrast the goals of description, causation, prediction,
  and discovery in social science research.
\item
  Use the programming language R to import and explore social science
  data and conduct basic statistical analyses.
\item
  Interpret and describe visual displays of social science data, such as
  graphs and maps.
\item
  Develop your own analyses and visualizations to understand social
  science phenomena.
\end{itemize}

If you are someone that loves data, we hope you will find this course
engaging. If you are someone who loathes or finds the idea of working
with data and statistics alarming, we hope you keep an open mind. We
will meet you where you are. This course will not assume knowledge of
statistical software, and there will be plenty of opportunities to ask
questions and seek help from classmates and the instructor throughout
the semester.

The first section of course will walk people through how to use the
statistical program-- R-- that we will employ this semester.

\textbf{\emph{Will this course help me in the future?}}

Even if you do not plan on becoming a social scientist or a data
scientist, an introduction to these skills may prove helpful throughout
your academic and professional careers.

\begin{itemize}
\tightlist
\item
  To become an informed consumer of news articles and research involving
  quantitative analyses.
\item
  To practice analytical thinking to make informed arguments and
  decisions.
\item
  To expand your toolkit for getting a job that may involve consuming or
  performing some data analysis, even if that is not the traditional
  role.

  \begin{itemize}
  \tightlist
  \item
    Example: Journalism-
    \href{https://www.nytimes.com/2019/06/12/reader-center/data-reporting-spreadsheets.html}{How
    5 Data Dynamos Do Their Jobs}
  \end{itemize}
\end{itemize}

\hypertarget{rsetup}{%
\section{Setup in R}\label{rsetup}}

\textbf{Goal}

By the end of the first week of the course, you will want to have R and
RStudio installed on your computer (both free), feel comfortable using R
as a calculator, and making documents using the R Markdown file type
within RStudio.

R is an application that processes the R programming language. RStudio
is also an application, which serves as a user interface that makes
working in R easier. We will primarily open and use RStudio to work with
R.

In other classes, you may come across Stata, SPSS, Excel, or SAS, which
are programs that also conduct data analysis. R has the advantage of
being free and open-source. Even after you leave the university setting,
you will be able to use R/RStudio for free. As an open-source program,
it is very flexible, and a community of active R/RStudio users is
constantly adding to and improving the program. You might also encounter
the Python language at some point. R and Python have similarities, and
learning R can also make learning Python easier down the road.

\textbf{R and RStudio Installation}

IMPORTANT: Note the 2 Steps. These are 2 separate applications you must
install. Installing one without the other will not work for our
purposes.

This content follows and reinforces section
\href{https://assets.press.princeton.edu/chapters/s11025.pdf}{QSS 1.3}
in our book. Additional resources are also linked below.

\begin{itemize}
\tightlist
\item
  This \href{http://www.youtube.com/embed/ulIv0NiVTs4?rel=0}{video} from
  Professor Christopher Bail explains why many social scientists use R
  and describes the R and RStudio installation process. This involves

  \begin{enumerate}
  \def\labelenumi{\arabic{enumi}.}
  \tightlist
  \item
    Going to \href{https://cran.r-project.org/}{cran}, select the link
    that matches your operating system, and then follow the installation
    instructions, and
  \item
    Visiting \href{http://www.rstudio.com/}{RStudio} and follow the
    download and installation instructions. R is the statistical
    software and programming language used for analysis. RStudio
    provides a convenient user interface for running R code.
  \end{enumerate}
\end{itemize}

\url{https://www.youtube.com/watch?v=ulIv0NiVTs4}

\hypertarget{open-r-script-in-rstudio}{%
\section{Open R Script in RStudio}\label{open-r-script-in-rstudio}}

This next section provides a few notes on using R and RStudio now that
you have installed it. In this section, we cover the following
materials:

\begin{itemize}
\tightlist
\item
  Using R as a calculator and assigning objects using
  \texttt{\textless{}-}
\item
  Setting your working directory and the \texttt{setwd()} function.
\item
  Creating and saving an R script (.R file)
\item
  Creating, saving, and compiling an R Markdown document (.Rmd) into an
  html document (.html)
\end{itemize}

This section highlights important concepts from
\href{https://assets.press.princeton.edu/chapters/s11025.pdf}{QSS
chapter 1}.

RStudio is an open-source and free program that greatly facilitates the
use of R, especially for users new to programming. Once you have
downloaded and installed R and RStudio, to work in R, all you need to do
now is \textbf{\emph{open RStudio}} (it will open R). It should look
like this, though your version numbers will be different:

\includegraphics{images/rconsole1.png}

\textbf{Note:} The first time you open RStudio, you likely only have the
three windows above. We will want to create a fourth window by
\textbf{opening an R script} to create the fourth window.

\begin{itemize}
\tightlist
\item
  To do this, in RStudio, click on File -\textgreater{} New
  -\textgreater{} R script in your computer's toolbar. This will open a
  blank document for text editing in the upper left of the RStudio
  window. We will return to this window in a moment.

  \begin{itemize}
  \tightlist
  \item
    You can alternatively click on the green + sign indicator in the
    top-left corner of the RStudio window, which should give you the
    option to create a new R script document.
  \end{itemize}
\end{itemize}

Now you should have something that looks like this, similar to Figure
1.1. in QSS:

\includegraphics{images/rconsole2.png}

\begin{itemize}
\tightlist
\item
  The upper-left window has our .R script document that will contain
  code.
\item
  The lower-left window is the console. This will show the output of the
  code we run. We will also be able to type directly in the console.
\item
  The upper-right window shows the environment (and other tabs, such as
  the history of commands). When we load and store data in RStudio, we
  will see a summary of that in the environment.
\item
  The lower-right window will enable us to view plots and search help
  files, among other things.
\end{itemize}

\hypertarget{using-r-as-a-calculator}{%
\subsection{Using R as a Calculator}\label{using-r-as-a-calculator}}

The \emph{bottom left} window in your RStudio is the Console. You can
type in this window to use R as a calculator or to try out commands. It
will show the raw output of any commands you type. For example, we can
try to use R as a calculator. Type the following in the Console (the
bottom left window) and hit ``enter'' or ``return'' on your keyboard:

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{5} \SpecialCharTok{+} \DecValTok{3}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 8
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{5} \SpecialCharTok{{-}} \DecValTok{3}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{5}\SpecialCharTok{\^{}}\DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 25
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{5} \SpecialCharTok{*} \DecValTok{3}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 15
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{5}\SpecialCharTok{/}\DecValTok{3}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1.666667
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\DecValTok{5} \SpecialCharTok{+} \DecValTok{3}\NormalTok{) }\SpecialCharTok{*} \DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 16
\end{verbatim}

Again, in the other RStudio windows, the upper right will show a history
of commands that you have sent from the text editor to the R console,
along with other items. The lower right will show graphs, help documents
and other features. These will be useful later in the course.

\hypertarget{working-in-an-r-script}{%
\subsection{Working in an R Script}\label{working-in-an-r-script}}

Earlier, I asked you to open an R script in the upper left window by
doing File, then New File, then R Script. Let's go back to working in
that window.

\textbf{Set your working directory \texttt{setwd()}}

Many times you work in RStudio, the first thing you will do is set your
working directory. This is a designated folder in your computer where
you will save your R scripts and datasets.

There are many ways to do this.

\begin{itemize}
\tightlist
\item
  An easy way is to go to Session -\textgreater{} Set Working Directory
  -\textgreater{} Choose Directory. I suggest choosing a folder in your
  computer that you can easily find and that you will routinely use for
  this class. Go ahead and create/select it.
\item
  Note: when you selected your directory, code came out in the bottom
  left Console window. This is the \texttt{setwd()} command which can
  also be used directly to set your working directory in the future.
\item
  If you aren't sure where your directory has been set, you can also
  type \texttt{getwd()} in your Console. Try it now
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Example of where my directory was}
\FunctionTok{getwd}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "/Users/ktmccabe/Dropbox/GitHub2/dsps24"
\end{verbatim}

If I want to change the working directory, I can go to the top toolbar
of my computer and use Session -\textgreater{} Set Working Directory
-\textgreater{} Choose Directory or just type my file pathway using the
\texttt{setwd()} below:

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Example of setting the working directory using setwd().}
\DocumentationTok{\#\# Your computer will have your own file path.}
\FunctionTok{setwd}\NormalTok{(}\StringTok{"/Users/ktmccabe/Dropbox/Rutgers Teaching/"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{saving-the-r-script}{%
\subsection{Saving the R Script}\label{saving-the-r-script}}

Let's now save our R script to our working directory and give it an
informative name. To do so, go to File, then Save As, make sure you are
in the same folder on your computer as the folder you chose for your
working directory.

Give the file an informative name, such as: ``McCabeWeek1.R''. Note: all
of your R scripts will have the .R extension.

\hypertarget{annotating-your-r-script}{%
\subsection{Annotating your R script}\label{annotating-your-r-script}}

Now that we have saved our R script, let's work inside of it. Remember,
we are in the top-left RStudio window now.

\begin{itemize}
\tightlist
\item
  Just like the beginning of a paper, you will want to title your R
  script. In R, any line that you start with a \# will not be treated as
  a programming command. You can use this to your advantage to write
  titles/comments-- annotations that explain what your code is doing.
  Below is a screenshot example of a template R script.
\item
  You can specify your working directory at the top, too. Add your own
  filepath inside \texttt{setwd()}
\end{itemize}

\includegraphics{images/templateR.png}

\begin{itemize}
\tightlist
\item
  Then you can start answering problems in the rest of the script.
\item
  Think of the R script as where you write the final draft of your
  paper. In the Console (the bottom-left window), you can mess around
  and try different things, like you might when you are taking notes or
  outlining an essay. Then, write the final programming steps that lead
  you to your answer in the R script. For example, if I wanted to add 5
  + 3, I might try different ways of typing it in the Console, and then
  when I found out \texttt{5\ +\ 3} is the right approach, I would type
  that into my script.
\end{itemize}

\hypertarget{running-commands-in-your-r-script}{%
\subsection{Running Commands in your R
script}\label{running-commands-in-your-r-script}}

The last thing we will note in this section is how to execute commands
in your R script.

To run / execute a command in your R script (the upper left window), you
can

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Highlight the code you want to run, and then hold down ``command +
  return'' on a Mac or ``control + enter'' on Windows
\item
  Place your cursor at the end of the line of code (far right), and hit
  ``command + return'' on a Mac or ``control + return'' on Windows, or
\item
  Do 1 or 2, but instead of using the keyboard to execute the commands,
  click ``Run'' in the top right corner of the upper-left window.
\end{enumerate}

Try it: Type \texttt{5\ +\ 3} in the R script. Then, try to execute
\texttt{5\ +\ 3}. It should look something like this:

\includegraphics{images/rtemplate2.png}

After you executed the code, you should see it pop out in your Console:

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{5} \SpecialCharTok{+} \DecValTok{3}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 8
\end{verbatim}

\includegraphics[width=0.9\textwidth,height=\textheight]{images/runningcode.png}

Note: The symbol \# also allows for annotation behind commands or on a
separate line. Everything that follows \# will be ignored by R. You can
annotate your own code so that you and others can understand what each
part of the code is designed to do.

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Example}
\NormalTok{sum53 }\OtherTok{\textless{}{-}} \DecValTok{5} \SpecialCharTok{+} \DecValTok{3} \CommentTok{\# example of assigning an addition calculation}
\end{Highlighting}
\end{Shaded}

\hypertarget{objects}{%
\subsection{Objects}\label{objects}}

Sometimes we will want to store our calculations as ``objects'' in R. We
use \texttt{\textless{}-} to assign objects by placing it
\href{https://www.youtube.com/watch?v=vLZA67L7gIo\&ab_channel=BeyonceSasha1}{to
the left} of what we want to store. For example, let's store the
calculation \texttt{5\ +\ 3} as an object named \texttt{sum53}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sum53 }\OtherTok{\textless{}{-}} \DecValTok{5} \SpecialCharTok{+} \DecValTok{3}
\end{Highlighting}
\end{Shaded}

After we execute this code, \texttt{sum53} now stores the calculation.
This means, that if we execute a line of code that just has
\texttt{sum53}, it will output 8. Try it:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sum53}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 8
\end{verbatim}

Now we no longer have to type \texttt{5\ +\ 3}, we can just type
\texttt{sum53}. For example, let's say we wanted to subtract 2 from this
calculation. We could do:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sum53 }\SpecialCharTok{{-}} \DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 6
\end{verbatim}

Let's say we wanted to divide two stored calculations:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ten }\OtherTok{\textless{}{-}} \DecValTok{5} \SpecialCharTok{+} \DecValTok{5}
\NormalTok{two }\OtherTok{\textless{}{-}} \DecValTok{1} \SpecialCharTok{+} \DecValTok{1}
\NormalTok{ten }\SpecialCharTok{/}\NormalTok{ two}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 5
\end{verbatim}

The information stored does not have to be numeric. For example, it can
be a word, or what we would call a character string, in which case you
need to use quotation marks.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mccabe }\OtherTok{\textless{}{-}} \StringTok{"professor for this course"}
\NormalTok{mccabe}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "professor for this course"
\end{verbatim}

\emph{Note:} Object names cannot begin with numbers and no spacing is
allowed. Avoid using special characters such as \% and \$, which have
specific meanings in R. Finally, use concise and intuitive object names.

\begin{itemize}
\tightlist
\item
  GOOD CODE: \texttt{practice.calc\ \textless{}-\ 5\ +\ 3}
\item
  BAD CODE:
  \texttt{meaningless.and.unnecessarily.long.name\ \textless{}-\ 5\ +\ 3}
\end{itemize}

While these are simple examples, we will use objects all the time for
more complicated things to store (e.g., like full datasets!) throughout
the course.

We can also store an array or ``vector'' of information using
\texttt{c()}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{somenumbers }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{6}\NormalTok{, }\DecValTok{8}\NormalTok{, }\DecValTok{9}\NormalTok{)}
\NormalTok{somenumbers}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 3 6 8 9
\end{verbatim}

\textbf{Importance of Clean Code}

Ideally, when you are done with your R script, you should be able to
highlight the entire script and execute it without generating any error
messages. This means your code is clean. Code with typos in it may
generate a red error message in the Console upon execution. This can
happen when there are typos or commands are misused.

For example, R is case sensitive. Let's say we assigned our object like
before:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sum53 }\OtherTok{\textless{}{-}} \DecValTok{5} \SpecialCharTok{+} \DecValTok{3}
\end{Highlighting}
\end{Shaded}

However, when we went to execute \texttt{sum53}, we accidentally typed
\texttt{Sum53}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Sum53}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Error in eval(expr, envir, enclos): object 'Sum53' not found
\end{verbatim}

Only certain types of objects can be used in mathematical calculations.
Let's say we tried to divide \texttt{mccabe} by 2:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mccabe }\SpecialCharTok{/} \DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Error in mccabe/2: non-numeric argument to binary operator
\end{verbatim}

A big part of learning to use R will be learning how to troubleshoot and
detect typos in your code that generate error messages.

\includegraphics[width=0.8\textwidth,height=\textheight]{images/punctuation.png}

\hypertarget{r-markdown}{%
\section{R Markdown}\label{r-markdown}}

An R Markdown document, which you can also create in RStudio, allows you
to weave together regular text, R code, and the output of R code in the
same document. This can be very convenient when conducting data analysis
because it allows you more space to explain what you are doing in each
step. We will use it as an effective platform for writing up problem
sets.

R Markdown documents can be ``compiled'' into html, pdf, or docx
documents by clicking the \texttt{Knit} button on top of the upper-left
window. Below is an example of what a compiled html file looks like.

\begin{itemize}
\tightlist
\item
  Note that the image has both written text and a gray chunk, within
  which there is some R code, as well as the output of the R code (e.g.,
  the number 8 and the image of the histogram plot.
  \includegraphics[width=0.6\textwidth,height=\textheight]{images/rmarkdownscreenshot.png}
\end{itemize}

We say this is a ``compiled'' RMarkdown document because it differs from
the raw version of the file, which is a .Rmd file format. Below is an
example of what the raw .Rmd version looks like, compared to the
compiled html version.

\includegraphics[width=0.45\textwidth,height=\textheight]{images/rmarkdownraw.png}
\includegraphics[width=0.4\textwidth,height=\textheight]{images/rmarkdownscreenshot.png}

\hypertarget{getting-started-with-rmarkdown}{%
\subsection{Getting started with
RMarkdown}\label{getting-started-with-rmarkdown}}

Just like with a regular R script, to work in R Markdown, you will open
up RStudio.

\begin{itemize}
\tightlist
\item
  For additional support beyond the notes below, you can also follow the
  materials provided by RStudio for getting started with R Markdown
  https://rmarkdown.rstudio.com/lesson-1.html.
\end{itemize}

The \textbf{first time} you will be working in R Markdown, you will want
to install two packages: \texttt{rmarkdown} and \texttt{knitr}. You can
do this in the Console window in RStudio (remember the lower-left
window!).

Type the following into the Console window and hit enter/return.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"rmarkdown"}\NormalTok{)}
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"knitr"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Once you have those installed, now, each time you want to create an R
Markdown document, you will open up a .Rmd R Markdown file and get to
work.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Go to File -\textgreater{} New File -\textgreater{} R Markdown in
  RStudio

  \begin{itemize}
  \tightlist
  \item
    Alternatively, you can click the green + symbol at the top left of
    your RStudio window
  \end{itemize}
\item
  This should open up a window with several options, similar to the
  image below

  \begin{itemize}
  \tightlist
  \item
    Create an informative title and change the author name to match your
    own
  \item
    For now, we will keep the file type as html. In the future, you can
    create pdf or .doc documents. However, these require additional
    programs installed on your computer, which we will not cover in the
    course.
  \end{itemize}
\end{enumerate}

\includegraphics{images/rmarkdownnewfile.png}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  After you hit ``OK'' a new .Rmd script file will open in your top-left
  window with some template language and code chunks, similar to the
  image below. Alternatively, you can start from scratch by clicking
  ``Create Empty Document'' or open a template .Rmd file of your own
  saved on your computer.
\end{enumerate}

\includegraphics{images/rmarkdowntemplate.png}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  \textbf{\emph{Save as .Rmd file.}} Save the file by going to ``File
  -\textgreater{} Save as'' in RStudio
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Give the file an informative name like your LastnamePractice1.Rmd
\end{itemize}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{4}
\item
  \textbf{\emph{Key Components.}} Now you are ready to work within the
  Rmd script file. We will point to four basic components of this file,
  and you can build your knowledge of RMarkdown from there.

  \begin{enumerate}
  \def\labelenumii{\arabic{enumii}.}
  \tightlist
  \item
    The top part bracketed by \texttt{-\/-\/-} on top and bottom is the
    YAML component. This tells RStudio the pertinent information about
    how to ``compile'' the Rmd file.

    \begin{itemize}
    \tightlist
    \item
      Most of the time you can leave this alone, but you can always edit
      the title, author, or date as you wish.
    \end{itemize}
  \item
    The next component are the global options for the document. It is
    conveniently labeled ``setup.'' By default what this is saying is
    that the compiled version will ``echo'' (i.e., display all code
    chunks and output) unless you specifically specify otherwise. For
    example, note that it says \texttt{include\ =\ FALSE} for the setup
    chunk. That setting means that this code chunk will ``run'' but it
    will not appear in the nicely compiled .html file.

    \begin{itemize}
    \tightlist
    \item
      Most of the time you will not need to edit those settings.
    \end{itemize}
  \item
    The third component I want to bring attention to is the body text.
    The \# symbol in RMarkdown is used to indicate that you have a new
    section of the document. For example, in the compiled images at the
    beginning, this resulted in the text being larger and bolded when it
    said ``Problem 2.'' In addition to just using a single \#, using
    \#\# or \#\#\# can indicate subsections or subsubsections. Other
    than that symbol, you can generally write text just as you would in
    any word processing program, with some exceptions, such as how to
    make text bold or italicized.
  \item
    The final component I want to call attention to are the other main
    body code chunks. These are specific parts of the document where you
    want to create a mini R script. To create these, you can simply
    click the + C symbol toward the top of the top left window of
    RStudio and indicate you want an R chunk.
  \end{enumerate}

  \includegraphics[width=0.2\textwidth,height=\textheight]{images/rmarkdownnewchunk.png}
\item
  \textbf{\emph{Writing R Code.}} Within a code chunk, you can type R
  code just like you would in any R script, as explained in the previous
  section. However, in RMarkdown, you also have the option of running an
  entire code chunk at once by hitting the green triangle at the
  top-right of a given code chunk.
\end{enumerate}

\includegraphics[width=0.7\textwidth,height=\textheight]{images/codechunkexample.png}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{6}
\tightlist
\item
  \textbf{\emph{Knitting the document.}} Once you have added a code
  chunk and/or some text, you are ready to compile or ``Knit'' the
  document. This is what generates the .html document.

  \begin{itemize}
  \tightlist
  \item
    To do so, click on the Knit button toward the top of the top-left
    window of Rstudio. After a few moments, this should open up a
    preview window displaying the compiled html file.
  \item
    It will also save an actual .html file in your working directory
    (the same location on your computer where you have saved the .Rmd
    file)
  \item
    Try to locate this compiled .html file on your computer and open it.
    For most computers, .html files will open in your default web
    browser, such as Google Chrome or Safari.
  \item
    This step is a common place where errors are detected and generated.
    Sometimes the compiling process fails due to errors in the R code in
    your code chunks or an error in the Markdown syntax. If your
    document fails to knit, the next step is to try to troubleshoot the
    error messages the compiling process generates. The best way to
    reduce and more easily detect errors is to ``knit as you go.'' Try
    to knit your document after each chunk of code you create.
  \end{itemize}
\end{enumerate}

\hypertarget{assignment-1}{%
\section{Assignment 1}\label{assignment-1}}

Below is an exercise that will demonstrate you are able to use R as a
calculator, create R scripts, and create and compile R Markdown files.
You should be able to complete this assignment after reviewing the
course notes from this section and QSS chapter 1.

We will start walking through this assignment together during class, but
you are welcome to try to do this ahead of time on your own.

You will submit three documents on Canvas:

\begin{itemize}
\tightlist
\item
  An \textbf{R script} (.R) file with your code. Follow the best
  practices by titling your script and using \# comments to explain your
  steps. This code should be clean. I should be able to run your code to
  verify that the code produces the answers you write down.
\item
  An \textbf{.Rmd} \textbf{document} \textbf{and}
\item
  A compiled RMarkdown \textbf{.html document} that you get after
  ``knitting'' the .Rmd file. This should also have a title including
  your name and use text or \# comments to explain your steps.
\end{itemize}

You can create these documents from scratch using the guidance in the
previous sections, or you can download and open the .R and .Rmd
templates, provided on Canvas, in RStudio to get started.

This video provides a brief overview of opening an R script and R
Markdown file in RStudio with similar problems to those asked of you in
the assignment. The notes in previous sections provide additional
details.

\url{https://www.youtube.com/watch?v=g37_-icdPMc}

\textbf{\emph{Assignment Exercises}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Create a .R script saved as ``LastnameSetup1.R'' (use your last name).
  If you use the template on Canvas, after opening in RStudio, use File
  -\textgreater{} Save As to change to create this file name. Within the
  body of this file, make sure to title it and provide your name.

  \begin{enumerate}
  \def\labelenumii{\arabic{enumii}.}
  \tightlist
  \item
    Set your working directory using the Session tab in RStudio.
  \item
    Do the calculation 8 + 3 - 5 in your R script. Store it as an object
    with an informative name. Report the answer as a comment \# below
    the code.
  \item
    Do the calculation 7 x 3 in your R script. Store it as an object
    with an informative name. Report the answer as a comment \# below
    the code.
  \item
    Add these two calculations together. Note: do this by adding
    together the objects you created, not the underlying raw
    calculations. Report the answer as a \# below the code.
  \end{enumerate}
\item
  In this problem, we will just re-format what we did in the first
  problem in an R Markdown format. Create a .Rmd R Markdown file saved
  as ``LastnameSetup1.Rmd.'' If you use the template on Canvas, after
  opening in RStudio, use File -\textgreater{} Save As to change to
  create this file name. Within this file, make sure to title it and
  provide your name.

  \begin{enumerate}
  \def\labelenumii{\arabic{enumii}.}
  \tightlist
  \item
    Create a Markdown heading \# Problem 2.1. Underneath this, create an
    R code chunk in which you do the calculation 8 + 3 - 5. Store it as
    an object with an informative name. Report the answer in plain
    language below the code chunk.
  \item
    Create a Markdown heading \# Problem 2.2. Underneath this, create an
    R code chunk in which you do the calculation 7 x 3 in your R script.
    Store it as an object with an informative name. Report the answer in
    plain language below the code chunk.
  \item
    Create a Markdown heading \# Problem 2.3. Underneath this, create an
    R code chunk in which you add the previous two calculations
    together. Note: do this by adding together the objects you created,
    not the underlying raw calculations. Report the answer in plain
    language below the code chunk.
  \item
    Create a Markdown heading \# Problem 2.4. Write down how you will
    complete your R assignments this semester. For example, if you have
    a personal laptop with R and RStudio on it, you will simply write
    ``I will use my personal laptop.'' If you don't have a personal
    computer or laptop, please indicate where on campus or off-campus
    you will have regular access to a computer with R/RStudio to do your
    work. It is \textbf{\emph{essential}} that you have regular access
    to a computer so that you will not fall behind in this course.
  \end{enumerate}
\item
  Create a compiled .html file by ``knitting'' the .Rmd file into a
  .html document. Save the file as ``LastnameSetup1.html.'' This should
  happen automatically. The file will be located in the folder where the
  .Rmd file is also saved.
\end{enumerate}

All done! Submit the three documents (.R, .Rmd, and .html) on Canvas.

\bookmarksetup{startatroot}

\hypertarget{description}{%
\chapter{Description}\label{description}}

What are things we want to describe in political science?

\begin{itemize}
\tightlist
\item
  Unemployment rate, GDP
\item
  Voter turnout, vote share for a party in an election
\item
  Percentage of women in the labor force
\item
  Poverty rates over time
\end{itemize}

What else? What does description help us achieve?

\begin{itemize}
\tightlist
\item
  Identify tendencies
\item
  Identify patterns or trends
\item
  Identify relationships between two or more factors
\item
  Help us generalize from anecdotes, what is common vs.~what is
  uncommon?
\item
  Diagnose demand, needs, potential problems, likely outcomes
\end{itemize}

Generate ideas for other goals, such as explanation and prediction

\hypertarget{process-of-describing}{%
\section{Process of Describing}\label{process-of-describing}}

How do we go about a descriptive quantitative analysis?

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Substantive Expertise: Start with a topic, puzzle, or question (e.g.,
  How is the economy doing?)
\item
  Find outcome data relevant to that question (e.g., GDP)

  \begin{itemize}
  \tightlist
  \item
    Start from a concept: what we want to describe (i.e., health of the
    economy)
  \item
    Move toward an ``operationalization'' (i.e., a way to measure it)
  \item
    Easy! except\ldots{} social science is messy. Our concepts are rich,
    while our measures may be very narrow or concrete.

    \begin{itemize}
    \tightlist
    \item
      For example, GDP is one way to measure economic health, but is it
      the only measure?
    \item
      Choose measures based on validity, reliability, cost
    \item
      Validity: how well does the empirical measure reflect the concept
      it is trying to measure (too broad vs.~narrow, susceptible to
      external biases?)
    \item
      Reliability: how reproducible and stable is the measure across
      different researchers and slight variation in sample or measures
    \end{itemize}
  \end{itemize}
\item
  Find multiple relevant units or ``data points'' depending on the
  descriptions and comparisons you want to make

  \begin{itemize}
  \tightlist
  \item
    E.g., Multiple years of data (e.g., U.S., from 1900 to 2020)
  \item
    E.g., Multiple countries from one year (e.g., U.S. to Germany to
    other countries)
  \end{itemize}
\item
  Summarize the data to help answer the question
\end{enumerate}

\hypertarget{example-process}{%
\subsection{Example Process}\label{example-process}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  How is the economy doing?
\item
  Find outcome data relevant to that question

  \begin{itemize}
  \tightlist
  \item
    Let's ask people
  \end{itemize}
\item
  Find multiple relevant units or data points

  \begin{itemize}
  \tightlist
  \item
    We will ask several people. Each person will be a data point.
  \end{itemize}
\item
  Summarize the data

  \begin{itemize}
  \tightlist
  \item
    Let's take the mean
  \end{itemize}
\end{enumerate}

\includegraphics[width=0.5\textwidth,height=\textheight]{images/economysurvey.png}

How would you summarize information in explaining it to another person?
You would probably want to describe how most people feel about the
economy. In other words, you would describe the ``central tendency'' of
people's responses (the central tendency of the data).

\hypertarget{summarizing-univariate-data}{%
\section{Summarizing univariate
data}\label{summarizing-univariate-data}}

For a video explainer of the code in this section, see below. The video
only discusses the code. Use the notes and lecture discussion for
additional context. (Via youtube, you can speed up the playback to 1.5
or 2x speed.)

\url{https://www.youtube.com/watch?v=80tbdiWuljc}

Univariate data refers to data coming from one ``variable,'' where a
variable captures the values of a changing characteristic.

Our set of values is Outcome = \{0,0,0,0,1,1,0,1,0,1\}.

\begin{itemize}
\tightlist
\item
  We will call this a vector of values, where a vector is just a
  collection of things.
\item
  Because our vector contains only numbers, we will call it a
  \emph{numeric} vector.
\item
  Each value can be indexed by \texttt{i}, denoting the position of the
  value in the
\item
  For example, Jesse is in position \texttt{i=10} of the vector, and his
  value is 1
\end{itemize}

We can create vectors in R by using \texttt{c()} and assigning
\texttt{\textless{}-} it to an object we will call \texttt{Outcome}.
Note: you will use the \texttt{c()} and \texttt{\textless{}-} assignment
tool all of the time in this course!

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Outcome }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{) }\CommentTok{\# Use commas to separate values}
\end{Highlighting}
\end{Shaded}

We can extract a particular value within our vector using brackets and
the value's numeric position in the vector.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Outcome[}\DecValTok{10}\NormalTok{] }\CommentTok{\# what value is in the 10th position?}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1
\end{verbatim}

We can label our outcomes using \texttt{names()}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{names}\NormalTok{(Outcome) }\OtherTok{\textless{}{-}}\FunctionTok{c}\NormalTok{(}\StringTok{"Joe"}\NormalTok{,}\StringTok{"Sally"}\NormalTok{, }\StringTok{"Trevor"}\NormalTok{, }\StringTok{"Emily"}\NormalTok{, }\StringTok{"Mark"}\NormalTok{,}
                   \StringTok{"Sarah Jane"}\NormalTok{, }\StringTok{"Stacey"}\NormalTok{, }\StringTok{"Steve"}\NormalTok{, }\StringTok{"Phoebe"}\NormalTok{, }\StringTok{"Jesse"}\NormalTok{)}
\NormalTok{Outcome[}\DecValTok{10}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Jesse 
    1 
\end{verbatim}

We can overwrite whole vectors or values within a vector

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Outcome }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{5}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{2}\NormalTok{, }\DecValTok{6}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{, }\DecValTok{7}\NormalTok{, }\DecValTok{8}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{1}\NormalTok{) }\CommentTok{\# oops we put the wrong numbers}
\NormalTok{Outcome}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] 5 0 2 6 1 1 7 8 0 1
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Outcome }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{) }\CommentTok{\# no problem, just overwrite it}
\NormalTok{Outcome}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] 0 0 0 0 1 1 0 1 0 1
\end{verbatim}

Oops we accidentally type a 0 for Jesse.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Outcome }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{0}\NormalTok{) }\CommentTok{\# oops typo for Jesse}
\NormalTok{Outcome}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] 0 0 0 0 1 1 0 1 0 0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{Outcome[}\DecValTok{10}\NormalTok{] }\OtherTok{\textless{}{-}} \DecValTok{1} \CommentTok{\# no prob bob. Assign a 1 in position 10}
\NormalTok{Outcome}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] 0 0 0 0 1 1 0 1 0 1
\end{verbatim}

Vectors do not have to be numeric. Character vectors contain a
collection of words and phrases. In R, we use quotations around
character values

Example: let's create a vector of names that we will call
\texttt{People}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{People }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Joe"}\NormalTok{,}\StringTok{"Sally"}\NormalTok{, }\StringTok{"Trevor"}\NormalTok{, }\StringTok{"Emily"}\NormalTok{, }\StringTok{"Mark"}\NormalTok{, }\StringTok{"Sarah Jane"}\NormalTok{, }\StringTok{"Stacey"}\NormalTok{, }\StringTok{"Steve"}\NormalTok{, }\StringTok{"Phoebe"}\NormalTok{, }\StringTok{"Jesse"}\NormalTok{)}
\NormalTok{People[}\DecValTok{10}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "Jesse"
\end{verbatim}

We can use the R function \texttt{class()} to tell us the type of object
we have.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(Outcome)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "numeric"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(People)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "character"
\end{verbatim}

\hypertarget{functions-to-summarize-univariate-data}{%
\section{Functions to summarize univariate
data}\label{functions-to-summarize-univariate-data}}

We will use many ``functions'' in R, which are actions that we request R
to perform with data. Functions take one or more inputs that you
provide, ``under the hood'' perform a series of actions, and then
produces one or more outputs. For example, if we supply the
\texttt{mean()} function in R with a set of numbers, R will take the
average of those numbers and then report the result.

For univariate data (data based on a single variable or changing
characteristic), often we are interested in describing the range of the
values and their central tendency. A central tendency reflects the mean
or median.

\begin{itemize}
\tightlist
\item
  range: the minimum (\texttt{min()}) and maximum (\texttt{max()})
  values
\item
  mean: the average value (\texttt{mean()})
\end{itemize}

The average is the sum of the values divided by the number of values:

\(\bar{X} = \frac{\text{sum of values}}{\text{number of values}} = \frac{x_1 + x_2 + ... + x_N}{N}=\frac{1}{N}\sum_{i=1}^{i=N} x_i\)

Let's do this in R for our set of 10 values

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\DecValTok{0} \SpecialCharTok{+} \DecValTok{0} \SpecialCharTok{+} \DecValTok{0} \SpecialCharTok{+} \DecValTok{0} \SpecialCharTok{+} \DecValTok{1} \SpecialCharTok{+} \DecValTok{1} \SpecialCharTok{+} \DecValTok{0} \SpecialCharTok{+} \DecValTok{1} \SpecialCharTok{+} \DecValTok{0} \SpecialCharTok{+} \DecValTok{1}\NormalTok{)}\SpecialCharTok{/}\DecValTok{10}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0.4
\end{verbatim}

The average outcome is .4. Note: when a variable contains only 0's and
1's its mean is the proportion of 1's. 40\% of people think the economy
is doing well.

\hypertarget{step-by-step-using-functions-in-r-overview}{%
\subsection{Step-by-step: Using functions in R
(overview)}\label{step-by-step-using-functions-in-r-overview}}

A function is an action(s) that you request R to perform on an object or
set of objects. For example, we will use the \texttt{mean()} function to
ask R to take the mean or ``average'' of a vector.

\begin{itemize}
\tightlist
\item
  Inside the function you place inputs or ``arguments.''
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(Outcome)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0.4
\end{verbatim}

R also has functions that take the sum \texttt{sum()} of a vector of
values.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sumofvalues }\OtherTok{\textless{}{-}} \FunctionTok{sum}\NormalTok{(Outcome)}
\end{Highlighting}
\end{Shaded}

And that count the total number of values or ``length''
\texttt{length()} of the vector.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{numberofvalues }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(Outcome)}
\end{Highlighting}
\end{Shaded}

Note that the below is also equivalent to the mean

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sumofvalues }\SpecialCharTok{/}\NormalTok{ numberofvalues}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0.4
\end{verbatim}

Returning to our example, we found that 40\% of people surveyed thought
the economy was doing well. Surveying people about their opinions on how
the country doing is a common way that social scientists use
description. We could extend this exercise in many ways going forward,
even with the same question.

\begin{itemize}
\tightlist
\item
  Start with a question: How is the economy doing?
\item
  Let's find a measure: Ask people if the economy is doing well.
\item
  Find data points: Multiple people (we could stop there with the
  average!), or add more variables:

  \begin{itemize}
  \tightlist
  \item
    Across time: Survey people across multiple years
  \item
    Across type of people: Survey different partisan groups
  \end{itemize}
\end{itemize}

These types of trends are often used by news organizations and public
opinion organizations like, Gallup.

\includegraphics[width=0.7\textwidth,height=\textheight]{images/gallupec.png}

This was just a first example of description in political science. There
are many other ways to describe how the economy is doing and many other
topics we might want to describe in politics.

\hypertarget{loading-data-into-r}{%
\section{Loading data into R}\label{loading-data-into-r}}

For this section, our motivating example will be methods to measure
voter turnout in the United States.

Describing voter turnout

\begin{itemize}
\tightlist
\item
  What is a typical level of voter turnout?
\item
  How has turnout changed over time?
\item
  Is turnout higher in presidential years or in midterm years?
\end{itemize}

How can we measure turnout? Think about the validity, reliability, and
cost of different approaches.

Example: Dataset on Voter Turnout in the U.S. across multiple years

\includegraphics[width=0.8\textwidth,height=\textheight]{images/turnoutframe.png}

In this dataset, each row is an election year. Each column contains
information about the population, potential voters, or voter turnout.
These will help us compute the turnout rate in a given year. To work
with this dataset, we need to load it into R.

\hypertarget{working-with-datasets-in-r}{%
\subsection{Working with datasets in
R}\label{working-with-datasets-in-r}}

For a video explainer of the code in this section, see below. The video
only discusses the code. Use the notes and lecture discussion for
additional context. (Via youtube, you can speed up the playback to 1.5
or 2x speed.)

\url{https://www.youtube.com/watch?v=rm_g0rrglEQ}

Often the variables we care about are stored inside of rectangular
datasets

\begin{itemize}
\tightlist
\item
  These have a number of rows \texttt{nrow()} and columns
  \texttt{ncol()}
\item
  Each row is an ``observation,'' representing the information collected
  from an individual or entity
\item
  Each column is a variable, representing a changing characteristic
  across multiple observations
\end{itemize}

When we import a dataset into R, we have a few options.

Option 1: Download dataset to your computer

\begin{itemize}
\tightlist
\item
  Move the dataset to your working directory
\item
  Identify the file type (e.g., csv, dta, RData, txt)
\item
  Pick the appropriate R function to match the type (e.g.,
  \texttt{read.csv(),\ read.dta(),\ load(),\ read.table()})
\item
  Assign the dataset to an object. This object will now be
  \texttt{class()} of \texttt{data.frame}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{turnout }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"turnout.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Click here for an alternative function for csv files.

Some scholars prefer to use the function \texttt{read\_csv} to load csv
data. It is better at handling more complicated types of data. We will
not need to use this function in this course, but you may encounter it
elsewhere.

To use this function, the first time we will go about using it, we have
to first install a ``package'' called \texttt{readr}. Packages in R give
us additional tools beyond what the base version of R provides. It is
like installing an extra app on your phone.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"readr"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Once we have that installed, now anytime we want to use the function, we
will call (open) the ``readr'' package using \texttt{library()}, and
then the syntax is just like using the \texttt{read.csv} function.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(readr)}
\NormalTok{turnout }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\StringTok{"turnout.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Option 2: Read file from a url provided

\begin{itemize}
\tightlist
\item
  Need an active internet connection for this to work
\item
  URL generally must be public
\item
  Include the url inside the function used to read the data
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{turnout }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"https://raw.githubusercontent.com/ktmccabe/teachingdata/main/turnout.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(turnout)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "data.frame"
\end{verbatim}

You can also open up a window to view the data:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{View}\NormalTok{(turnout)}
\end{Highlighting}
\end{Shaded}

\hypertarget{measuring-the-turnout-in-the-us-elections}{%
\subsection{Measuring the Turnout in the US
Elections}\label{measuring-the-turnout-in-the-us-elections}}

Relevant questions with voter turnout

\begin{itemize}
\tightlist
\item
  What is a typical level of voter turnout?
\item
  Is turnout higher in presidential years or in midterm years?
\item
  Is turnout higher or lower based on voting-eligible (VEP) or
  voting-age (VAP) populations? We have a lot of people who are citizens
  18 and older who are ineligible to vote. This makes the VEP
  denominator smaller than the VAP.
\end{itemize}

Voter Turnout in the U.S.

\begin{itemize}
\tightlist
\item
  Numerator: \texttt{total}: Total votes cast (in thousands)
\item
  Denominator:

  \begin{itemize}
  \tightlist
  \item
    VAP: (voting-age population) from Census
  \item
    VEP (voting-eligible population) VEP = VAP + overseas voters -
    ineligible voters
  \end{itemize}
\item
  Additional Variables and Descriptions

  \begin{itemize}
  \tightlist
  \item
    \texttt{year}: election year
  \item
    \texttt{ANES}: ANES self-reported estimated turnout rate
  \item
    \texttt{VEP}: Voting Eligible Population (in thousands)
  \item
    \texttt{VAP}: Voting Age Population (in thousands)
  \item
    \texttt{total}: total ballots cast for highest office (in thousands)
  \item
    \texttt{felons}: total ineligible felons (in thousands)
  \item
    \texttt{noncitizens}: total non-citizens (in thousands)
  \item
    \texttt{overseas}: total eligible overseas voters (in thousands)
  \item
    \texttt{osvoters}: total ballots counted by overseas voters (in
    thousands)
  \end{itemize}
\end{itemize}

\hypertarget{getting-to-know-your-data}{%
\subsection{Getting to know your data}\label{getting-to-know-your-data}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# How many observations (the rows)?}
\FunctionTok{nrow}\NormalTok{(turnout)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 14
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# How many variables (the columns)?}
\FunctionTok{ncol}\NormalTok{(turnout)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 9
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# What are the variable names?}
\FunctionTok{names}\NormalTok{(turnout)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "year"     "VEP"      "VAP"      "total"    "ANES"     "felons"   "noncit"  
[8] "overseas" "osvoters"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Show the first six rows}
\FunctionTok{head}\NormalTok{(turnout)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  year    VEP    VAP total ANES felons noncit overseas osvoters
1 1980 159635 164445 86515   71    802   5756     1803       NA
2 1982 160467 166028 67616   60    960   6641     1982       NA
3 1984 167702 173995 92653   74   1165   7482     2361       NA
4 1986 170396 177922 64991   53   1367   8362     2216       NA
5 1988 173579 181955 91595   70   1594   9280     2257       NA
6 1990 176629 186159 67859   47   1901  10239     2659       NA
\end{verbatim}

Extract a particular column (vector) from the data using the \$.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{turnout}\SpecialCharTok{$}\NormalTok{year}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] 1980 1982 1984 1986 1988 1990 1992 1994 1996 1998 2000 2002 2004 2008
\end{verbatim}

Extract the 10th year. Just like before! We use 10 to indicate the value
of the \texttt{year} column in position (row 10) of the data.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{turnout}\SpecialCharTok{$}\NormalTok{year[}\DecValTok{10}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1998
\end{verbatim}

We can take the \texttt{mean()} of a particular column, too. Let's take
it of the total number of voters.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(turnout}\SpecialCharTok{$}\NormalTok{total)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 89778.29
\end{verbatim}

And get the \texttt{class()} (Note: integer is just a type of numeric
variable)

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(turnout}\SpecialCharTok{$}\NormalTok{total)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "integer"
\end{verbatim}

We can also use brackets in the full data frame, but because our data
frame has BOTH rows and columns, we cannot just supply one position
\texttt{i}. Instead, we have to tell R which row AND which column by
using a comma between the positions.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{turnout[}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{] }\CommentTok{\# value in row 1, column 2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 159635
\end{verbatim}

We can use the column name instead

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{turnout[}\DecValTok{1}\NormalTok{, }\StringTok{"VEP"}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 159635
\end{verbatim}

If we leave the second entry blank, it will return all columns for the
specified row

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{turnout[}\DecValTok{1}\NormalTok{,] }\CommentTok{\# All variable values for row 1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  year    VEP    VAP total ANES felons noncit overseas osvoters
1 1980 159635 164445 86515   71    802   5756     1803       NA
\end{verbatim}

The opposite is true if we leave the first entry blank.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{turnout[,}\DecValTok{2}\NormalTok{] }\CommentTok{\# VEP for all rows}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] 159635 160467 167702 170396 173579 176629 179656 182623 186347 190420
[11] 194331 198382 203483 213314
\end{verbatim}

\hypertarget{comparing-vep-and-vap-turnout}{%
\section{Comparing VEP and VAP
turnout}\label{comparing-vep-and-vap-turnout}}

\hypertarget{creating-new-variables-in-r}{%
\subsection{Creating new variables in
R}\label{creating-new-variables-in-r}}

Let's create a new variable that is VAP that adds overseas voters.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Use $ to add a new variable (i.e., column) to a dataframe}
\NormalTok{turnout}\SpecialCharTok{$}\NormalTok{VAPplusoverseas }\OtherTok{\textless{}{-}}\NormalTok{ turnout}\SpecialCharTok{$}\NormalTok{VAP }\SpecialCharTok{+}\NormalTok{ turnout}\SpecialCharTok{$}\NormalTok{overseas}
\end{Highlighting}
\end{Shaded}

Under the hood, what this is doing is taking each value of
\texttt{turnout\$VAP} and adding it to its corresponding values of
\texttt{turnout\$overseas}.

And, yes, this new variable shows up as a new column in
\texttt{turnout}. Go ahead, \texttt{View()} it

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{View}\NormalTok{(turnout)}
\end{Highlighting}
\end{Shaded}

This does not change the underlying \texttt{turnout.csv} file, only the
\texttt{turnout\ data.frame} we are working with in the current R
session.

\begin{itemize}
\tightlist
\item
  This is an advantage of using an R script.
\item
  You don't have to worry about overwriting/messing up the raw data.
\item
  You start from the original raw data when you load
  \texttt{turnout.csv}, and then everything else is done within R.
\end{itemize}

This is our new denominator. Now we can calculate turnout based on this
denominator.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{turnout}\SpecialCharTok{$}\NormalTok{newVAPturnout }\OtherTok{\textless{}{-}}\NormalTok{ turnout}\SpecialCharTok{$}\NormalTok{total }\SpecialCharTok{/}\NormalTok{ turnout}\SpecialCharTok{$}\NormalTok{VAPplusoverseas}
\end{Highlighting}
\end{Shaded}

Just like with adding two vectors, when we divide, each value in the
first vector is divided by its corresponding value in the second vector.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{turnout}\SpecialCharTok{$}\NormalTok{newVAPturnout}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] 0.5203972 0.4024522 0.5253748 0.3607845 0.4972260 0.3593884 0.5404097
 [8] 0.3803086 0.4753376 0.3483169 0.4934211 0.3582850 0.5454777 0.5567409
\end{verbatim}

Let's calculate the VEP turnout rate and turn it into a percentage. This
time, we do it in one step.

\begin{itemize}
\tightlist
\item
  (total votes / VEP) \(\times\) 100:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{turnout}\SpecialCharTok{$}\NormalTok{newVEPturnout }\OtherTok{\textless{}{-}}\NormalTok{ (turnout}\SpecialCharTok{$}\NormalTok{total }\SpecialCharTok{/}\NormalTok{ turnout}\SpecialCharTok{$}\NormalTok{VEP) }\SpecialCharTok{*} \DecValTok{100}
\NormalTok{turnout}\SpecialCharTok{$}\NormalTok{newVEPturnout}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] 54.19551 42.13701 55.24860 38.14115 52.76848 38.41895 58.11384 41.12625
 [9] 51.65793 38.09316 54.22449 39.51064 60.10084 61.55433
\end{verbatim}

Let's change it from a proportion to a percentage. How? Multiply each
value of \texttt{turnout\$newVAP} by 100

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{turnout}\SpecialCharTok{$}\NormalTok{newVAPturnout }\OtherTok{\textless{}{-}}\NormalTok{ turnout}\SpecialCharTok{$}\NormalTok{newVAPturnout }\SpecialCharTok{*} \DecValTok{100}
\end{Highlighting}
\end{Shaded}

This multiplies each number within the vector by 100.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{turnout}\SpecialCharTok{$}\NormalTok{newVAPturnout}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] 52.03972 40.24522 52.53748 36.07845 49.72260 35.93884 54.04097 38.03086
 [9] 47.53376 34.83169 49.34211 35.82850 54.54777 55.67409
\end{verbatim}

What is typical turnout?

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(turnout}\SpecialCharTok{$}\NormalTok{newVAPturnout)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 45.45658
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(turnout}\SpecialCharTok{$}\NormalTok{newVEPturnout)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 48.94937
\end{verbatim}

We find that turnout based on the voting age population is lower than
turnout based on the voting eligible population. This is a pattern that
political scientists have examined, going back several decades. For
example, in a 2001 article McDonald and Popkin show that is it the
ineligible population that grew from the 1970s onward and not the
population of people who simply prefer not to vote. (See more
\href{https://www.jstor.org/stable/3117725}{here}.)

\begin{figure}

{\centering \includegraphics{images/VEP.png}

}

\caption{McDonald and Popkin 2001}

\end{figure}

\hypertarget{comparing-presidential-vs.-midterm-turnout}{%
\section{Comparing Presidential vs.~Midterm
turnout}\label{comparing-presidential-vs.-midterm-turnout}}

How does turnout compare in presidential vs.~midterm years? Sometimes
using a single summary of turnout may obscure important underlying
differences in the data. To detect these differences, we may want to
summarize different parts of the data.

Oh dear. We need to extract specific years from the turnout data frame.
Which rows contain the years we want?

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{turnout}\SpecialCharTok{$}\NormalTok{year}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] 1980 1982 1984 1986 1988 1990 1992 1994 1996 1998 2000 2002 2004 2008
\end{verbatim}

Ok: rows 1,3,5,7,9,11,13,14 are the presidential. And rows 2,4,6,8,10,12
are midterms.

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# we can extract all of these at once by using c()}
\NormalTok{turnout}\SpecialCharTok{$}\NormalTok{year[}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{5}\NormalTok{,}\DecValTok{7}\NormalTok{,}\DecValTok{9}\NormalTok{,}\DecValTok{11}\NormalTok{,}\DecValTok{13}\NormalTok{,}\DecValTok{14}\NormalTok{)] }\CommentTok{\# presidential}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1980 1984 1988 1992 1996 2000 2004 2008
\end{verbatim}

Let's take the mean VEP turnout for presidential years.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(turnout}\SpecialCharTok{$}\NormalTok{newVEPturnout[}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{5}\NormalTok{,}\DecValTok{7}\NormalTok{,}\DecValTok{9}\NormalTok{,}\DecValTok{11}\NormalTok{,}\DecValTok{13}\NormalTok{,}\DecValTok{14}\NormalTok{)])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 55.983
\end{verbatim}

Let's take the mean VEP turnout for midterm years.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(turnout}\SpecialCharTok{$}\NormalTok{newVEPturnout[}\FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{6}\NormalTok{,}\DecValTok{8}\NormalTok{,}\DecValTok{10}\NormalTok{,}\DecValTok{12}\NormalTok{)])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 39.5712
\end{verbatim}

Let's take the difference by storing each mean and then subtracting

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mean.VEP.pres }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(turnout}\SpecialCharTok{$}\NormalTok{newVEPturnout[}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{5}\NormalTok{,}\DecValTok{7}\NormalTok{,}\DecValTok{9}\NormalTok{,}\DecValTok{11}\NormalTok{,}\DecValTok{13}\NormalTok{,}\DecValTok{14}\NormalTok{)])}
\NormalTok{mean.VEP.mid }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(turnout}\SpecialCharTok{$}\NormalTok{newVEPturnout[}\FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{6}\NormalTok{,}\DecValTok{8}\NormalTok{,}\DecValTok{10}\NormalTok{,}\DecValTok{12}\NormalTok{)])}
\NormalTok{mean.VEP.pres }\SpecialCharTok{{-}}\NormalTok{  mean.VEP.mid}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 16.41181
\end{verbatim}

Presidential turnout, on average, is higher than midterm turnout.

\hypertarget{r-shortcut-for-writing-vectors}{%
\subsection{R shortcut for writing
vectors}\label{r-shortcut-for-writing-vectors}}

Sometimes we write numbers that are in a predictable sequence (e.g.,
1,2,3,4,5). In R, we have functions that prevent us from having to type
each number when this is the case.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{5}\NormalTok{) }\CommentTok{\# is equivalent to:}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1 2 3 4 5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{1}\SpecialCharTok{:}\DecValTok{5} \CommentTok{\# is equivalent to:}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1 2 3 4 5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{seq}\NormalTok{(}\AttributeTok{from =} \DecValTok{1}\NormalTok{, }\AttributeTok{to =} \DecValTok{5}\NormalTok{, }\AttributeTok{by =} \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1 2 3 4 5
\end{verbatim}

We can use the last one to our advantage to extract the midterm years,
which go by 2

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(turnout}\SpecialCharTok{$}\NormalTok{newVEPturnout[}\FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{,}\DecValTok{4}\NormalTok{,}\DecValTok{6}\NormalTok{,}\DecValTok{8}\NormalTok{,}\DecValTok{10}\NormalTok{,}\DecValTok{12}\NormalTok{)]) }\CommentTok{\# is the same as}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 39.5712
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(turnout}\SpecialCharTok{$}\NormalTok{newVEPturnout[}\FunctionTok{seq}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{12}\NormalTok{, }\DecValTok{2}\NormalTok{)])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 39.5712
\end{verbatim}

Not a big deal now, but imagine if you had to write 100 numbers or 1
MILLION NUMBERS!

\hypertarget{creating-dataframes-from-within-r}{%
\section{Creating dataframes from within
R}\label{creating-dataframes-from-within-r}}

While importing data from outside of R is the most common way to work
with dataframes in R, you can also create dataframes from inside R.
Ultimately, a dataframe just binds together multiple vectors / columns
to create a rectangular object.

For example, let's say we want to create a dataframe with columns
indicating just the midterm years and their VEP turnout. These
correspond to the two vectors:

\begin{itemize}
\tightlist
\item
  \texttt{turnout\$newVEPturnout{[}seq(2,\ 12,\ 2){]}}
\item
  \texttt{turnout\$year{[}seq(2,\ 12,\ 2){]}}
\end{itemize}

In R, you can create a rectangular \texttt{data.frame} object with the
\texttt{data.frame} function.

\begin{itemize}
\tightlist
\item
  Within this function, you can make several entries that follow the
  syntax \texttt{colname\ =\ values}. We supply what we would like the
  name of the column to be, such as \texttt{midyear}, and then provide R
  with a set of values. We can then provide a comma and add more
  columns.

  \begin{itemize}
  \tightlist
  \item
    You just want to make sure each column has the same number of
    values.
  \end{itemize}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{midtermdata }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{midyear =}\NormalTok{ turnout}\SpecialCharTok{$}\NormalTok{year[}\FunctionTok{seq}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{12}\NormalTok{, }\DecValTok{2}\NormalTok{)], }
                          \AttributeTok{VEPturnout =}\NormalTok{ turnout}\SpecialCharTok{$}\NormalTok{newVEPturnout[}\FunctionTok{seq}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{12}\NormalTok{, }\DecValTok{2}\NormalTok{)])}
\end{Highlighting}
\end{Shaded}

You can supply the values for each column using objects or just vectors
of raw numeric values like the below:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{midtermdata }\OtherTok{\textless{}{-}} \FunctionTok{data.frame}\NormalTok{(}\AttributeTok{midyear =} \FunctionTok{c}\NormalTok{(}\DecValTok{1982}\NormalTok{, }\DecValTok{1986}\NormalTok{, }\DecValTok{1990}\NormalTok{, }\DecValTok{1994}\NormalTok{, }\DecValTok{1998}\NormalTok{, }\DecValTok{2002}\NormalTok{), }
                          \AttributeTok{VEPturnout =} \FunctionTok{c}\NormalTok{(}\FloatTok{42.13701}\NormalTok{, }\FloatTok{38.14115}\NormalTok{, }\FloatTok{38.41895}\NormalTok{, }\FloatTok{41.12625}\NormalTok{, }\FloatTok{38.09316}\NormalTok{, }\FloatTok{39.51064}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

The result is a nice rectangular dataframe similar to what we loaded
using the \texttt{turnout.csv} dataset from outside of R.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{midtermdata}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  midyear VEPturnout
1    1982   42.13701
2    1986   38.14115
3    1990   38.41895
4    1994   41.12625
5    1998   38.09316
6    2002   39.51064
\end{verbatim}

Now, because our dataframe has a different name. If we want to access
columns from this dataframe, we start with \texttt{midterm\$} followed
by the variable name.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{midtermdata}\SpecialCharTok{$}\NormalTok{midyear}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1982 1986 1990 1994 1998 2002
\end{verbatim}

\hypertarget{wrapping-up-description}{%
\section{Wrapping Up Description}\label{wrapping-up-description}}

In this section, we have described voter turnout using multiple measures
and types of elections. There are several other questions that political
scientists may be interested in when it comes to voter turnout.

For example, during and following the 2020 elections, many states passed
laws that changed election procedures: Ability to vote by mail, Ballot
dropboxes, Length of early voting. What else?

\begin{itemize}
\tightlist
\item
  What effect (if any) do these laws have on voter turnout?
\end{itemize}

In the next section, we start to examine how to evaluate causal claims.

\hypertarget{summary-of-r-tools}{%
\subsection{Summary of R tools}\label{summary-of-r-tools}}

We have touched on a number of R tools thus far. Here is a summary of
some of the key items to remember going forward:

\begin{itemize}
\tightlist
\item
  \texttt{setwd()}: sets the working directory in R, which tells R which
  folder on your computer contains the datasets or other R files where
  you will be working. You should get into the habit of setting your
  working directory each time you work in RStudio.

  \begin{itemize}
  \tightlist
  \item
    Can set this in the toolbar Session -\textgreater{} Set Working
    Directory -\textgreater{} Choose Directory, followed by clicking the
    ``Open'' button on the folder where you want to work.
  \item
    Example: \texttt{setwd("\textasciitilde{}/Downloads/Data\ Science")}
  \end{itemize}
\item
  \texttt{\#\#}: Hashtags are used to help annotate your code. Anything
  behind a hashtag is treated as plain text
\item
  \texttt{+\ -\ *\ /}: These are some of the mathematical operators you
  can use in R

  \begin{itemize}
  \tightlist
  \item
    You can also control which operations are performed first using
    \texttt{()} just like you would do with math outside of R. For
    example, try to compare the answer to \texttt{6\ +\ 4\ *\ 3} with
    \texttt{(6\ +\ 4)\ *\ 3}
  \end{itemize}
\item
  \texttt{\textless{}-}: This is an assignment tool that allows us to
  store calculations, vectors, datasets, and more as \emph{objects} in
  R.

  \begin{itemize}
  \tightlist
  \item
    Example: \texttt{sum53\ \textless{}-\ 5\ +\ 3} creates an object
    called \texttt{sum53} that stores the calculation on the right.
  \end{itemize}
\item
  \texttt{{[}{]}}: Brackets are used to extract specific components of
  objects we create. The number(s) inside the brackets tell us which
  entries to extract.

  \begin{itemize}
  \tightlist
  \item
    Example: \texttt{Outcome{[}2{]}} will tell us to extract the second
    entry in the object \texttt{Outcome}
  \item
    Note: when we use datasets, the brackets will have two entries, one
    corresponding to the row entry and one corresponding to the column.
    Example \texttt{turnout{[}1,2{]}} means the entry in the first row
    and second column.
  \end{itemize}
\end{itemize}

\emph{Functions} We have already started using a number of
\emph{functions} in R, which are operations we ask R to do for us, such
as creating vectors, importing data, or summarizing data by finding the
mean, range, etc. Functions come in the same format, which starts with
the function name followed by parentheses. Example: \texttt{mean()}.
Each function then takes a particular input(s). When you ``run'' a line
of code with a function, R applies the function to the input.

\begin{itemize}
\tightlist
\item
  \texttt{c()}: This is a function that combines a set of values into a
  vector in R. The values can be numbers or text items and should be
  separated by commas. If text, each text item should be in quotation
  marks.

  \begin{itemize}
  \tightlist
  \item
    Example: \texttt{Outcome\ \textless{}-\ c(3,\ 4,\ 6,\ 2,\ 1)}
  \item
    Example: \texttt{People\ \textless{}-\ c("Sam",\ "Julie",\ "Mark")}
  \end{itemize}
\item
  \texttt{mean()}, \texttt{median()}, \texttt{min()}, \texttt{max()},
  \texttt{range()}: These functions summarize vectors that are
  numeric/integers in nature.

  \begin{itemize}
  \tightlist
  \item
    Example \texttt{mean(Outcome)} takes the average of the values in
    the \texttt{Outcome} vector
  \end{itemize}
\item
  \texttt{read.csv()}: This function loads a rectangular .csv file into
  R as a data.frame

  \begin{itemize}
  \tightlist
  \item
    Example: \texttt{turnout\ \textless{}-\ read.csv("turnout.csv")}
  \item
    Not all datasets will be .csv files. In the future, we will use
    other functions, such as \texttt{load()} or \texttt{read.dta()} to
    import datasets of different file types.
  \end{itemize}
\end{itemize}

\emph{Dataframes}

We have started working with dataframes in R. These objects are
rectangular datasets that include a collection of vectors. Every column
in a dataframe generally represents a different concept or ``variable,''
while each row represents a different unit or ``observation.''

\begin{itemize}
\tightlist
\item
  \texttt{\$}: When we are working with vectors that are inside of a
  dataframe (the columns inside of a dataframe), we use the \texttt{\$}
  to access them.

  \begin{itemize}
  \tightlist
  \item
    Example: \texttt{turnout\$year} will show us the values in the
    \texttt{year} column vector inside our \texttt{turnout} rectangular
    dataframe
  \end{itemize}
\item
  \texttt{nrow()}, \texttt{ncol()}, \texttt{dim()}, \texttt{head()},
  \texttt{names()}: These functions help us explore the dataframes by
  telling us the number of rows and columns (the dimensions), giving us
  a sneak peek of the first 6 rows of the dataframe, or showing us the
  names of the variables (columns) in the data.

  \begin{itemize}
  \tightlist
  \item
    Example: \texttt{nrow(turnout)}
  \end{itemize}
\end{itemize}

\bookmarksetup{startatroot}

\hypertarget{causation1}{%
\chapter{Causation with Experiments}\label{causation1}}

Recall that we said, four primary goals of social science include:

\begin{itemize}
\tightlist
\item
  \textbf{Describe} and measure

  \begin{itemize}
  \tightlist
  \item
    Has the U.S. population increased?
  \end{itemize}
\item
  \textbf{Explain}, evaluate, and recommend (study of causation)

  \begin{itemize}
  \tightlist
  \item
    Does expanding Medicaid improve health outcomes?
  \end{itemize}
\item
  \textbf{Predict}

  \begin{itemize}
  \tightlist
  \item
    Who will win the next election?
  \end{itemize}
\item
  \textbf{Discover}

  \begin{itemize}
  \tightlist
  \item
    How do policies diffuse across states?
  \end{itemize}
\end{itemize}

In this section, we start to explore the goal of explanation--making
causal claims.

\hypertarget{what-separates-causation-from-correlation}{%
\section{What separates causation from
correlation?}\label{what-separates-causation-from-correlation}}

Here's an example. In 2016, researchers at the
\href{https://www.nytimes.com/interactive/2016/12/26/upshot/duck-dynasty-vs-modern-family-television-maps.html}{NY
Times} noticed that areas in the country where the television show
\emph{Duck Dynasty} was popular also tended to support Donald Trump at
higher rates.

\includegraphics{images/duckdynasty.png}

If we put our social scientist hat on, we might want to distinguish
whether this is a causal or, more likely, just a correlational
relationship:

\begin{itemize}
\tightlist
\item
  Correlation: Areas that watch Duck Dynasty are more likely to support
  Trump (degree to which two variables ``move together'')
\item
  Causality: Watching Duck Dynasty (vs.~not watching) increases your
  support of Trump.
\end{itemize}

Causal Question: Does the manipulation of one factor (the treatment),
(holding everything else constant), cause a change in an outcome?

\hypertarget{potential-outcomes-framework}{%
\subsection{Potential Outcomes
Framework}\label{potential-outcomes-framework}}

When studying causal relationships, we distinguish two concepts:

\begin{itemize}
\tightlist
\item
  treatment: variable whose change may produce a change in the outcome
  (e.g., watching vs.~not watching \emph{Duck Dynasty})
\item
  outcome (\(Y\)): what may change as a result (e.g., their support for
  Trump)
\end{itemize}

We imagine two states of the world or ``potential outcomes.''

\begin{itemize}
\tightlist
\item
  \(Y(1)\): the outcome if the treatment is administered (e.g., watching
  the show)
\item
  \(Y(0)\): the outcome if the treatment is NOT administered or maybe
  something else is (e.g., not watching the show)
\end{itemize}

Political Science Example: How does voter turnout (\(Y\)) change as a
result of varying whether someone receives a mail-in ballot (the
treatment)?

\begin{itemize}
\tightlist
\item
  \(Y(\text{sent a mail-in ballot})\): do you vote or not
\item
  \(Y(\text{not sent a mail-in ballot})\): do you vote or not
\end{itemize}

We compare your likelihood of turning out to vote in a world where you
did receive a mail-in ballot vs.~a counterfactual state of the world in
which you did not receive a mail-in ballot, generally assuming that this
is the only thing that is different between these two potential states
of the world.

In many cases in social science, we might start by observing some
connection in the real world. To make a causal claim, we then have to
imagine what that counterfactual state of the world would be. Examples:

Causal Question: Does the minimum wage increase the unemployment rate?

\begin{itemize}
\tightlist
\item
  (Hypothetical) Factual: An unemployment rate went up after the minimum
  wage increased
\item
  Implied Counterfactual: Would the unemployment rate have gone up, had
  the minimum wage increase not occurred?
\end{itemize}

Causal Question: Does the gender of a political messenger influence the
persuasiveness of the message?

\begin{itemize}
\tightlist
\item
  (Hypothetical) Factual: Suppose a political messenger perceived as a
  man had a somewhat persuasive effect delivering a message on abortion.
\item
  Implied Counterfactual: Would a political messenger perceived as a
  woman have a similar or different persuasive effect?
\end{itemize}

We use causal logic all of the time outside of social science.

For example, many viewers get angry after watching the movie
\href{https://www.youtube.com/watch?v=3gK_2XdjOdY}{\emph{Titanic}}
because they believe Jack did not have to die. We can place their claims
in our causal framework:

\includegraphics{images/titanicdoor.jpeg}

\begin{itemize}
\tightlist
\item
  Outcome: Jack Surviving the Titanic
\item
  Potential Outcomes in two states of the world

  \begin{itemize}
  \tightlist
  \item
    Rose did not share the floating door, and Jack died.
  \item
    Counterfactual question: If Rose had shared the floating door, would
    Jack have lived?
  \end{itemize}
\end{itemize}

In
\href{https://www.bitbybitbook.com/en/1st-ed/running-experiments/}{\emph{Bit
by Bit}}, Matt Salganik notes that sometimes cause-and-effect questions
are implicit. For example, in more general questions about maximization
of some performance metric, we might want to compare several
alternatives:

The question ``What color should the donate button be on an NGO's
website?'' is really lots of questions about the effect of different
button colors on donations.

\begin{itemize}
\tightlist
\item
  Factual: A voter donates some amount with a black button
\item
  Counterfactual: What would a voter donate if the button were blue?
\item
  Counterfactual: What would a voter donate if the button were red?
\end{itemize}

What other causal questions might social scientists or data scientists
ask?

\hypertarget{causal-effects}{%
\subsection{Causal Effects}\label{causal-effects}}

When we are conducting a causal analysis, we will want to estimate a
causal effect.

\begin{itemize}
\tightlist
\item
  Causal effects are all about ideal comparisons between treated
  vs.~untreated
\end{itemize}

A causal effect is the change in the outcome Y that is caused by a
change in the treatment variable.

\begin{itemize}
\tightlist
\item
  \(Y(1) - Y(0)\) = causal effect or ``treatment effect''
\item
  e.g., Donation if contacted - Donation if not contacted
\end{itemize}

We often want to know the \textbf{average treatment effect} in some
population, not just the causal effect for a single individual. Here, we
might ask, on average, how much would our outcome change if our units
were treated instead of untreated. To do so, we simply sum up all of the
causal effects and divide them by the number of units in our population.

\begin{itemize}
\tightlist
\item
  \(\frac{1}{N} \sum_{i=1}^N (Y_i (1)-Y_i (0))\) = ``average treatment
  effect'' (ATE)

  \begin{itemize}
  \tightlist
  \item
    e.g., Average donations if contacted - Average donations if not
    contacted
  \end{itemize}
\end{itemize}

Note: If the math above is helpful, you can use it. If it is difficult
to read, focus on the plain language definitions that go before it. The
notation here is less important than the conceptual understanding.

\hypertarget{fundamental-problem-of-causal-inference}{%
\subsection{Fundamental Problem of Causal
Inference}\label{fundamental-problem-of-causal-inference}}

The problem: Fundamental Problem of Causal Inference

What makes the evaluation of causal claims difficult, is that in the
real world, we suffer from the fundamental problem of causal inference:

\begin{itemize}
\tightlist
\item
  For any individual, we only get to see (observe) the result from one
  state of the world

  \begin{itemize}
  \tightlist
  \item
    This makes that subtraction of potential outcomes impossible.
  \end{itemize}
\end{itemize}

(Unless we are in
\href{https://www.youtube.com/watch?v=5E0M6Rh9qpg}{Groundhog Day})

\hypertarget{randomized-controlled-trials}{%
\section{Randomized Controlled
Trials}\label{randomized-controlled-trials}}

One approach for addressing the fundamental problem of causal inference
is to simulate two potential states of the world through random
assignment: Randomized Controlled Trials / Experiments

Experiments approximate an ideal factual vs.~counterfactual comparison

\begin{itemize}
\tightlist
\item
  We randomly assign one group to receive a ``treatment'' and another
  not to receive a treatment (the control)

  \begin{itemize}
  \tightlist
  \item
    There can be more than two groups. The key is that each group varies
    (is manipulated) in some way.
  \end{itemize}
\item
  When treatment assignment is \textbf{randomized}, the only thing that
  distinguishes the treatment group from the control group, besides the
  treatment itself, is chance.
\end{itemize}

\begin{figure}

{\centering \includegraphics{images/betweensub.png}

}

\caption{Salganik Bit by Bit Chapter 4.4}

\end{figure}

This allows us to compare the average outcomes between groups in order
to estimate our causal effects (more on this below).

\hypertarget{experiments-why-randomize}{%
\subsection{Experiments: Why
Randomize?}\label{experiments-why-randomize}}

Randomization is essential for being able to \emph{identify} and
\emph{isolate} the causal effect of the treatment on the outcome.

Without randomization, there may be several reasons why two groups
differ beyond the treatment of interest.

\begin{itemize}
\tightlist
\item
  For example, if we randomly assigned half of Rutgers seniors to go to
  a Sabrina Carpenter concert and half to go to a Bruce Springsteen
  concert we would expect the groups to have about equal proportions of
  female students, average age, racial composition, majors, etc.

  \begin{itemize}
  \tightlist
  \item
    (If we didn't randomly assign, and just let people ``select'' into
    watching a particular concert, the groups could look very
    different.)
  \end{itemize}
\end{itemize}

But because we randomized assignment, on average, we'd expect the two
groups to be identical except for the treatment-- in this case, which
concert they attended.

\begin{itemize}
\tightlist
\item
  Great news! This means any differences in the outcomes between the two
  groups can be attributed to the treatment. So if we wanted to see if
  going to a Bruce Springsteen show leads people to hold more favorable
  opinions of New Jersey, we could compare the average attitudes toward
  NJ among seniors who attended the show vs.~attended the Carpenter
  show.
\end{itemize}

\hypertarget{experiments-how-to-analyze}{%
\subsection{Experiments: How to
Analyze}\label{experiments-how-to-analyze}}

Difference in Means: We compare each group's average outcome by
subtracting one from the other to estimate the average treatment effect
(ATE) aka the average causal effect of the treatment.

\begin{itemize}
\tightlist
\item
  \(\widehat{ATE} = \bar{Y}(treatment) - \bar{Y}(control)\)
\end{itemize}

This is an estimate of, on average, how much our outcome would change if
units went from being untreated to treated.

\begin{itemize}
\tightlist
\item
  E.g., on average how much a person donates to a campaign if contacted
  by phone compared to if not contacted by phone.
\end{itemize}

\hypertarget{ingredients-of-an-experiment}{%
\subsection{Ingredients of an
Experiment}\label{ingredients-of-an-experiment}}

From
\href{https://www.bitbybitbook.com/en/1st-ed/running-experiments/}{\emph{Bit
by Bit}}

\includegraphics{images/bitbybitexp.png}

For every experiment, you should be able to

\begin{itemize}
\tightlist
\item
  State the causal question or relationship of interest
\item
  Describe how the experiment will be implemented (e.g., recruitment of
  subjects)
\item
  Identify and describe the randomization into treatment group(s) and
  control group and what happens in each group
\item
  Identify the outcome of interest, how it is measured
\item
  Evaluate the relevant comparison (between two different experimental
  conditions)
\end{itemize}

We will turn to an example in the next section.

\hypertarget{application-is-there-racial-discrimination-in-the-labor-market}{%
\section{Application: Is there racial discrimination in the labor
market?}\label{application-is-there-racial-discrimination-in-the-labor-market}}

Marianne Bertrand and Sendhil Mullainathan. 2004. ``Are Emily and Greg
more employable than Lakisha and Jamal? A field experiment on labor
market discrimination.''

``We perform a field experiment to measure racial discrimination in the
labor market. We respond with fictitious resumes to help-wanted ads in
Boston and Chicago newspapers.''

\begin{itemize}
\tightlist
\item
  Recruitment: Construct resumes to send to ads
\item
  Randomization: To manipulate perception of race, each resume is
  (randomly) assigned
\item
  Treatment: either a very African American sounding name
\item
  Control: or a very White sounding name
\item
  Outcome: Does the resume receive a callback?
\item
  Comparison: Callback rates for African American (sounding) names
  vs.~White (sounding) names (the difference in means between groups)
\end{itemize}

\emph{For a video explainer of the code in this section, see below. The
video only discusses the code. Use the notes and lecture discussion for
additional context. (Via youtube, you can speed up the playback to 1.5
or 2x speed.)}

\url{https://www.youtube.com/watch?v=LeJkRydMruM}

Let's load the data. Note: When we have variables that are text-based
categories, we may want to tell R to treat these ``strings'' of text
information as factor variables, a particular type of variable that
represents data as a set of nominal (unordered) or ordinal (ordered)
categories. We do this with the \texttt{stringsAsFactors} argument.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resume }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"resume.csv"}\NormalTok{, }\AttributeTok{stringsAsFactors =}\NormalTok{ T)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resume }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"https://raw.githubusercontent.com/ktmccabe/teachingdata/main/resume.csv"}\NormalTok{,}
                   \AttributeTok{stringsAsFactors =}\NormalTok{ T)}
\end{Highlighting}
\end{Shaded}

Variables and Description

\begin{itemize}
\tightlist
\item
  \texttt{firstname}: first name of the fictitious job applicant
\item
  \texttt{sex}: sex of applicant (female or male)
\item
  \texttt{race}: race of applicant (black or white)
\item
  \texttt{call}: whether a callback was made (1 = yes, 0 = no)
\end{itemize}

The data contain 4870 resumes and 4 variables.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{nrow}\NormalTok{(resume) }\CommentTok{\# number of rows}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 4870
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ncol}\NormalTok{(resume) }\CommentTok{\# number of columns}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dim}\NormalTok{(resume) }\CommentTok{\# number of rows and columns}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 4870    4
\end{verbatim}

Note: These data look a little different from what we used last week.
For example, the \texttt{sex} and \texttt{race} variables contain words,
not numbers.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(resume)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  firstname    sex  race call
1   Allison female white    0
2   Kristen female white    0
3   Lakisha female black    0
4   Latonya female black    0
5    Carrie female white    0
6       Jay   male white    0
\end{verbatim}

\hypertarget{variable-classes}{%
\subsection{Variable classes}\label{variable-classes}}

We can check the class of each variable: Look, we have a new type, a
``factor'' variable.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(resume}\SpecialCharTok{$}\NormalTok{firstname)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "factor"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(resume}\SpecialCharTok{$}\NormalTok{sex)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "factor"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(resume}\SpecialCharTok{$}\NormalTok{race)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "factor"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(resume}\SpecialCharTok{$}\NormalTok{call)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "integer"
\end{verbatim}

We have now encountered \texttt{numeric,\ character}, and
\texttt{factor} vectors and/or variables in R. Note: This is simply how
R understands them. Sometimes R can get it wrong. For example, if we
write:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{somenumbers }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"1"}\NormalTok{, }\StringTok{"3"}\NormalTok{, }\StringTok{"4"}\NormalTok{)}
\FunctionTok{class}\NormalTok{(somenumbers)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "character"
\end{verbatim}

Because we put our numbers in quotation marks, R thinks the values in
\texttt{somenumbers} are text. The number ``3'' might as well be the
word ``blue'' for all R knows. Fortunately, we can easily switch between
classes.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{somenumbers }\OtherTok{\textless{}{-}} \FunctionTok{as.numeric}\NormalTok{(somenumbers)}
\FunctionTok{class}\NormalTok{(somenumbers)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "numeric"
\end{verbatim}

Here, we used \texttt{as.numeric()} to overwrite and change the
character vector into a numeric vector.

Rules of Thumb

\begin{itemize}
\tightlist
\item
  Usually, we want \texttt{character} variables to store text (e.g.,
  open-ended survey responses)
\item
  We want \texttt{numeric} variables to store numbers.
\item
  Usually, we want \texttt{factor} variables to store categories.

  \begin{itemize}
  \tightlist
  \item
    Within R, factor variables assign a number to each category, which
    is given a label or \texttt{level} in the form of text.
  \item
    Categories might be ordinal or ``ordered'' (e.g., Very likely,
    Somewhat likely, Not likely) or
  \item
    Unordered (e.g., ``male'', ``female'')
  \item
    R won't know if a factor variable is ordered or unordered. Alas, we
    have to be smarter than R.
  \item
    R might think you have a character variable when you want it to be a
    factor or the reverse.

    \begin{itemize}
    \tightlist
    \item
      That's when \texttt{as.factor()} and \texttt{as.character()} are
      useful.
    \end{itemize}
  \end{itemize}
\item
  Always check \texttt{class()} to find out the variable type
\end{itemize}

\hypertarget{making-tables}{%
\section{Making tables}\label{making-tables}}

A nice thing about numeric and factor variables is we can use the
\texttt{table} command to see how many observations in our data fall
into each category or numerical value.

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Example: how many black vs. white sounding resumes}
\FunctionTok{table}\NormalTok{(resume}\SpecialCharTok{$}\NormalTok{race)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}

black white 
 2435  2435 
\end{verbatim}

As mentioned, \texttt{factor} variables have levels:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{levels}\NormalTok{(resume}\SpecialCharTok{$}\NormalTok{race)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "black" "white"
\end{verbatim}

\hypertarget{crosstabulation}{%
\subsection{Crosstabulation}\label{crosstabulation}}

We can also use the \texttt{table} command to show a crosstabulation: a
table that displays the frequency of observations across two variables.

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Example: how many black vs. white sounding resumes by call backs}
\DocumentationTok{\#\# We can label the two dimensions of the table with the =}
\FunctionTok{table}\NormalTok{(}\AttributeTok{calledback =}\NormalTok{ resume}\SpecialCharTok{$}\NormalTok{call, }\AttributeTok{race =}\NormalTok{ resume}\SpecialCharTok{$}\NormalTok{race)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
          race
calledback black white
         0  2278  2200
         1   157   235
\end{verbatim}

\hypertarget{conditional-means}{%
\section{Conditional Means}\label{conditional-means}}

Recall how to take a mean of a variable in our data. For example, let's
take the mean of the variable \texttt{call}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(resume}\SpecialCharTok{$}\NormalTok{call)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0.08049281
\end{verbatim}

This gives us the average callbacks (or callback rate) for everyone in
our data. In experiments, we want to take the mean for a specific group
within our data-- the treatment group, and then the mean for the control
group.

Somehow, we have to identify, within our data, which rows were part of
the treatment group and which were a part of the control group. In this
study, we want to identify resumes with an assigned name perceived to be
black vs.~perceived to be white. This is in our \texttt{race} variable.

We will cover a couple of tools to do this, with the first being
\texttt{tapply}.

To find how the average of one variable (e.g., our outcome- the callback
rate) varies across different categories of our factor variable, we use
\texttt{tapply()}.

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# take the mean of input1 by categories of input2}
\DocumentationTok{\#\# mean of the call variable conducted separately by race}
\FunctionTok{tapply}\NormalTok{(resume}\SpecialCharTok{$}\NormalTok{call, }\AttributeTok{INDEX=}\NormalTok{resume}\SpecialCharTok{$}\NormalTok{race, mean)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
     black      white 
0.06447639 0.09650924 
\end{verbatim}

This tells us the callback rate for each group of people in our data.
That's not the only way to do this, however. We can also use the tools
below.

\hypertarget{relational-operators-in-r}{%
\section{Relational Operators in R}\label{relational-operators-in-r}}

Goal: Compare callback rates for white sounding names to black sounding
names, so we need to be able to filter by race.

Good news: We have several relational operators in R that evaluate
logical statements:

\begin{itemize}
\tightlist
\item
  \texttt{==,\ \textless{},\ \textgreater{},\ \textless{}=,\ \textgreater{}=,\ !=}
\item
  We have a statement and R evaluates it as \texttt{TRUE} or
  \texttt{FALSE}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# for each observation, does the value of race equal "black"?}
\NormalTok{resume}\SpecialCharTok{$}\NormalTok{race }\SpecialCharTok{==} \StringTok{"black"}
\end{Highlighting}
\end{Shaded}

By putting this logical statement within \texttt{{[}\ {]}}, we are
asking R to take the \texttt{mean()} of the variable
\texttt{resume\$call} for the subset of observations for which this
logical statement is \texttt{TRUE}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(resume}\SpecialCharTok{$}\NormalTok{call[resume}\SpecialCharTok{$}\NormalTok{race }\SpecialCharTok{==} \StringTok{"black"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0.06447639
\end{verbatim}

Ultimately, each of these paths has led us to a place where we can
estimate the average treatment effect by calculation the difference in
means: the difference in callback rates for black and white applicants.

We said the ATE = \(\bar{Y}(treatment) - \bar{Y}(control)\)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ate }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(resume}\SpecialCharTok{$}\NormalTok{call[resume}\SpecialCharTok{$}\NormalTok{race }\SpecialCharTok{==} \StringTok{"black"}\NormalTok{]) }\SpecialCharTok{{-}} 
  \FunctionTok{mean}\NormalTok{(resume}\SpecialCharTok{$}\NormalTok{call[resume}\SpecialCharTok{$}\NormalTok{race }\SpecialCharTok{==} \StringTok{"white"}\NormalTok{])}
\NormalTok{ate}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] -0.03203285
\end{verbatim}

How can we interpret this? Do white applicants have an advantage?

\hypertarget{subsetting-data-in-r}{%
\section{Subsetting data in R}\label{subsetting-data-in-r}}

Subsetting Dataframes in R

Maybe we are interested in differences in callbacks for females. One
approach for looking at the treatment effect for female applicants,
only, is to subset our data to include only female names.

\begin{itemize}
\tightlist
\item
  To do this, we will assign a new \texttt{data.frame} object that keeps
  only those rows where \texttt{sex\ ==\ "female"} and retains all
  columns
\item
  Below are two approaches for this subsetting, one that uses brackets
  and one that uses the \texttt{subset} function
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# option one}
\NormalTok{females }\OtherTok{\textless{}{-}}\NormalTok{ resume[resume}\SpecialCharTok{$}\NormalTok{sex }\SpecialCharTok{==} \StringTok{"female"}\NormalTok{, ]}
\DocumentationTok{\#\# option two using subset(){-} preferred}
\NormalTok{females }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(resume, sex }\SpecialCharTok{==} \StringTok{"female"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Now that we have subset the data, this simplifies estimating the ATE for
female applicants only.

We said the ATE = \(\bar{Y}(treatment) - \bar{Y}(control)\)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ate.females }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(females}\SpecialCharTok{$}\NormalTok{call[females}\SpecialCharTok{$}\NormalTok{race }\SpecialCharTok{==} \StringTok{"black"}\NormalTok{]) }\SpecialCharTok{{-}}
  \FunctionTok{mean}\NormalTok{(females}\SpecialCharTok{$}\NormalTok{call[females}\SpecialCharTok{$}\NormalTok{race }\SpecialCharTok{==} \StringTok{"white"}\NormalTok{])}
\NormalTok{ate.females}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] -0.03264689
\end{verbatim}

\hypertarget{getting-booooooooolean}{%
\subsection{Getting Booooooooolean}\label{getting-booooooooolean}}

We can make this slightly more complex by adding more criteria. Let's
say we wanted to know the callback rates for just female black
(sounding) names.

\begin{itemize}
\tightlist
\item
  R allows use to use \texttt{\&} (and) and \texttt{\textbar{}} (or)
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{femaleblack }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(resume, sex }\SpecialCharTok{==} \StringTok{"female"} \SpecialCharTok{\&}\NormalTok{ race }\SpecialCharTok{==} \StringTok{"black"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

We could now find the callback rate for Black females using the tools
from above:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(femaleblack}\SpecialCharTok{$}\NormalTok{call)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0.06627784
\end{verbatim}

\hypertarget{creating-new-variables-using-conditional-statements}{%
\section{Creating New Variables using Conditional
statements}\label{creating-new-variables-using-conditional-statements}}

\emph{Note: We will cover each of these tools in this section, time
permitting. Otherwise, we will return to it in a future section.}

We can instead create a new variable in our main dataframe. Let's make a
variable that takes the value 1 if a name is female and black sounding
and 0, otherwise

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Initialize a new variable called femaleblackname}
\NormalTok{resume}\SpecialCharTok{$}\NormalTok{femaleblackname }\OtherTok{\textless{}{-}} \ConstantTok{NA}
\CommentTok{\# Assign a 1 to our new variable where sex is female and race is black}
\NormalTok{resume}\SpecialCharTok{$}\NormalTok{femaleblackname[resume}\SpecialCharTok{$}\NormalTok{sex }\SpecialCharTok{==} \StringTok{"female"} \SpecialCharTok{\&}\NormalTok{ resume}\SpecialCharTok{$}\NormalTok{race }\SpecialCharTok{==} \StringTok{"black"}\NormalTok{] }\OtherTok{\textless{}{-}} \DecValTok{1}
\CommentTok{\# Assign a 0 if sex is not female OR if race is not black}
\NormalTok{resume}\SpecialCharTok{$}\NormalTok{femaleblackname[resume}\SpecialCharTok{$}\NormalTok{sex }\SpecialCharTok{!=} \StringTok{"female"} \SpecialCharTok{|}\NormalTok{ resume}\SpecialCharTok{$}\NormalTok{race }\SpecialCharTok{!=} \StringTok{"black"}\NormalTok{] }\OtherTok{\textless{}{-}} \DecValTok{0}
\end{Highlighting}
\end{Shaded}

We can check our work

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(}\AttributeTok{name =}\NormalTok{ resume}\SpecialCharTok{$}\NormalTok{firstname, }\AttributeTok{femaleblack =}\NormalTok{ resume}\SpecialCharTok{$}\NormalTok{femaleblackname)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
          femaleblack
name         0   1
  Aisha      0 180
  Allison  232   0
  Anne     242   0
  Brad      63   0
  Brendan   65   0
  Brett     59   0
  Carrie   168   0
  Darnell   42   0
  Ebony      0 208
  Emily    227   0
  Geoffrey  59   0
  Greg      51   0
  Hakim     55   0
  Jamal     61   0
  Jay       67   0
  Jermaine  52   0
  Jill     203   0
  Kareem    64   0
  Keisha     0 183
  Kenya      0 196
  Kristen  213   0
  Lakisha    0 200
  Latonya    0 230
  Latoya     0 226
  Laurie   195   0
  Leroy     64   0
  Matthew   67   0
  Meredith 187   0
  Neil      76   0
  Rasheed   67   0
  Sarah    193   0
  Tamika     0 256
  Tanisha    0 207
  Todd      68   0
  Tremayne  69   0
  Tyrone    75   0
\end{verbatim}

Let's say we wanted to know the callback rates for just female black
(sounding) names.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(femaleblack}\SpecialCharTok{$}\NormalTok{call)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0.06627784
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(resume}\SpecialCharTok{$}\NormalTok{call[resume}\SpecialCharTok{$}\NormalTok{femaleblackname }\SpecialCharTok{==} \DecValTok{1}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0.06627784
\end{verbatim}

BINGO: two ways to do the same thing.

\hypertarget{ifelse-statements}{%
\subsection{ifelse statements}\label{ifelse-statements}}

Remember how we created the variable \texttt{femaleblack}, well there is
another way to do that in R using what are called conditional statements
with \texttt{ifelse()}.

\begin{itemize}
\tightlist
\item
  Can be read: If this relational statement is \texttt{TRUE}, I assign
  you A, otherwise I assign you B
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resume}\SpecialCharTok{$}\NormalTok{femaleblackname }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(resume}\SpecialCharTok{$}\NormalTok{sex }\SpecialCharTok{==} \StringTok{"female"} \SpecialCharTok{\&}
\NormalTok{                                   resume}\SpecialCharTok{$}\NormalTok{race }\SpecialCharTok{==} \StringTok{"black"}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Can be read: If sex is female and race is black, give the observation in
the new variable a 1, otherwise give it a 0.

Like most things, we can also get more complicated here. Let's say we
wanted to create a variable that indicated both race and sex.

\begin{itemize}
\tightlist
\item
  Can be read: If this relational statement is \texttt{TRUE}, I assign
  you A,
\item
  Otherwise if this second relational statement is \texttt{TRUE}, I
  assign you B,
\item
  Otherwise if this third relational statement is \texttt{TRUE}, I
  assign you C,
\item
  Otherwise I assign you D
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resume}\SpecialCharTok{$}\NormalTok{racesex }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(resume}\SpecialCharTok{$}\NormalTok{sex }\SpecialCharTok{==} \StringTok{"female"} \SpecialCharTok{\&}
\NormalTok{                                   resume}\SpecialCharTok{$}\NormalTok{race }\SpecialCharTok{==} \StringTok{"black"}\NormalTok{, }\StringTok{"FemaleBlack"}\NormalTok{, }
                         \FunctionTok{ifelse}\NormalTok{(resume}\SpecialCharTok{$}\NormalTok{sex }\SpecialCharTok{==} \StringTok{"female"} \SpecialCharTok{\&}
\NormalTok{                                   resume}\SpecialCharTok{$}\NormalTok{race }\SpecialCharTok{==} \StringTok{"white"}\NormalTok{, }\StringTok{"FemaleWhite"}\NormalTok{,}
                                \FunctionTok{ifelse}\NormalTok{(resume}\SpecialCharTok{$}\NormalTok{sex }\SpecialCharTok{==} \StringTok{"male"} \SpecialCharTok{\&}
\NormalTok{                                   resume}\SpecialCharTok{$}\NormalTok{race }\SpecialCharTok{==} \StringTok{"white"}\NormalTok{, }\StringTok{"MaleWhite"}\NormalTok{, }\StringTok{"MaleBlack"}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

Note: what you assign can be numeric or text.

\hypertarget{types-of-experiments}{%
\section{Types of Experiments}\label{types-of-experiments}}

Experiments can vary:

\begin{itemize}
\tightlist
\item
  Setting: Lab, Survey, Field
\item
  Mode: Analog vs.~Digital
\item
  And in Validity

  \begin{itemize}
  \tightlist
  \item
    Internal: were the processes conducted in a correct, reliable way?
  \item
    External: can we generalize from the experiment to the real world,
    or would the results change?
  \item
    Context: Would people act the same way outside of the experiment?
  \item
    Recruitment: Are the people in our experiment representative of the
    people we care about?
  \item
    Construct

    \begin{itemize}
    \tightlist
    \item
      Treatment: Is the experimental treatment similar to what people
      see in the real world?
    \item
      Outcome: Is the outcome something we care about in the real world?
      Are we measuring it in a realistic, accurate way?
    \end{itemize}
  \end{itemize}
\end{itemize}

Review
\href{https://www.bitbybitbook.com/en/1st-ed/running-experiments/}{\emph{Bit
by Bit}} chapter 4 for more examples of social science experiments.

\textbf{\emph{Example: Televised Incivility, Trust and Emotions (Mutz
and Reeves)}}

\includegraphics[width=0.5\textwidth,height=\textheight]{images/arousal.png}

Participants sat alone in a room with electrodes attached to their hands
to measure skin conductance. Subjects viewed 20 minutes of a political
debate created for the experiment, which varied in civility and
politeness. Results showed respondents had more of an emotional response
to the uncivil condition and expressed less trust in politicians.

\textbf{\emph{Example: Online Survey Experiment}}

\emph{Audience Costs} (Tomz)

A country sent its military to take over a neighboring country. The
attacking country was led by a {[}dictator, who invaded
\textbf{\emph{OR}} democratically elected government, which invaded{]}
{[}to get more power and resources \textbf{\emph{OR}} because of a
longstanding historical feud.

The attacking country had a {[}strong military, so it would
\textbf{\emph{OR}} weak military, so it would not{]} have taken a major
effort for the United States to help push them out.

A victory by the attacking country would {[}hurt \textbf{\emph{OR}} not
affect{]} the safety and economy of the United States.

\begin{itemize}
\tightlist
\item
  Participants provided a different version of the vignette above, and a
  reaction by the president
\item
  Presidential approval varies depending on the president's response and
  the nature of the situation
\end{itemize}

\textbf{\emph{Example: Digital Field Experiments in Campaigns}}

Example: A/B Testing in Campaigns

\includegraphics{images/whichsubject.png}

Emails are virtually costless. Very easy to ask: Are people more likely
to open them with X subject or Y subject or Z subject?

\hypertarget{wrapping-up-causation-with-experiments}{%
\section{Wrapping Up Causation with
Experiments}\label{wrapping-up-causation-with-experiments}}

In this section, we have discussed what it means to make a causal claim,
why it is essentially impossible to make causal comparisons in real life
due to the fundamental problem of causal inferences, and how experiments
can help us make comparisons that approximate our causal ideals.

In the next section, we start to examine how to visualize data.

\hypertarget{summary-of-r-tools-in-this-section}{%
\subsection{Summary of R tools in this
section}\label{summary-of-r-tools-in-this-section}}

Here are some of the R tools we used in this section:

\begin{itemize}
\tightlist
\item
  \texttt{table()}: this function summarizes the frequency of
  observations that take a particular value. The input is one or more
  variables in your data.

  \begin{itemize}
  \tightlist
  \item
    E.g., \texttt{table(resume\$sex)} or
    \texttt{table(resume\$sex,\ resume\$call)}
  \end{itemize}
\item
  \texttt{tapply()}: this function applies a given operation like
  \texttt{mean} to whichever variable is in the first position,
  separately or ``conditionally'' by different values of the variable in
  the second ``index'' position.

  \begin{itemize}
  \tightlist
  \item
    E.g., \texttt{tapply(resume\$call,\ INDEX=resume\$race,\ mean)}
    finds the average callbacks for applicants separately for different
    races of applicants in the data.
  \end{itemize}
\item
  \texttt{==\ \textgreater{}\ \textless{}\ \textgreater{}=\ \textless{}=\ !=}:
  Relational operators help us set up ``logical statements'' in R that
  are evaluated as \texttt{TRUE} or \texttt{FALSE}

  \begin{itemize}
  \tightlist
  \item
    E.g., \texttt{resume\$race\ ==\ "black"} evaluates whether for each
    observation in the race column is ``black'' in which case the
    statement is \texttt{TRUE} or not black, in which case the statement
    is \texttt{FALSE}
  \item
    E.g., \texttt{resume\$call\ \textless{}\ 1} evaluates whether for
    each observation in the call column has a value less than one in
    which case the statement is \texttt{TRUE} or not less than 1, in
    which case the statement is \texttt{FALSE}
  \item
    We can then isolate certain parts of columns using relational
    operators and the brackets \texttt{{[}{]}}. For example we can take
    the mean callbacks for applicants who are black using
    \texttt{mean(resume\$call{[}resume\$race\ ==\ "black"{]})}
  \end{itemize}
\item
  \texttt{\&} and \texttt{\textbar{}}: These are boolean operators that
  allow us to combine multiple relational operators using an AND
  statement (\texttt{\&}) or an OR statement \texttt{\textbar{}}. Note
  the bar is a bar that is usually above your backslash key and not a
  capitalized i.

  \begin{itemize}
  \tightlist
  \item
    E.g.,
    \texttt{mean(resume\$call{[}resume\$race\ ==\ "black"\ \&\ resume\$sex\ ==\ "female"{]})}
  \end{itemize}
\item
  \texttt{subset()}: We can subset whole rows of our data using this
  function. It takes two inputs-- the first is the name of the original
  dataframe, and the second is a relational statement. Usually we store
  this output in R by assigning the results to a new object, a dataframe
  that contains only those rows for which the logical statement using
  the relational operators is true. E.g.,
  \texttt{females\ \textless{}-\ subset(resume,\ sex\ ==\ "female")}
  subsets our data to keep only those rows where applicants were female.
\end{itemize}

\bookmarksetup{startatroot}

\hypertarget{visualization}{%
\chapter{Visualization}\label{visualization}}

In this section, we discuss a set of tools for data visualization in R.

Goals of data visualization

\begin{itemize}
\tightlist
\item
  Communicate information

  \begin{itemize}
  \tightlist
  \item
    Transparently (show me the data!)
  \item
    Quickly
  \item
    Simply
  \item
    Accurately
  \item
    And with a little work: beautifully
  \end{itemize}
\end{itemize}

There are many resources for ideas and best practices for data
visualization. See
\href{https://www.tableau.com/learn/articles/best-data-visualization-blogs}{here}
and \href{https://serialmentor.com/dataviz/index.html}{here}.

We will cover many types of visuals, each typically designed for a
different purpose.

What to communicate?

\begin{itemize}
\tightlist
\item
  Data summary

  \begin{itemize}
  \tightlist
  \item
    Central tendency (e.g., mean, median)
  \item
    Spread (e.g., standard deviation, IQR)
  \end{itemize}
\item
  Comparison

  \begin{itemize}
  \tightlist
  \item
    e.g., Callback rates for black vs.~white sounding names
  \end{itemize}
\item
  Trend

  \begin{itemize}
  \tightlist
  \item
    e.g., Economic confidence over time
  \end{itemize}
\item
  Relationship

  \begin{itemize}
  \tightlist
  \item
    e.g., Correlation
  \end{itemize}
\end{itemize}

\hypertarget{application-social-status-and-economic-views}{%
\section{Application: Social Status and Economic
Views}\label{application-social-status-and-economic-views}}

We are going to explore different types of visualizations through
different social science examples. The first application we visit is a
survey experiment.

Thal, A. (2020). The desire for social status and economic conservatism
among affluent Americans. American Political Science Review, 114(2),
426-442.

In the experiment, affluent Americans are randomly assigned to encounter
Facebook posts in which others broadcast their economic success. These
posts are designed in a way that encourages affluent respondents to view
economic success as a means of achieving social status.

Causal claims

\begin{itemize}
\tightlist
\item
  ``I expect that exposure to these posts will cause affluent Americans
  to become more supportive of conservative economic policies.''
\item
  ``I also expect that exposure to these posts will cause especially
  large increases in economic conservatism among affluent men.''
\end{itemize}

The experiment includes a sample of 2010 affluent Americans-- people who
report household incomes in the top 10 percent of the U.S. income
distribution.

Experiment Ingredients:

\begin{itemize}
\tightlist
\item
  Causal Question: Does desire for social status influence economic
  views of affluent Americans?
\item
  Recruitment: Ask affluent Americans to take a survey online
\item
  Randomization: Randomly assign respondents to view different fictional
  Facebook posts designed to signal different motivations
\item
  Outcome: an index based on respondents' support for decreasing ``taxes
  on households making \$150,000 or more a year,'' support for
  decreasing the ``taxes on money people make from selling investments,
  also referred to as capital gains,'' and support for decreasing
  ``government regulation of business and industry.''
\item
  Comparison: Average economic views between experimental conditions.
\end{itemize}

Snapshot of status conditions

\includegraphics[width=0.7\textwidth,height=\textheight]{images/status1.png}

Snapshot of Concrete and Placebo comparison conditions

\includegraphics[width=0.7\textwidth,height=\textheight]{images/status2.png}

\textbf{Can you put this into the potential outcomes framework?}

\hypertarget{boxplots}{%
\section{Boxplots}\label{boxplots}}

For a video explainer of the code for boxplots and barplots, see below.
The video only discusses the code. Use the notes and lecture discussion
for additional context. (Via youtube, you can speed up the playback to
1.5 or 2x speed.)

\url{https://www.youtube.com/watch?v=QmQr4lfrmUc}

Let's load the data! Here, note that the data file is in a .RData format
instead of .csv. This means that instead of using \texttt{read.csv}, we
should use a function to load the data that is suitable for the .RData
format. This will be \texttt{load}. That function works the following
way:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{load}\NormalTok{(}\StringTok{"status.RData"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

After running the above code, an object will show up in your R
environment.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(status)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
        condition male   econcon
2        Concrete    1 0.7500000
3     Self-Esteem    1 1.0000000
4         Placebo    1 0.6666667
5     Self-Esteem    0 0.2500000
6     Self-Esteem    0 1.0000000
7 Social Approval    0 0.8333333
\end{verbatim}

The data include the following variables

\begin{itemize}
\tightlist
\item
  \texttt{condition}: Placebo, Concrete, Self-Esteem, Social Approval,
  Conspicuous Consumption
\item
  \texttt{gender}: 1= male; 0= otherwise
\item
  \texttt{econcon}: Economic views. Numeric variable from 0 to 1, with
  higher values reflecting more conservative views
\end{itemize}

\hypertarget{data-summary-boxplot}{%
\subsection{Data Summary: Boxplot}\label{data-summary-boxplot}}

Characterize the distributions of continuous numeric variables at once

\begin{itemize}
\tightlist
\item
  Features: box, whiskers, outliers
\item
  We will supply the function with a column in our data, and the boxplot
  displays the distribution of that variable.
\end{itemize}

\includegraphics[width=0.8\textwidth,height=\textheight]{images/agebox.png}

\emph{Figure from Will Lowe}

Here is an example of the \texttt{boxplot} using our \texttt{econcon}
variable.

\begin{itemize}
\tightlist
\item
  We have added a title and y-axis label to the plot through the
  \texttt{main} and \texttt{ylab} arguments. Play around with changing
  the words in those arguments.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{boxplot}\NormalTok{(status}\SpecialCharTok{$}\NormalTok{econcon,}
        \AttributeTok{main=}\StringTok{"Economic Views in the Survey Sample"}\NormalTok{,}
        \AttributeTok{ylab=}\StringTok{"Economic Views"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{04-Visualization_files/figure-pdf/unnamed-chunk-4-1.pdf}

}

\end{figure}

After you execute the plot code, a preview of the plot should appear in
the bottom-right window of RStudio.

Boxplots are also useful for data summary across multiple distribution:
\texttt{boxplot(y\ \textasciitilde{}\ x,\ data\ =\ d)}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{boxplot}\NormalTok{(econcon }\SpecialCharTok{\textasciitilde{}}\NormalTok{ condition, }\AttributeTok{data=}\NormalTok{status,}
        \AttributeTok{main=}\StringTok{"Economic Views by Experimental Condition"}\NormalTok{,}
        \AttributeTok{ylab=}\StringTok{"Economic Views"}\NormalTok{,}
        \AttributeTok{names =} \FunctionTok{c}\NormalTok{(}\StringTok{"Placebo"}\NormalTok{, }\StringTok{"Concrete"}\NormalTok{, }\StringTok{"Conspicuous"}\NormalTok{, }
                  \StringTok{"Self{-}Esteem"}\NormalTok{, }\StringTok{"Social"}\NormalTok{),}
        \AttributeTok{xlab =} \StringTok{"Experimental Condition"}\NormalTok{,}
        \AttributeTok{col =} \FunctionTok{c}\NormalTok{(}\StringTok{"red3"}\NormalTok{, }\FunctionTok{rep}\NormalTok{(}\StringTok{"dodgerblue"}\NormalTok{, }\DecValTok{4}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{04-Visualization_files/figure-pdf/unnamed-chunk-5-1.pdf}

}

\end{figure}

The additional arguments are just aesthetics. Play around with different
settings.

\begin{itemize}
\tightlist
\item
  For example, can you change the code to make the first two boxes red?
  Colors are supplied as a vector using the \texttt{col\ =} argument.

  \begin{itemize}
  \tightlist
  \item
    To explore colors in R, run this function \texttt{colors()} in your
    R console.
  \end{itemize}
\end{itemize}

How should we interpret these results? Does status or social approval
motivation, specifically, influence economic views? What about other
potential motivations?

\hypertarget{barplots}{%
\section{Barplots}\label{barplots}}

Comparing frequencies (raw N), proportions, and/or means across
categories

\includegraphics{04-Visualization_files/figure-pdf/unnamed-chunk-6-1.pdf}

We will use the \texttt{barplot()} function.

\begin{itemize}
\tightlist
\item
  In contrast to the boxplot, the barplot function takes a vector of
  values that will serve as the top of the bars in the plot-- it does
  not summarize a variable from within the function

  \begin{itemize}
  \tightlist
  \item
    E.g., we could supply it a set of means to plot, not a raw variable
  \end{itemize}
\item
  Many of the other arguments are aesthetics similar to those when
  working with boxplot.
\item
  This means that barplots are pretty easy to create in R. We can supply
  it a short vector of any values (e.g.,
  \texttt{valuesbar\ \textless{}-\ c(20,\ 30,\ 40,\ 10)}), and we could
  also supply it a vector of any names to label those values.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Example}
\NormalTok{valuesbar }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{20}\NormalTok{, }\DecValTok{30}\NormalTok{, }\DecValTok{40}\NormalTok{, }\DecValTok{10}\NormalTok{)}

\NormalTok{namesbar }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Livingston Dining }\SpecialCharTok{\textbackslash{}n}\StringTok{ Commons"}\NormalTok{,}
              \StringTok{"Neilson }\SpecialCharTok{\textbackslash{}n}\StringTok{ Dining Hall"}\NormalTok{,}
              \StringTok{"Busch }\SpecialCharTok{\textbackslash{}n}\StringTok{ Dining Hall"}\NormalTok{,}
              \StringTok{"Brower }\SpecialCharTok{\textbackslash{}n}\StringTok{ Commons"}\NormalTok{)}

\FunctionTok{barplot}\NormalTok{(valuesbar,}
        \AttributeTok{names=}\NormalTok{namesbar,}
        \AttributeTok{cex.names =}\NormalTok{ .}\DecValTok{6}\NormalTok{,}
        \AttributeTok{main=}\StringTok{"Hypothetical Evaluation of RU Dining"}\NormalTok{,}
        \AttributeTok{ylab=}\StringTok{"Percent Prefer Dining Option"}\NormalTok{,}
        \AttributeTok{cex.lab =}\NormalTok{ .}\DecValTok{7}\NormalTok{, }
        \AttributeTok{col=}\StringTok{"red3"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
-   For real applications, this means we could supply a barplot with the output of a `tapply()` function, a `table()` summarizing a single variable, or a set of `mean()` values we have combined into a vector using `c()`.
\end{verbatim}

For example, in experiments, we may use barplots to compare the mean
from the treatment group(s) \(\bar{Y}(1)\) to the control \(\bar{Y}(0)\)
on some outcome. Let's do it!

\begin{itemize}
\tightlist
\item
  First, we need the means. Let's find the conditional means of economic
  views.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{condmeans }\OtherTok{\textless{}{-}} \FunctionTok{tapply}\NormalTok{(status}\SpecialCharTok{$}\NormalTok{econcon, status}\SpecialCharTok{$}\NormalTok{condition, mean)}
\NormalTok{condmeans }\CommentTok{\# save as object to supply to the barplot function}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
                Placebo                Concrete Conspicuous Consumption 
              0.6340948               0.6647485               0.6724065 
            Self-Esteem         Social Approval 
              0.6564103               0.6904444 
\end{verbatim}

The first input is the vector of means/proportions/frequency you want to
plot.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{barplot}\NormalTok{(condmeans,}
        \AttributeTok{ylim =}  \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{), }\CommentTok{\# y{-}axis dimensions}
        \AttributeTok{names =} \FunctionTok{c}\NormalTok{(}\StringTok{"Placebo"}\NormalTok{, }\StringTok{"Concrete"}\NormalTok{, }\StringTok{"Conspicuous"}\NormalTok{, }
                  \StringTok{"Self{-}Esteem"}\NormalTok{, }\StringTok{"Social"}\NormalTok{),}
        \AttributeTok{col =} \StringTok{"black"}\NormalTok{, }\CommentTok{\# color of bars}
        \AttributeTok{main =} \StringTok{"Mean Economic Views by Condition"}\NormalTok{, }\CommentTok{\# plot title}
        \AttributeTok{cex.main =}\NormalTok{ .}\DecValTok{8}\NormalTok{, }\CommentTok{\# size of plot title}
        \AttributeTok{cex.names =}\NormalTok{ .}\DecValTok{8}\NormalTok{, }\CommentTok{\# size of name labels}
        \AttributeTok{ylab =} \StringTok{"Mean Views"}\NormalTok{, }\CommentTok{\# yaxis label}
        \AttributeTok{cex.lab =}\NormalTok{ .}\DecValTok{8}\NormalTok{,}\CommentTok{\# size of yaxis label}
        \AttributeTok{las =} \DecValTok{1}\NormalTok{) }\CommentTok{\# controls angle of axis labels}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{04-Visualization_files/figure-pdf/unnamed-chunk-9-1.pdf}

}

\end{figure}

The remaining arguments alter the look of the plot to make it more
informative.

\begin{itemize}
\tightlist
\item
  How could we improve this plot to make the interpretation easier?
\end{itemize}

\hypertarget{saving-plots}{%
\subsection{Saving Plots}\label{saving-plots}}

You can save an image of your plot as a \texttt{png()} to your working
directory. Place \texttt{png()} just before your plot with a name in
quotations, and then specify the dimensions. Place \texttt{dev.off()} at
the bottom.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{png}\NormalTok{(}\StringTok{"mybarplot.png"}\NormalTok{, }\AttributeTok{width =} \DecValTok{7}\NormalTok{, }\AttributeTok{height =} \DecValTok{4}\NormalTok{, }\AttributeTok{res=}\DecValTok{300}\NormalTok{, }\AttributeTok{units=}\StringTok{"in"}\NormalTok{)}
\FunctionTok{barplot}\NormalTok{(condmeans,}
        \AttributeTok{ylim =}  \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{), }\CommentTok{\# y{-}axis dimensions}
        \AttributeTok{names =} \FunctionTok{c}\NormalTok{(}\StringTok{"Placebo"}\NormalTok{, }\StringTok{"Concrete"}\NormalTok{, }\StringTok{"Conspicuous"}\NormalTok{, }
                  \StringTok{"Self{-}Esteem"}\NormalTok{, }\StringTok{"Social"}\NormalTok{),}
        \AttributeTok{col =} \StringTok{"black"}\NormalTok{, }\CommentTok{\# color of bars}
        \AttributeTok{main =} \StringTok{"Mean Economic Views by Condition"}\NormalTok{, }\CommentTok{\# plot title}
        \AttributeTok{cex.main =}\NormalTok{ .}\DecValTok{8}\NormalTok{, }\CommentTok{\# size of plot title}
        \AttributeTok{cex.names =}\NormalTok{ .}\DecValTok{8}\NormalTok{, }\CommentTok{\# size of name labels}
        \AttributeTok{ylab =} \StringTok{"Mean Views"}\NormalTok{, }\CommentTok{\# yaxis label}
        \AttributeTok{cex.lab =}\NormalTok{ .}\DecValTok{8}\NormalTok{,}\CommentTok{\# size of yaxis label}
        \AttributeTok{las =} \DecValTok{1}\NormalTok{) }\CommentTok{\# controls angle of axis labels}
\FunctionTok{dev.off}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

Alternatively, you can save it as an image, by going to the plot window
in your RStudio environment, and clicking on Export -\textgreater{} Save
as Image. Here, you can save it in any file format you would like, as
well as change the dimensions.

\includegraphics{images/saveplot.png}

\hypertarget{creating-new-variables}{%
\subsection{Creating New Variables}\label{creating-new-variables}}

The author theorizes that social approval, self-esteem, and conspicuous
consumption are all elements of ``status motivation.'' We could analyze
the results by collapsing them into a single category called ``status
motivation'' and compare it to the other experimental groups.

\begin{itemize}
\tightlist
\item
  Create a new variable \texttt{conditionnew}
\item
  Code the variable into new categories based on the values in the
  original \texttt{condition} variable
\item
  Check the class of the new variable and convert if necessary
\item
  Verify new variable by exploring values
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{status}\SpecialCharTok{$}\NormalTok{conditionnew }\OtherTok{\textless{}{-}} \ConstantTok{NA} \CommentTok{\# create new variable}
\DocumentationTok{\#\# Code new variable}
\NormalTok{status}\SpecialCharTok{$}\NormalTok{conditionnew[status}\SpecialCharTok{$}\NormalTok{condition }\SpecialCharTok{==} \StringTok{"Placebo"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"Placebo"}
\NormalTok{status}\SpecialCharTok{$}\NormalTok{conditionnew[status}\SpecialCharTok{$}\NormalTok{condition }\SpecialCharTok{==} \StringTok{"Concrete"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"Concrete"}
\NormalTok{status}\SpecialCharTok{$}\NormalTok{conditionnew[status}\SpecialCharTok{$}\NormalTok{condition }\SpecialCharTok{==} \StringTok{"Conspicuous Consumption"} \SpecialCharTok{|}
\NormalTok{                     status}\SpecialCharTok{$}\NormalTok{condition }\SpecialCharTok{==} \StringTok{"Self{-}Esteem"} \SpecialCharTok{|}  
\NormalTok{                      status}\SpecialCharTok{$}\NormalTok{condition }\SpecialCharTok{==} \StringTok{"Social Approval"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"Status"}

\CommentTok{\# class(status$conditionnew) check the class}
\NormalTok{status}\SpecialCharTok{$}\NormalTok{conditionnew }\OtherTok{\textless{}{-}} \FunctionTok{as.factor}\NormalTok{(status}\SpecialCharTok{$}\NormalTok{conditionnew) }\CommentTok{\# convert}
\end{Highlighting}
\end{Shaded}

Recall, an alternative way to create the new variable is through an
\texttt{ifelse} statement.

\begin{itemize}
\tightlist
\item
  Can be read: If this relational statement is \texttt{TRUE}, I assign
  you A, otherwise I assign you B
\item
  This often works best when we change factor variables to character
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{status}\SpecialCharTok{$}\NormalTok{conditionnew2 }\OtherTok{\textless{}{-}} \FunctionTok{as.character}\NormalTok{(status}\SpecialCharTok{$}\NormalTok{condition)}
\NormalTok{status}\SpecialCharTok{$}\NormalTok{conditionnew2 }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(status}\SpecialCharTok{$}\NormalTok{condition }\SpecialCharTok{==} \StringTok{"Conspicuous Consumption"} \SpecialCharTok{|}
\NormalTok{                     status}\SpecialCharTok{$}\NormalTok{condition }\SpecialCharTok{==} \StringTok{"Self{-}Esteem"} \SpecialCharTok{|}  
\NormalTok{                      status}\SpecialCharTok{$}\NormalTok{condition }\SpecialCharTok{==} \StringTok{"Social Approval"}\NormalTok{, }
                     \StringTok{"Status"}\NormalTok{, status}\SpecialCharTok{$}\NormalTok{conditionnew2)}
\NormalTok{status}\SpecialCharTok{$}\NormalTok{conditionnew2 }\OtherTok{\textless{}{-}} \FunctionTok{as.factor}\NormalTok{(status}\SpecialCharTok{$}\NormalTok{conditionnew2)}
\FunctionTok{table}\NormalTok{(status}\SpecialCharTok{$}\NormalTok{conditionnew2)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}

Concrete  Placebo   Status 
     391      394     1157 
\end{verbatim}

Note: Barplots don't have to display means. We could also display
frequencies. For example, let's make a plot of the number of people in
each condition using our new variable.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{freqobs }\OtherTok{\textless{}{-}} \FunctionTok{table}\NormalTok{(status}\SpecialCharTok{$}\NormalTok{conditionnew)}


\FunctionTok{barplot}\NormalTok{(freqobs,}
        \AttributeTok{ylim =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1200}\NormalTok{),}
        \AttributeTok{col =} \StringTok{"black"}\NormalTok{, }\CommentTok{\# color of bars}
        \AttributeTok{main =} \StringTok{"Number of People per Condition"}\NormalTok{, }\CommentTok{\# plot title}
        \AttributeTok{cex.main =}\NormalTok{ .}\DecValTok{8}\NormalTok{, }\CommentTok{\# size of plot title}
        \AttributeTok{cex.names =}\NormalTok{ .}\DecValTok{8}\NormalTok{, }\CommentTok{\# size of name labels}
        \AttributeTok{ylab =} \StringTok{"N of Observations"}\NormalTok{, }\CommentTok{\# yaxis label}
        \AttributeTok{cex.lab =}\NormalTok{ .}\DecValTok{8}\NormalTok{,}\CommentTok{\# size of yaxis label}
        \AttributeTok{las =} \DecValTok{1}\NormalTok{) }\CommentTok{\# controls angle of axis labels}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{04-Visualization_files/figure-pdf/unnamed-chunk-13-1.pdf}

}

\end{figure}

\hypertarget{application-changing-minds-on-gay-marriage}{%
\section{Application: Changing Minds on Gay
Marriage}\label{application-changing-minds-on-gay-marriage}}

We now turn to a study that asks the question

\begin{itemize}
\tightlist
\item
  Research Question Can we effectively persuade people to change their
  minds?

  \begin{itemize}
  \tightlist
  \item
    \emph{Contact Hypothesis}: outgroup hostility diminishes through
    extended positive contact
  \end{itemize}
\end{itemize}

The authors conduct two randomized control trials in Los Angeles

\begin{itemize}
\tightlist
\item
  \emph{Target population}: voters in Los Angeles
\item
  \emph{Recruitment}: select people from a registered voter list
\item
  \emph{Randomized treatment conditions}:

  \begin{itemize}
  \tightlist
  \item
    Canvassers have a conversation about same-sex marriage vs.
  \item
    Recycling scripts (placebo)
  \item
    Control group: no canvassing
  \end{itemize}
\item
  \emph{Outcome measures}:

  \begin{itemize}
  \tightlist
  \item
    Feeling towards gay couples (survey responses over multiple waves)
  \end{itemize}
\item
  \emph{Comparison}

  \begin{itemize}
  \tightlist
  \item
    Compare average change in feelings between treatment conditions
  \end{itemize}
\end{itemize}

Let's load the data. Data available through QSS. See QSS Chapter 2 for
additional discussion.

\begin{itemize}
\tightlist
\item
  \texttt{study}: Which study is the data from (\texttt{1} = Study1,
  \texttt{2} = Study2)
\item
  \texttt{treatment}: Five possible treatment assignment options
\item
  \texttt{therm1}: Survey thermometer rating of feeling towards gay
  couples in waves 1 (0--100) (asked before people were canvassed)
\item
  \texttt{therm2}: Survey thermometer rating of feeling towards gay
  couples in waves 2 (0--100) (asked after people were canvassed)
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{marriage }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"gayreshaped.csv"}\NormalTok{, }\AttributeTok{stringsAsFactors =}\NormalTok{ T)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# How many rows and columns}
\FunctionTok{dim}\NormalTok{(marriage)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 11948     6
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# How many observations in each treatment group, in each study}
\FunctionTok{table}\NormalTok{(marriage}\SpecialCharTok{$}\NormalTok{treatment, marriage}\SpecialCharTok{$}\NormalTok{study)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
                                                
                                                    1    2
  No Contact                                     5238 1203
  Recycling Script by Gay Canvasser              1046    0
  Recycling Script by Straight Canvasser         1039    0
  Same-Sex Marriage Script by Gay Canvasser      1151 1238
  Same-Sex Marriage Script by Straight Canvasser 1033    0
\end{verbatim}

For a video explainer of the code for the barplot, scatter plot and
histogram created with this application, see below. The video only
discusses the code. Use the notes and lecture discussion for additional
context. (Via youtube, you can speed up the playback to 1.5 or 2x
speed.)

\url{https://www.youtube.com/watch?v=ukexpAulAAk}

Let's focus on study 1 only.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{marriage1 }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(marriage, study }\SpecialCharTok{==}  \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

We have to do some work to prepare our outcome and treatment conditions.

In experiments, we compare the mean from the treatment group(s)
\(\bar{Y}(1)\) to the control \(\bar{Y}(0)\) on some outcome

\begin{itemize}
\tightlist
\item
  Here are outcome is Change in Support for gay couples: Wave 2 - Wave 1
  feeling thermometer scores
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{marriage1}\SpecialCharTok{$}\NormalTok{outcome }\OtherTok{\textless{}{-}}\NormalTok{ marriage1}\SpecialCharTok{$}\NormalTok{therm2 }\SpecialCharTok{{-}}\NormalTok{ marriage1}\SpecialCharTok{$}\NormalTok{therm1}
\end{Highlighting}
\end{Shaded}

\hypertarget{recall-creating-new-variables}{%
\subsection{Recall: Creating new
variables}\label{recall-creating-new-variables}}

Let's create a new variable \texttt{treatmentnew} that collapses the two
Recycling and Same-Sex marriage conditions.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{marriage1}\SpecialCharTok{$}\NormalTok{treatmentnew }\OtherTok{\textless{}{-}} \ConstantTok{NA}
\NormalTok{marriage1}\SpecialCharTok{$}\NormalTok{treatmentnew[marriage1}\SpecialCharTok{$}\NormalTok{treatment }\SpecialCharTok{==} \StringTok{"No Contact"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"No Contact"}
\NormalTok{marriage1}\SpecialCharTok{$}\NormalTok{treatmentnew[marriage1}\SpecialCharTok{$}\NormalTok{treatment }\SpecialCharTok{==} \StringTok{"Recycling Script by Gay Canvasser"} \SpecialCharTok{|}
\NormalTok{                         marriage1}\SpecialCharTok{$}\NormalTok{treatment }\SpecialCharTok{==} 
                         \StringTok{"Recycling Script by Straight Canvasser"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"Recycling"}
\NormalTok{marriage1}\SpecialCharTok{$}\NormalTok{treatmentnew[marriage1}\SpecialCharTok{$}\NormalTok{treatment }\SpecialCharTok{==} \StringTok{"Same{-}Sex Marriage Script by Gay Canvasser"} \SpecialCharTok{|}
\NormalTok{                         marriage1}\SpecialCharTok{$}\NormalTok{treatment }\SpecialCharTok{==}
                         \StringTok{"Same{-}Sex Marriage Script by Straight Canvasser"}\NormalTok{] }\OtherTok{\textless{}{-}} \StringTok{"Marriage"}
\NormalTok{marriage1}\SpecialCharTok{$}\NormalTok{treatmentnew }\OtherTok{\textless{}{-}} \FunctionTok{as.factor}\NormalTok{(marriage1}\SpecialCharTok{$}\NormalTok{treatmentnew)}

\FunctionTok{table}\NormalTok{(marriage1}\SpecialCharTok{$}\NormalTok{treatmentnew)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}

  Marriage No Contact  Recycling 
      2184       5238       2085 
\end{verbatim}

\hypertarget{recall-using-ifelse-to-create-new-variable}{%
\subsection{Recall: Using ifelse to create new
variable}\label{recall-using-ifelse-to-create-new-variable}}

An alternative way we could create a variable is to use \texttt{ifelse}

Let's try another way using the \texttt{ifelse} command.

\begin{itemize}
\tightlist
\item
  Can be read: If this relational statement is \texttt{TRUE}, I assign
  you A (in this case ``No Contact''), otherwise (\texttt{ifelse()})
\item
  if this alternative relational statement is \texttt{TRUE}, I assign
  you B (in this case ``Recycling''), otherwise (\texttt{ifelse()})
\item
  if this alternative relational statement is \texttt{TRUE}, I assign
  you C (in this case ``Marriage''), otherwise
\item
  If all of those were \texttt{FALSE} I assign you D (in this case an
  \texttt{NA})
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{marriage1}\SpecialCharTok{$}\NormalTok{treatmentnew2 }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(marriage1}\SpecialCharTok{$}\NormalTok{treatment }\SpecialCharTok{==} \StringTok{"No Contact"}\NormalTok{, }\StringTok{"No Contact"}\NormalTok{,}
                                  \FunctionTok{ifelse}\NormalTok{(marriage1}\SpecialCharTok{$}\NormalTok{treatment }\SpecialCharTok{==} 
                                           \StringTok{"Recycling Script by Gay Canvasser"} \SpecialCharTok{|}
\NormalTok{                                           marriage1}\SpecialCharTok{$}\NormalTok{treatment }\SpecialCharTok{==}  
                                           \StringTok{"Recycling Script by Straight Canvasser"}\NormalTok{,  }
                                         \StringTok{"Recycling"}\NormalTok{,}
                                    \FunctionTok{ifelse}\NormalTok{(marriage1}\SpecialCharTok{$}\NormalTok{treatment }\SpecialCharTok{==}
                                        \StringTok{"Same{-}Sex Marriage Script by Gay Canvasser"} \SpecialCharTok{|}  
\NormalTok{                                            marriage1}\SpecialCharTok{$}\NormalTok{treatment }\SpecialCharTok{==}
                                        \StringTok{"Same{-}Sex Marriage Script by Straight Canvasser"}\NormalTok{,}
                                        \StringTok{"Marriage"}\NormalTok{, }
                                        \ConstantTok{NA}\NormalTok{)))}
\NormalTok{marriage1}\SpecialCharTok{$}\NormalTok{treatmentnew2 }\OtherTok{\textless{}{-}} \FunctionTok{as.factor}\NormalTok{(marriage1}\SpecialCharTok{$}\NormalTok{treatmentnew2)}
\end{Highlighting}
\end{Shaded}

\hypertarget{calculating-the-average-treatment-effect}{%
\subsection{Calculating the Average Treatment
Effect}\label{calculating-the-average-treatment-effect}}

We now have our outcome and our treatment conditions. In an experiment,
we want to look at the difference in means between conditions. Let's
calculate the means.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{outs }\OtherTok{\textless{}{-}} \FunctionTok{tapply}\NormalTok{(marriage1}\SpecialCharTok{$}\NormalTok{outcome, marriage1}\SpecialCharTok{$}\NormalTok{treatmentnew, mean, }\AttributeTok{na.rm=}\NormalTok{T)}
\end{Highlighting}
\end{Shaded}

Note: Sometimes data include missing cells. In R, these have an
\texttt{NA}. To ignore these when calculating a mean, we add
\texttt{na.rm\ =\ T} to the \texttt{mean()} or \texttt{tapply()}
functions.

\hypertarget{visualize-means-in-a-barplot}{%
\subsection{Visualize means in a
barplot}\label{visualize-means-in-a-barplot}}

Let's also add a line at 0 using \texttt{abline()}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{barplot}\NormalTok{(outs,}
        \AttributeTok{col=}\StringTok{"black"}\NormalTok{,}
        \AttributeTok{ylim =}  \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{), }\CommentTok{\# y{-}axis dimensions}
        \AttributeTok{border =} \ConstantTok{NA}\NormalTok{, }\CommentTok{\# removes bar borders}
        \AttributeTok{main =} \StringTok{"Change in FT W2{-}W1 by Type of Treatment"}\NormalTok{, }\CommentTok{\# plot title}
        \AttributeTok{cex.main =}\NormalTok{ .}\DecValTok{8}\NormalTok{, }\CommentTok{\# size of plot title}
        \AttributeTok{ylab =} \StringTok{"Mean Change in FT W2{-}W1"}\NormalTok{, }\CommentTok{\# yaxis label}
        \AttributeTok{cex.lab =}\NormalTok{ .}\DecValTok{8}\NormalTok{,}\CommentTok{\# size of yaxis label}
        \AttributeTok{las =} \DecValTok{1}\NormalTok{) }\CommentTok{\# controls angle of axis labels}
\FunctionTok{abline}\NormalTok{(}\AttributeTok{h=}\DecValTok{0}\NormalTok{, }\AttributeTok{lty=}\DecValTok{2}\NormalTok{, }\AttributeTok{col =} \StringTok{"red"}\NormalTok{, }\AttributeTok{lwd=}\DecValTok{2}\NormalTok{) }\CommentTok{\# adds horizontal line at 0 with dashes }
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{04-Visualization_files/figure-pdf/unnamed-chunk-22-1.pdf}

}

\end{figure}

How should we interpret these results?

\begin{itemize}
\tightlist
\item
  In the Marriage condition, it looks like on average, views toward gay
  couples became warmer (the bar is positive) after the conversations
  with canvassers about same-sex marriage.
\item
  In contrast, the views of people in the Recycling or No Contact
  conditions did not change much and if anything, became slightly
  colder.
\item
  Comparing between these bars, then, it seems like there is an
  ``average treatment effect'' given that the change in the Marriage
  condition was different from the Recycling an No Contact control
  groups.
\end{itemize}

\hypertarget{scatterplots}{%
\section{Scatterplots}\label{scatterplots}}

It turns out that study was completely fabricated, and the article was
eventually
\href{https://www.newyorker.com/science/maria-konnikova/how-a-gay-marriage-study-went-wrong}{retracted}.

How did people know? Well a team of researchers became suspicious based
on exploratory analyses they conducted with the data. Let's do a few of
these to learn about scatterplots and histograms.

Scatter plots show the relationship between two numeric variables.

A common way to describe and quantify a relationship is through
correlation.

\begin{itemize}
\tightlist
\item
  Correlation: When \(x\) changes, \(y\) also changes by a fixed
  proportion

  \begin{itemize}
  \tightlist
  \item
    Asks: If you are a certain degree above the mean of \(x\), are you
    similarly that much above the mean of \(y\)?
  \item
    Positive correlation: data cloud slopes up;
  \item
    Negative correlation: data cloud slopes down;
  \item
    High positive or negative correlation: data cluster tightly around a
    sloped line
  \item
    Not affected by changes of scale: cm vs.~inch, etc.
  \end{itemize}
\end{itemize}

Range of Correlation is between \(-1\) and \(1\)

\begin{itemize}
\tightlist
\item
  Look at the graphs below for examples of high and low positive and
  negative correlations.
\end{itemize}

\begin{figure}

{\centering \includegraphics[width=0.6\textwidth,height=\textheight]{images/corrdummies.png}

}

\caption{From \emph{R for Dummies}}

\end{figure}

The \texttt{plot()} function in R works using x and y coordinates.

\begin{itemize}
\tightlist
\item
  We have to tell R precisely at which x- and y- coordinates to place
  points (e.g., place a point at \texttt{x=20} and \texttt{y=40})
\item
  In practice, we will generally supply R with a vector of
  x-coordindates and a vector of corresponding y-coordinates.
\end{itemize}

To illustrate a scatterplot, we will examine the relationship between
the Wave 1 and Wave 2 feeling thermometer scores in the field
experiment, for just the control ``No Contact'' condition.

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Subset data to look at control only}
\NormalTok{controlonly }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(marriage1, treatment }\SpecialCharTok{==} \StringTok{"No Contact"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

In the \texttt{plot()}, we supply the x and y vectors.

\begin{itemize}
\tightlist
\item
  \texttt{xlim} and \texttt{ylim} specify the range of the x and y axis.
\item
  \texttt{pch} is the point type. You can play around with that number
  to view different plot types
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(}\AttributeTok{x=}\NormalTok{controlonly}\SpecialCharTok{$}\NormalTok{therm1, }\AttributeTok{y=}\NormalTok{controlonly}\SpecialCharTok{$}\NormalTok{therm2, }
     \AttributeTok{main =} \StringTok{"Relationship between W1 and  W2"}\NormalTok{,}
     \AttributeTok{xlab =} \StringTok{"Wave 1"}\NormalTok{, }\AttributeTok{xlim =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{100}\NormalTok{),}
     \AttributeTok{ylab =} \StringTok{"Wave 2"}\NormalTok{, }\AttributeTok{ylim =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{100}\NormalTok{),}
     \AttributeTok{pch =} \DecValTok{20}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{04-Visualization_files/figure-pdf/unnamed-chunk-24-1.pdf}

}

\end{figure}

The correlation looks extremely high! It is positively sloped and
tightly clustered.

In fact, if we use R's function to quantify a correlation between two
variables, we will see it is a correlation above .99, very close to the
maximum value.

\begin{itemize}
\tightlist
\item
  By default, R calculate the ``pearson'' correlation coefficient, a
  number that will be between -1 and 1. It represents the strength of
  the linear association between two variables.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# use = "pairwise" means to use all observations where neither variable has missing NA data}
\FunctionTok{cor}\NormalTok{(marriage1}\SpecialCharTok{$}\NormalTok{therm1, marriage1}\SpecialCharTok{$}\NormalTok{therm2, }\AttributeTok{use =} \StringTok{"pairwise"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0.995313
\end{verbatim}

This high correlation was unusual for this type of data.

\begin{itemize}
\tightlist
\item
  Feeling thermometers suffer from low reliability. How a person answers
  the question at one point in time (perhaps 83) in Wave 1 often differs
  from the numbers they say when asked again at a future point in time
  in Wave 2. A person's responses often aren't that stable.
\item
  Because there was such a high correlation, it suggested that the data
  might not have been generated by real human responses
\end{itemize}

\hypertarget{histograms}{%
\section{Histograms}\label{histograms}}

The researchers later discovered the Wave 1 data was suspiciously
correlated with an existing survey: 2012 CCAP.

\begin{itemize}
\tightlist
\item
  They believe the researcher likely used CCAP for Wave 1 - used survey
  responses from real humans that took a real survey -- but not the
  humans that the researcher claimed to interview in the experiment.
\item
  Then the researcher generated the Wave 2 data by adding random noise
  to the Wave 1 data
\item
  Part of why they believe this has to do with a histogram plot they
  generated to compare Waves 1 and 2
\end{itemize}

A histogram is a useful plot for summarizing the distribution of a
single variable.

\begin{itemize}
\tightlist
\item
  It shows the frequency of observations (e.g., the number of survey
  respondents) who give an answer within a particular interval of
  numeric values
\end{itemize}

Because a histogram is a single variable summary, we just supply R with
the numeric variable we want to summarize.

\begin{itemize}
\tightlist
\item
  The new argument here \texttt{breaks} tells R how many of the
  individual rectangles we want. You can play around with that number to
  see how the plot changes.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{hist}\NormalTok{(}\AttributeTok{x=}\NormalTok{controlonly}\SpecialCharTok{$}\NormalTok{therm1, }\AttributeTok{breaks=}\DecValTok{50}\NormalTok{,}
     \AttributeTok{main =} \StringTok{"W1 Histogram"}\NormalTok{, }\AttributeTok{ylim =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{1000}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{04-Visualization_files/figure-pdf/unnamed-chunk-26-1.pdf}

}

\end{figure}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{hist}\NormalTok{(}\AttributeTok{x=}\NormalTok{controlonly}\SpecialCharTok{$}\NormalTok{therm2,}\AttributeTok{breaks=}\DecValTok{50}\NormalTok{,}
     \AttributeTok{main =} \StringTok{"W2 Histogram"}\NormalTok{, }\AttributeTok{ylim =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{1000}\NormalTok{))  }
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{04-Visualization_files/figure-pdf/unnamed-chunk-26-2.pdf}

}

\end{figure}

The researchers noticed that the heaping patterns were different between
Wave 1 and Wave 2.

\begin{itemize}
\tightlist
\item
  When real humans answer these types of feeling thermometer questions,
  we often see heaping (tall spikes) at values of 0, 50, and 100. Humans
  tend to gravitate toward those nice round numbers to anchor their
  responses. In addition, often researchers might recode people with
  missing responses (people who skip a question), as having a score of
  50, increasing the number at that point.

  \begin{itemize}
  \tightlist
  \item
    Wave 1 has a lot of this heaping-- look at the higher bars around 0,
    50, and 100, suggesting a lot of survey respondents gave those
    answers.
  \item
    However, Wave 2 has less heaping, particularly at 50. This suggested
    to the researchers that the Wave 2 data were likely generated by a
    computer and not real humans
  \end{itemize}
\end{itemize}

\hypertarget{happy-research-ending}{%
\subsection{Happy research ending}\label{happy-research-ending}}

While the original article was retracted

\begin{itemize}
\tightlist
\item
  Researchers who found irregularities received funding to conduct
  similar studies with real data this time
\item
  Multiple publications suggest the canvassing approach was effective:

  \begin{itemize}
  \tightlist
  \item
    Broockman and Kalla. 2016. ``Durably reducing transphobia: A field
    experiment on door-to-door canvassing'' Science 352 no. 6282.
  \item
    Broockman and Kalla. 2020. ``Reducing exclusionary attitudes through
    interpersonal conversation: evidence from three field experiments.''
    American Political Science Review
  \item
    Kalla and Broockman. 2021. ``Which narrative strategies durably
    reduce prejudice? Evidence from field and survey experiments
    supporting the efficacy of perspective-getting.'' American Journal
    of Political Science. Forthcoming.
  \end{itemize}
\end{itemize}

\hypertarget{line-plots}{%
\section{Line Plots}\label{line-plots}}

In this application, we will create a line plot in R. Line plots are
built very similarly to scatterplots. We provide R an input of values
for the x-axis and corresponding values on the y-axis.

For example, if we wanted to plot the US life expectancy for the past
few years from 2018-2021, we could do the following based on data from
the National Center for Health Statistics:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{years }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{2018}\NormalTok{, }\DecValTok{2019}\NormalTok{, }\DecValTok{2020}\NormalTok{, }\DecValTok{2021}\NormalTok{)}
\NormalTok{yvalues }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\FloatTok{78.7}\NormalTok{, }\FloatTok{78.8}\NormalTok{, }\DecValTok{77}\NormalTok{, }\FloatTok{76.1}\NormalTok{)}

\DocumentationTok{\#\# Key to making this a line plot is type="l"}
\FunctionTok{plot}\NormalTok{(}\AttributeTok{x=}\NormalTok{years,}
     \AttributeTok{y=}\NormalTok{yvalues,}
     \AttributeTok{type=}\StringTok{"l"}\NormalTok{,}
     \AttributeTok{main=}\StringTok{"US Life Expectancy by year"}\NormalTok{,}
     \AttributeTok{xlab =} \StringTok{"Year"}\NormalTok{,}
     \AttributeTok{ylab =} \StringTok{"Life Expectancy at birth"}\NormalTok{,}
     \AttributeTok{las=}\DecValTok{2}\NormalTok{ ) }\CommentTok{\# orientation of axis labels}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{04-Visualization_files/figure-pdf/unnamed-chunk-27-1.pdf}

}

\end{figure}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Alternate approach is to customize axis}
\FunctionTok{plot}\NormalTok{(}\AttributeTok{x=}\DecValTok{1}\SpecialCharTok{:}\DecValTok{4}\NormalTok{,}
     \AttributeTok{y=}\NormalTok{yvalues,}
     \AttributeTok{type=}\StringTok{"l"}\NormalTok{,}
     \AttributeTok{main=}\StringTok{"US Life Expectancy by year"}\NormalTok{,}
     \AttributeTok{xlab =} \StringTok{"Year"}\NormalTok{,}
     \AttributeTok{ylab =} \StringTok{"Life Expectancy at birth"}\NormalTok{,}
     \AttributeTok{las=}\DecValTok{2}\NormalTok{, }\CommentTok{\# orientation of axis labels}
     \AttributeTok{xaxt=}\StringTok{"n"}\NormalTok{) }\CommentTok{\# remove original axis}
\FunctionTok{axis}\NormalTok{(}\DecValTok{1}\NormalTok{, }\AttributeTok{at=}\DecValTok{1}\SpecialCharTok{:}\DecValTok{4}\NormalTok{, }\AttributeTok{labels =}\NormalTok{ years) }\CommentTok{\# label points only at relevant ticks}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{04-Visualization_files/figure-pdf/unnamed-chunk-28-1.pdf}

}

\end{figure}

The two vectors of values may come from variables in your data or may
come from calculations you make using those variables.

Let's do a more complex example and break this down step by step.

\hypertarget{application-trends-during-covid}{%
\section{Application: Trends during
COVID}\label{application-trends-during-covid}}

Since the onset of the pandemic in 2020, researchers have evaluated
attitudinal and behavioral responses to policy changes, political
messages, and COVID case/hospitalization/death rates.

\begin{itemize}
\tightlist
\item
  Survey data on attitudes and self-reported behavior
\item
  Health care provider administrative data
\item
  Mobile phone data to track locations
\item
  Social media data to track attitudes and mobility
\end{itemize}

\textbf{\emph{Example: Using Survey data from over 1.1 million
responses}} to measure concern about the coronavirus over time.

\begin{itemize}
\tightlist
\item
  Clinton, Joshua, et
  al.~``\href{https://www.science.org/doi/10.1126/sciadv.abd7204}{Partisan
  pandemic: How partisanship and public health concerns affect
  individuals' social mobility during COVID-19}.'' Science advances 7.2
  (2021): eabd7204.
\end{itemize}

\includegraphics{images/covidsurvey.png}

\textbf{\emph{Example: Using the geotracking data of 15million
smartphones}} per day to compute percentage reduction in general
movement and visiting non-essential services relative to before COVID-19
(before March 9).

\begin{itemize}
\tightlist
\item
  Gollwitzer, Anton, et
  al.~``\href{https://www.nature.com/articles/s41562-020-00977-7}{Partisan
  differences in physical distancing are linked to health outcomes
  during the COVID-19 pandemic}.'' Nature human behaviour 4.11 (2020):
  1186-1197.
\end{itemize}

\includegraphics{images/covidphone.png}

\textbf{\emph{Example: Using Twitter geolocation data}} to track how
much movement users have by looking at the distances from all locations
where a given user has tweeted.

\begin{itemize}
\tightlist
\item
  Paiheng Xu, Mark Dredze, David A Broniatowski.
  ``\href{https://socialmobility.covid19dataresources.org/}{The Twitter
  Social Mobility Index: Measuring Social Distancing Practices from
  Geolocated Tweets}.'' Journal of Medical Internet Research (JMIR),
  2020.
\end{itemize}

\includegraphics{images/covidtwitter.png}

We will use the Twitter social mobility index to study how the movement
of geo-located Twitter users changed from 2019 into April 2022.

\begin{itemize}
\tightlist
\item
  We will compare this movement for users located in the Northeast
  vs.~South
\end{itemize}

Each row of the dataset represents a week of the year. Each column
represents a particular geography for which social mobility was
calculated by the researchers.

\begin{itemize}
\tightlist
\item
  \texttt{Dates} indicates the date
\item
  \texttt{Northeast}: social mobility data for those in the northeast of
  the U.S.
\item
  \texttt{South}: social mobility data for those in the south of the
  U.S.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Load the data from the author Mark Dredze\textquotesingle{}s website}
\NormalTok{covid }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"https://raw.githubusercontent.com/mdredze/covid19\_social\_mobility.github.io/master/data/longitudinal\_compiled.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Just like we have encountered numeric, factor, and character variables,
R also has the ability to treat variables specifically as dates. We will
want R to treat the date variable we read in as a date, and not as raw
text or some other variable type. To do this, we will use the
\texttt{as.Date} function.

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Date variable original format and class}
\FunctionTok{head}\NormalTok{(covid}\SpecialCharTok{$}\NormalTok{Dates)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "2019-01-01" "2019-01-07" "2019-01-14" "2019-01-21" "2019-01-28"
[6] "2019-02-04"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(covid}\SpecialCharTok{$}\NormalTok{Dates)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "character"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Convert to class Date}
\NormalTok{covid}\SpecialCharTok{$}\NormalTok{Dates }\OtherTok{\textless{}{-}} \FunctionTok{as.Date}\NormalTok{(covid}\SpecialCharTok{$}\NormalTok{Date)}
\FunctionTok{head}\NormalTok{(covid}\SpecialCharTok{$}\NormalTok{Dates)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "2019-01-01" "2019-01-07" "2019-01-14" "2019-01-21" "2019-01-28"
[6] "2019-02-04"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(covid}\SpecialCharTok{$}\NormalTok{Dates)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "Date"
\end{verbatim}

The researchers continue to add to these data. Let's look at the portion
of data from 2019 to April 2022.

\begin{itemize}
\tightlist
\item
  Note the use of \texttt{as.Date} again to make sure R knows our text
  should be treated as a date
\item
  Note the use of the greater than or equal to \texttt{\textgreater{}=}
  and less than or equal signs \texttt{\textless{}=} to specify which
  rows we want to keep in the data. We want rows that are in dates after
  January 1, 2019 and (\texttt{\&}) on or before April 25, 2022.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{covidsub }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(covid, Dates }\SpecialCharTok{\textgreater{}=} \FunctionTok{as.Date}\NormalTok{(}\StringTok{"2019{-}01{-}01"}\NormalTok{) }\SpecialCharTok{\&}
\NormalTok{                     Dates }\SpecialCharTok{\textless{}=} \FunctionTok{as.Date}\NormalTok{(}\StringTok{"2022{-}04{-}25"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

These data are collected by week. That is very detailed. While that may
be useful, let us create another variable that contains just the month
and year, which will allow us to calculate the average per month. With a
date variable, we can use the \texttt{format} function to change the
format to just year and month.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{covidsub}\SpecialCharTok{$}\NormalTok{monthyear }\OtherTok{\textless{}{-}} \FunctionTok{format}\NormalTok{(covidsub}\SpecialCharTok{$}\NormalTok{Dates, }\StringTok{"\%Y{-}\%m"}\NormalTok{)}
\FunctionTok{range}\NormalTok{(covidsub}\SpecialCharTok{$}\NormalTok{monthyear)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "2019-01" "2022-04"
\end{verbatim}

Where we are going \ldots{}

\includegraphics{04-Visualization_files/figure-pdf/unnamed-chunk-33-1.pdf}

Starting from the bottom \ldots{}

\begin{itemize}
\tightlist
\item
  Let's first create a scatterplot by providing R with our two variables
\item
  In a trend/line plot, we want each month on the x-axis
\item
  We want our outcome on the y-axis, in this case, average social
  mobility by month
\item
  Ultimately we will want to compare the Northeast with the South. We
  will plot one line at a time, starting with the Northeast
\end{itemize}

We first need to find the average by month. Recall our \texttt{tapply()}
function.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mobilitybymonthNE }\OtherTok{\textless{}{-}} \FunctionTok{tapply}\NormalTok{(covidsub}\SpecialCharTok{$}\NormalTok{Northeast, covidsub}\SpecialCharTok{$}\NormalTok{monthyear, mean,}
                          \AttributeTok{na.rm=}\NormalTok{T)}

\NormalTok{mobilitybymonthSO }\OtherTok{\textless{}{-}} \FunctionTok{tapply}\NormalTok{(covidsub}\SpecialCharTok{$}\NormalTok{South, covidsub}\SpecialCharTok{$}\NormalTok{monthyear, mean,}
                          \AttributeTok{na.rm=}\NormalTok{T)}
\end{Highlighting}
\end{Shaded}

Let's look at the output for the Northeast. Each value is what we
ultimately want on the y-axis-- the average social mobility in a given
month.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mobilitybymonthNE}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 2019-01  2019-02  2019-03  2019-04  2019-05  2019-06  2019-07  2019-08 
51.22066 52.26420 63.20130 61.38417 61.27622 60.49753 58.91779 61.20730 
 2019-09  2019-10  2019-11  2019-12  2020-01  2020-02  2020-03  2020-04 
54.44546 54.93814 56.59830 55.44538 51.12414 45.80660 34.55917 18.15076 
 2020-05  2020-06  2020-07  2020-08  2020-09  2020-10  2020-11  2020-12 
23.29190 28.71901 27.02149 32.73828 29.07536 32.07877 29.83641 30.56208 
 2021-01  2021-02  2021-03  2021-04  2021-05  2021-06  2021-07  2021-08 
28.75507 28.76227 35.35340 45.02537 48.19897 50.18401 52.96105 51.19241 
 2021-09  2021-10  2021-11  2021-12  2022-01  2022-02  2022-03  2022-04 
45.81695 49.15654 48.69051 51.24941 46.96813 53.55241 59.70933 54.04312 
\end{verbatim}

We want to plot them each at their own point on the x-axis, from the
first month to the last month. We can start by creating a vector of the
same length as we have months:

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(mobilitybymonthNE)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
[26] 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40
\end{verbatim}

These become our two inputs in the plot.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(}\AttributeTok{x=}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(mobilitybymonthNE),}
     \AttributeTok{y=}\NormalTok{mobilitybymonthNE, }\AttributeTok{pch=}\DecValTok{16}\NormalTok{) }\CommentTok{\# pch is point type}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{04-Visualization_files/figure-pdf/unnamed-chunk-37-1.pdf}

}

\end{figure}

We now transform it to a line by specifying \texttt{type="l"}

\begin{itemize}
\tightlist
\item
  By default, R creates a plot with \texttt{type=p} for points. R also
  has \texttt{type=b} which has both a line and points.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(}\AttributeTok{x=}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(mobilitybymonthNE),}
     \AttributeTok{y=}\NormalTok{mobilitybymonthNE, }\AttributeTok{type=}\StringTok{"l"}\NormalTok{) }\CommentTok{\# makes it a line}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{04-Visualization_files/figure-pdf/unnamed-chunk-38-1.pdf}

}

\end{figure}

Let us change the aesthetics a bit by adding labels and removing the
border with \texttt{bty="n"}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(}\AttributeTok{x=}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(mobilitybymonthNE),}
     \AttributeTok{y=}\NormalTok{mobilitybymonthNE,}
     \AttributeTok{type=}\StringTok{"l"}\NormalTok{, }
     \AttributeTok{main=}\StringTok{"Social Mobility by Month and Region"}\NormalTok{,}
     \AttributeTok{ylab=}\StringTok{"Twitter Social Mobility Index"}\NormalTok{,}
     \AttributeTok{xlab=}\StringTok{""}\NormalTok{,}
     \AttributeTok{ylim =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{80}\NormalTok{), }\CommentTok{\# y{-}axis limits}
     \AttributeTok{las=}\DecValTok{1}\NormalTok{, }\CommentTok{\# orientation of axis labels}
     \AttributeTok{lwd=}\DecValTok{2}\NormalTok{, }\CommentTok{\# line width}
     \AttributeTok{bty=}\StringTok{"n"}\NormalTok{) }\CommentTok{\# removes border}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{04-Visualization_files/figure-pdf/unnamed-chunk-39-1.pdf}

}

\end{figure}

Let's add a comparison line with the \texttt{lines()} function to look
at trends for the south.

\begin{itemize}
\tightlist
\item
  Note that this is outside of the \texttt{plot()} function, but the
  inputs are very similar. We supply a set of x and y coordindates.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(}\AttributeTok{x=}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(mobilitybymonthNE),}
     \AttributeTok{y=}\NormalTok{mobilitybymonthNE,}
     \AttributeTok{type=}\StringTok{"l"}\NormalTok{, }
     \AttributeTok{main=}\StringTok{"Social Mobility by Month and Region"}\NormalTok{,}
     \AttributeTok{ylab=}\StringTok{"Twitter Social Mobility Index"}\NormalTok{,}
     \AttributeTok{xlab=}\StringTok{""}\NormalTok{,}
     \AttributeTok{ylim =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{80}\NormalTok{), }\CommentTok{\# y{-}axis limits}
     \AttributeTok{las=}\DecValTok{1}\NormalTok{, }\CommentTok{\# orientation of axis labels}
     \AttributeTok{lwd=}\DecValTok{2}\NormalTok{, }\CommentTok{\# line width}
     \AttributeTok{bty=}\StringTok{"n"}\NormalTok{) }\CommentTok{\# removes border}
\DocumentationTok{\#\# Add line to the plot }
\FunctionTok{lines}\NormalTok{(}\AttributeTok{x=}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(mobilitybymonthSO),}
     \AttributeTok{y=}\NormalTok{mobilitybymonthSO, }\AttributeTok{col=}\StringTok{"red3"}\NormalTok{, }\AttributeTok{lwd=}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{04-Visualization_files/figure-pdf/unnamed-chunk-40-1.pdf}

}

\end{figure}

Let's create our own axis for the plot to add detail. To do this, we add
\texttt{xaxt} to the \texttt{plot} function and then use \texttt{axis()}
below the function.

The labels we will add are the actual months in the data. These happen
to be the labels or \texttt{names} of our vectors:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{names}\NormalTok{(mobilitybymonthNE)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] "2019-01" "2019-02" "2019-03" "2019-04" "2019-05" "2019-06" "2019-07"
 [8] "2019-08" "2019-09" "2019-10" "2019-11" "2019-12" "2020-01" "2020-02"
[15] "2020-03" "2020-04" "2020-05" "2020-06" "2020-07" "2020-08" "2020-09"
[22] "2020-10" "2020-11" "2020-12" "2021-01" "2021-02" "2021-03" "2021-04"
[29] "2021-05" "2021-06" "2021-07" "2021-08" "2021-09" "2021-10" "2021-11"
[36] "2021-12" "2022-01" "2022-02" "2022-03" "2022-04"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(}\AttributeTok{x=}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(mobilitybymonthNE),}
     \AttributeTok{y=}\NormalTok{mobilitybymonthNE,}
     \AttributeTok{type=}\StringTok{"l"}\NormalTok{, }
     \AttributeTok{main=}\StringTok{"Social Mobility by Month and Region"}\NormalTok{,}
     \AttributeTok{ylab=}\StringTok{"Twitter Social Mobility Index"}\NormalTok{,}
     \AttributeTok{xlab=}\StringTok{""}\NormalTok{,}
     \AttributeTok{ylim =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{80}\NormalTok{),}
     \AttributeTok{las=}\DecValTok{1}\NormalTok{, }
     \AttributeTok{lwd=}\DecValTok{2}\NormalTok{, }
     \AttributeTok{bty=}\StringTok{"n"}\NormalTok{,}
     \AttributeTok{xaxt=}\StringTok{"n"}\NormalTok{) }\CommentTok{\# removes original x{-}axis}
\DocumentationTok{\#\# Add line to the plot }
\FunctionTok{lines}\NormalTok{(}\AttributeTok{x=}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(mobilitybymonthSO),}
     \AttributeTok{y=}\NormalTok{mobilitybymonthSO, }\AttributeTok{col=}\StringTok{"red3"}\NormalTok{, }\AttributeTok{lwd=}\DecValTok{2}\NormalTok{)}
\DocumentationTok{\#\# add the axis the "1" means x{-}axis. A "2" would create a y{-}axis}
\FunctionTok{axis}\NormalTok{(}\DecValTok{1}\NormalTok{, }\AttributeTok{at =} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(mobilitybymonthNE), }
     \AttributeTok{labels=}\FunctionTok{names}\NormalTok{(mobilitybymonthNE), }\AttributeTok{las=}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{04-Visualization_files/figure-pdf/unnamed-chunk-42-1.pdf}

}

\end{figure}

Finally, let's add a \texttt{legend()}. Now we're here!

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(}\AttributeTok{x=}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(mobilitybymonthNE),}
     \AttributeTok{y=}\NormalTok{mobilitybymonthNE,}
     \AttributeTok{type=}\StringTok{"l"}\NormalTok{, }
     \AttributeTok{main=}\StringTok{"Social Mobility by Month and Region"}\NormalTok{,}
     \AttributeTok{ylab=}\StringTok{"Twitter Social Mobility Index"}\NormalTok{,}
     \AttributeTok{xlab=}\StringTok{""}\NormalTok{,}
     \AttributeTok{ylim =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{80}\NormalTok{),}
     \AttributeTok{las=}\DecValTok{1}\NormalTok{, }
     \AttributeTok{lwd=}\DecValTok{2}\NormalTok{, }
     \AttributeTok{bty=}\StringTok{"n"}\NormalTok{,}
     \AttributeTok{xaxt=}\StringTok{"n"}\NormalTok{) }\CommentTok{\# removes original x{-}axis}
\DocumentationTok{\#\# Add line to the plot }
\FunctionTok{lines}\NormalTok{(}\AttributeTok{x=}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(mobilitybymonthSO),}
     \AttributeTok{y=}\NormalTok{mobilitybymonthSO, }\AttributeTok{col=}\StringTok{"red3"}\NormalTok{, }\AttributeTok{lwd=}\DecValTok{2}\NormalTok{)}
\DocumentationTok{\#\# add the axis the "1" means x{-}axis. A "2" would create a y{-}axis}
\FunctionTok{axis}\NormalTok{(}\DecValTok{1}\NormalTok{, }\AttributeTok{at =} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(mobilitybymonthNE), }
     \AttributeTok{labels=}\FunctionTok{names}\NormalTok{(mobilitybymonthNE), }\AttributeTok{las=}\DecValTok{2}\NormalTok{)}

\DocumentationTok{\#\# Add legend, "bottomleft" indicates where on the plot to locate it}
\DocumentationTok{\#\# Could use "topright" instead, for example}
\FunctionTok{legend}\NormalTok{(}\StringTok{"bottomleft"}\NormalTok{,  }\AttributeTok{col=}\FunctionTok{c}\NormalTok{(}\StringTok{"red3"}\NormalTok{, }\StringTok{"black"}\NormalTok{), }
       \FunctionTok{c}\NormalTok{(}\StringTok{"South"}\NormalTok{, }\StringTok{"Northeast"}\NormalTok{), }
       \AttributeTok{cex =}\NormalTok{ .}\DecValTok{7}\NormalTok{, }\CommentTok{\# size of legend}
       \AttributeTok{lwd=}\DecValTok{2}\NormalTok{,}
       \AttributeTok{bty=}\StringTok{"n"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{04-Visualization_files/figure-pdf/unnamed-chunk-43-1.pdf}

}

\end{figure}

\hypertarget{visual-tips-and-tricks}{%
\section{Visual tips and tricks}\label{visual-tips-and-tricks}}

Recall we said the goals of visualization are to communicate information

\begin{itemize}
\tightlist
\item
  Transparently (show me the data!)
\item
  Quickly
\item
  Simply
\item
  Accurately
\item
  And with a little work: beautifully
\end{itemize}

What NOT to communicate?

\includegraphics[width=0.7\textwidth,height=\textheight]{images/honestrunway.jpeg}

Claus Wilke provides an overview of rules of thumb to fall when creating
a data visualization on the Serial Mentor
\href{https://serialmentor.com/dataviz/}{website}.

An example is below

\includegraphics{images/ugbadwrong.png}

Overall, the best thing to do is to look at your visual from a
consumer's
\href{https://www.youtube.com/watch?v=nQJEp-k-ogs\&ab_channel=ArianaGrandeVevo}{point
of view}. You want your visuals to be intuitive enough for a viewer to
be able to interpret it without too much help from you or explanatory
text elsewhere in a paper or presentation. Our goal is to help consumers
of our data understand the main takeaways of our research easily and
accurately.

\begin{itemize}
\tightlist
\item
  We want to make sure our visuals always have informative labels that a
  lay person can understand (instead of technical variable names, we can
  use plain language)

  \begin{itemize}
  \tightlist
  \item
    We may need to add a legend or additional text to a visual to help
    with this
  \end{itemize}
\item
  We want to choose colors to convey information. We want to avoid
  colors that are hard to see or might distract consumers.
\item
  The axis dimensions should not be misleading. If the goal is to
  compare two or more plots to each other, we would want them to have
  similar axes, for example.
\end{itemize}

\hypertarget{common-r-plotting-functions-and-arguments}{%
\section{Common R plotting functions and
arguments}\label{common-r-plotting-functions-and-arguments}}

Here is a refresher of several of the functions and arguments we have
come across.

Create a plot

\begin{itemize}
\tightlist
\item
  \texttt{plot()}: for scatterplots and trend plots
\item
  \texttt{barplot()}: for barplot comparisons across categories
\item
  \texttt{boxplot()}: boxplot for summaries of numeric variables
\item
  \texttt{hist()}: for histogram summaries of a single numeric variable
\end{itemize}

Aesthetic arguments within a plot

\begin{itemize}
\tightlist
\item
  \texttt{main\ =}: Specifies the main title of the plot. Supply text
  (e.g., \texttt{main\ =\ "my\ title"})
\item
  \texttt{ylab\ =}: Specifies the title of the y-axis. Supply text
  (e.g., \texttt{ylab\ =\ "Mean\ of\ variable"})
\item
  \texttt{xlab\ =}: Specifies the title of the x-axis. Supply text
  (e.g., \texttt{xlab\ =\ "X\ variable\ name"})
\item
  \texttt{ylim\ =}: Specifies the range of the y-axis. Supply vector of
  two numbers (e.g., \texttt{ylim\ =\ c(0,\ 100)})
\item
  \texttt{xlim\ =}: Specifies the range of the x-axis. Supply vector of
  two numbers (e.g., \texttt{xlim\ =\ c(0,\ 100)})
\item
  \texttt{bty="n"}: Removes the border box around the plot
\item
  \texttt{cex}, \texttt{cex.main}, \texttt{cex.names}, \texttt{cex.lab},
  \texttt{cex.axis}: Changes the size of different elements of a plot.
  Default is 1, so a value of .8 would be smaller than default, and 1.2
  would be bigger than normal.
\item
  \texttt{type\ =}: Specifies the type of plot (e.g., \texttt{type="l"}
  is a line plot, \texttt{type="b"} is a plot with points and lines
  connecting them)
\item
  \texttt{lwd=}: Specifies the width of a line on a plot. Default is 1.
  E.g., \texttt{lwd=3} makes a line much thicker
\item
  \texttt{pch=}: Specifies the point type. E.g., \texttt{pch=15}
\item
  \texttt{lty=}: Specifies the line type. E.g., \texttt{lty=2} is a
  dashed line
\item
  \texttt{col=}: Specifies the color of the central element of the plot.
  Can take a single color or vector of colors. Use \texttt{colors()} in
  the console to see all R colors.
\item
  \texttt{names}: Specifies a set of labels in a barplot
\end{itemize}

Ways to annotate a plot (generally added below the initial plotting
function)

\begin{itemize}
\tightlist
\item
  \texttt{abline()}: Adds a line to the plot at a particular point on
  the x- or y- intercept, either horizontal, vertical, or of a
  particular slope

  \begin{itemize}
  \tightlist
  \item
    Example: Adding a horizontal line at a particular at a y value of 2
    \texttt{abline(h=2)}
  \item
    Example: Adding a vertical line at a particular at a x value of 2
    \texttt{abline(v=2)}
  \end{itemize}
\item
  \texttt{lines(x=,\ y=)}: Adds a line connecting pairs of x- and
  y-coordinates. We used this to add the South line to the social
  mobility plot.
\item
  \texttt{axis()}: Used to replace the default x- or y- axis that R will
  create with a customized axis

  \begin{itemize}
  \tightlist
  \item
    To create an original y-axis, use
    \texttt{axis(2,\ vectorofvalues,\ labels)} and specify
    \texttt{yaxt="n"} inside the plotting function to remove the
    original y-axis.
  \item
    To create an original x-axis, use
    \texttt{axis(1,\ vectorofvalues,\ labels)} and specify
    \texttt{xaxt="n"} inside the plotting function to remove the
    original x-axis.
  \end{itemize}
\item
  \texttt{legend()}: Adds a legend to a plot. Can specify the location
  as the first argument (e.g., \texttt{"bottomleft"} or
  \texttt{"topright"})
\item
  \texttt{text()}: Adds text to a plot at specific x- and y- locations.
  (E.g., \texttt{text(x=3,\ y=4,\ "Here\ is\ a\ point"}). The x and y
  arguments can be single numbers or a vector of numbers. x and y need
  to be the same length.
\item
  \texttt{points()}: Adds points to a plot at specific x- and y-
  locations. Inputs are much like \texttt{plot}
\end{itemize}

\hypertarget{a-note-on-ggplot}{%
\section{\texorpdfstring{A note on
\texttt{ggplot}}{A note on ggplot}}\label{a-note-on-ggplot}}

R has a number of open-source packages that people can use to expand the
set of capabilities for visualization and analysis. These can be
installed through RStudio. We will look at one of these packages:
\texttt{ggplot2}.

\textbf{\emph{Using ggplot will be extra-credit at this point in the
course. We may return to it later in the semester as part of the main
curriculum. Reviewing this section of the notes is optional.}}

The ``gg'' in ggplot2 stands for the ``Grammar of Graphics.'' This
program provides another framework for creating figures in R. According
to Hadley Wickham, ``ggplot2 provides beautiful, hassle-free plots that
take care of fiddly details like drawing legends.''

Practically speaking, \texttt{ggplot()} is another tool to plot the same
types of figures we have been making in class. Some people prefer
\texttt{ggplot2} because they find the logic of building figures more
intuitive using this framework and/or more aesthetically pleasing.
However, both \texttt{ggplot()} and the plots we have been making in
class can accomplish the same ultimate goals of data visualization-- to
communicate information transparently, quickly, accurately, simply, and
beautifully. Which types of plots you may prefer is up to your own
taste.

Think of packages like apps on a smartphone.

\begin{itemize}
\tightlist
\item
  If RStudio is our smartphone, we install a package like you install an
  app on the phone. You only have to do this once, though occasionally
  you may want or need to update the installation to a new version.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Run this line in your R console}
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"ggplot2"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  On a smartphone, every time you want to use an app after you have
  installed it, you have to open the app. Similarly, every time we want
  to open a package in RStudio, we have to open it by using the
  \texttt{library()} command
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Add and run this line in your R script, above the code where you will use functions from the package}
\FunctionTok{library}\NormalTok{(ggplot2)}
\end{Highlighting}
\end{Shaded}

The main plotting function in \texttt{ggplot2} is the \texttt{ggplot()}
function. It will give you access to barplots, boxplots, scatterplots,
histograms, etc.

\begin{itemize}
\tightlist
\item
  The syntax within this package is a little different from the base R
  plotting functions. We will investigate below. For now, here is an
  example of using \texttt{ggplot} to create a boxplot using the
  experiment on social status from earlier in this section.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{status, }\AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{condition, }\AttributeTok{y=}\NormalTok{econcon)) }\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{04-Visualization_files/figure-pdf/unnamed-chunk-46-1.pdf}

}

\end{figure}

The three primary components of a ggplot() are a dataframe
(\texttt{data\ =}), a set of mapping aesthetics (\texttt{aes()}), and
\texttt{geoms} (e.g., geom boxplot, geom bar, geom point, geom line,
etc.).

\begin{itemize}
\tightlist
\item
  The function \texttt{ggplot()} first takes a dataframe that includes
  the values you would like to plot (e.g., \texttt{data\ =\ status}).
\item
  The aesthetics then include the variable names that you want to plot
  on the x and y axis (e.g., \texttt{aes(x=condition,\ y=econcon)})

  \begin{itemize}
  \tightlist
  \item
    Additional mapping aesthetics can be specified. For example, a third
    variable (or a repeat of a previous variable) can also be specified
    (e.g., \texttt{fill\ =}, \texttt{colour\ =}, \texttt{shape\ =}),
    which acts as a grouping variable. If this is specified,
    \texttt{ggplot()} will create a corresponding legend for the plot
    and will color/make different shapes for different groups within
    this third variable (See the boxplot below for an example of
    grouping by condition).
  \end{itemize}
\item
  After closing out the first \texttt{ggplot()} parentheses, you then
  annotate the plot by adding (\texttt{+}) a geometric layer. This is
  essentially where you specify the type of plot (though it is possible
  to have multiple geometric layers).
\item
  Just like with the other plotting functions in R, you can also specify
  a number of other arguments to make your plot more informative and
  aesthetically pleasing. Here, you do this by adding (\texttt{+})
  additional arguments. See examples below (e.g., \texttt{ggtitle},
  \texttt{xlab}, \texttt{ylab} for titles, \texttt{ylim} for y-axis
  limits, etc.)
\item
  Likewise, just like with the other plotting functions, you can save
  your plots as a pdf or png. To do so here, you include the line
  \texttt{ggsave()} just below your plot.
\end{itemize}

There are many more possibilities for plotting with \texttt{ggplot()},
but these should get you started. For additional resources on all that
is gg, I recommend the \href{https://\%20r-graphics.org/}{R Graphics
Cookbook}.

Here is a second version of the boxplot with more aesthetics specified.

\begin{itemize}
\tightlist
\item
  We will color in the boxes based on the collapsed condition variable.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data=}\NormalTok{status, }\AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{condition, }\AttributeTok{y=}\NormalTok{econcon, }\AttributeTok{fill=}\NormalTok{conditionnew)) }\SpecialCharTok{+}
  \DocumentationTok{\#\# Specifies plot type. E.g., also have geom\_point(), geom\_bar()}
  \FunctionTok{geom\_boxplot}\NormalTok{()}\SpecialCharTok{+}
  \DocumentationTok{\#\# Note many arguments are similar to other R functions but the syntax is a little different}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Economic Views by Experimental Condition"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Economic Views"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Experimental Condition"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{ylim}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{1}\NormalTok{)}\SpecialCharTok{+}
  \DocumentationTok{\#\# Changes the overall theme (i.e., color scheme, borders, etc.)}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}\AttributeTok{legend.position=}\StringTok{"bottom"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{04-Visualization_files/figure-pdf/unnamed-chunk-47-1.pdf}

}

\end{figure}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggsave}\NormalTok{(}\StringTok{"myboxplot.pdf"}\NormalTok{, }\AttributeTok{width=}\DecValTok{7}\NormalTok{, }\AttributeTok{height=}\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Here is an example of a histogram from the application on views toward
gay couples.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(controlonly, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{therm1)) }\SpecialCharTok{+}
  \FunctionTok{geom\_histogram}\NormalTok{(}\AttributeTok{binwidth =} \DecValTok{1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"W1 Histogram"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{04-Visualization_files/figure-pdf/unnamed-chunk-48-1.pdf}

}

\end{figure}

Instead of displaying multiple categories through different shapes or
colors, we could also create multiple mini plots instead. This is done
through \texttt{facet}. Let's look at a histogram for each condition for
the thermometers in wave 2.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(marriage1, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{therm2)) }\SpecialCharTok{+}
  \FunctionTok{geom\_histogram}\NormalTok{(}\AttributeTok{binwidth =} \DecValTok{1}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"W2 Histogram by Condition"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Feeling Thermometer Wave 2"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}\SpecialCharTok{+}
  \FunctionTok{facet\_wrap}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{treatmentnew)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Warning: Removed 1042 rows containing non-finite outside the scale range
(`stat_bin()`).
\end{verbatim}

\begin{figure}[H]

{\centering \includegraphics{04-Visualization_files/figure-pdf/unnamed-chunk-49-1.pdf}

}

\end{figure}

We can similarly create a scatter and line plot. Let's use the social
mobility data. Here we see \texttt{geom\_point} and \texttt{geom\_line}.

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Scatterplot}
\FunctionTok{ggplot}\NormalTok{(covidsub, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Dates, }\AttributeTok{y=}\NormalTok{avg\_USA)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Average Social Mobility in US"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Date"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Avg Social Mobility"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
Warning: Removed 4 rows containing missing values or values outside the scale range
(`geom_point()`).
\end{verbatim}

\begin{figure}[H]

{\centering \includegraphics{04-Visualization_files/figure-pdf/unnamed-chunk-50-1.pdf}

}

\end{figure}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Line plot}
\FunctionTok{ggplot}\NormalTok{(covidsub, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x=}\NormalTok{Dates, }\AttributeTok{y=}\NormalTok{avg\_USA)) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{ggtitle}\NormalTok{(}\StringTok{"Average Social Mobility in US"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{xlab}\NormalTok{(}\StringTok{"Date"}\NormalTok{)}\SpecialCharTok{+}
  \FunctionTok{ylab}\NormalTok{(}\StringTok{"Avg Social Mobility"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{04-Visualization_files/figure-pdf/unnamed-chunk-50-2.pdf}

}

\end{figure}

\bookmarksetup{startatroot}

\hypertarget{causalityii}{%
\chapter{Causality with Non-Experimental Data}\label{causalityii}}

In this section, we continue to evaluate causal claims, but this time we
will not have the benefit of experiments.

\textbf{\emph{Recall: Why do we use experiments?}}

We want to evaluate causal claims:

\begin{itemize}
\tightlist
\item
  Does manipulating one factor (a ``treatment'') cause a change in an
  outcome? (\(Y_i(1) - Y_i(0)\))

  \begin{itemize}
  \tightlist
  \item
    But we have a problem: the fundamental problem of causal inference
  \item
    (Can't simultaneously both be treated and untreated - e.g., you
    can't simultaneously be contacted and not contacted by a campaign)
  \item
    So instead, we randomly assign some units to receive a treatment,
    and some not to, and then compare their average outcomes in an
    experiment
  \end{itemize}
\end{itemize}

And because of random assignment of the treatment, we can be confident
that the groups are similar EXCEPT for the treatment

\begin{itemize}
\tightlist
\item
  Therefore, any difference between the two groups in average outcomes
  can be attributed to the treatment
\end{itemize}

\textbf{\emph{But what if we can't randomize the treatment?}}

\hypertarget{why-cant-we-always-experiment}{%
\section{Why can't we always
experiment?}\label{why-cant-we-always-experiment}}

Example: Do political leaders tend to matter for democracy?

\begin{itemize}
\tightlist
\item
  Our outcome: how democratic nations are
\item
  Our causal effect of interest:

  \begin{itemize}
  \tightlist
  \item
    On average, how democratic nations are with their current leaders -
  \item
    On average, how democratic nations would be with different leaders
  \end{itemize}
\item
  Possible Experimental Designs to randomly assign half of countries to
  receive a different political leader

  \begin{itemize}
  \tightlist
  \item
    Rig elections (I.e., Election fraud- Illegal, unethical)
  \item
    Forcibly remove half from office (Probably illegal)
  \item
    Assassinations (Illegal, Immoral, Unethical, etc.)
  \end{itemize}
\end{itemize}

Again, we have problems!!

\hypertarget{what-can-we-do-instead}{%
\subsection{What can we do instead?}\label{what-can-we-do-instead}}

Let's say we want to make a causal claim about the effect of one
variable on an outcome, but we can't think of an experimental design
that will help us estimate this.

\includegraphics{images/popquiz.png}

What do you do?

\hypertarget{causal-identification-strategies}{%
\section{Causal Identification
Strategies}\label{causal-identification-strategies}}

Our goal: Try to ``identify'' the causal effect of one variable on an
outcome. As Montell Jordan once said, this is how we do it:

\begin{itemize}
\tightlist
\item
  Use data we have (that exist out in the world)
\item
  Compare those who are ``treated'' to a relevant comparison group who
  is not treated
\end{itemize}

However, we can't randomize treatment so\ldots.

\begin{itemize}
\tightlist
\item
  We do our best to try to choose a good comparison (one very similar to
  the treatment group, but happens not to be treated)
\end{itemize}

We want to rule out all possible confounding variables and ``alternative
explanations'' for the outcomes we observed.

\hypertarget{example-travis-kelce-jersey-sale-and-instagram-gains}{%
\subsection{Example: Travis Kelce Jersey Sale and Instagram
Gains}\label{example-travis-kelce-jersey-sale-and-instagram-gains}}

In fall 2023, why did Travis Kelce experience an increase in social
media followers?

\begin{itemize}
\tightlist
\item
  Let's use the \texttt{plot()} function to visualize this

  \begin{itemize}
  \tightlist
  \item
    Kelce saw an increase in followers on Fri, Sept 22 of 8786
  \item
    Kelce saw an increase in followers on Sat, Sept 23 of 7242
  \item
    Kelce saw an increase in followers on Sun, Sept 24 of 27249
  \end{itemize}
\item
  When visualizing a trend, we put time on the x-axis
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{time }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Fri, Sept 22"}\NormalTok{, }\StringTok{"Sat, Sept 23"}\NormalTok{, }\StringTok{"Sun, Sept 24"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  We put the values of the outcome on the y-axis
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{followers }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{8786}\NormalTok{, }\DecValTok{7242}\NormalTok{, }\DecValTok{27249}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{line-plots-1}{%
\subsubsection{Line Plots}\label{line-plots-1}}

To make it a line plot, we add \texttt{type\ =\ "l"} or
\texttt{type\ =\ "b"}.

\begin{itemize}
\tightlist
\item
  Note: Because our time is text-based, we cannot add it to the plot
  directly. Instead, we use a placeholder \texttt{1:length(time)}.
\item
  Instead, we add \texttt{xaxt="n"} to remove the default x-axis and add
  \texttt{axis()} below the plot code to add our own custom axis. By
  adding the ``\texttt{1}'', we are indicating it should be drawn on the
  x-axis
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(}\AttributeTok{x=}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(time), }\AttributeTok{y=}\NormalTok{followers,}
     \AttributeTok{type=}\StringTok{"b"}\NormalTok{,}
     \AttributeTok{main =} \StringTok{"Travis Kelce Instagram Follower Gains over Time"}\NormalTok{,}
     \AttributeTok{ylab=}\StringTok{"Instagram Follower Gains"}\NormalTok{,}
     \AttributeTok{xlab=}\StringTok{"Date"}\NormalTok{,}
     \AttributeTok{xaxt=}\StringTok{"n"}\NormalTok{,}
     \AttributeTok{las=}\DecValTok{2}\NormalTok{, }\AttributeTok{cex.axis=}\NormalTok{.}\DecValTok{8}\NormalTok{)}
\FunctionTok{axis}\NormalTok{(}\DecValTok{1}\NormalTok{, }\AttributeTok{at=}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(time), }\AttributeTok{labels=}\NormalTok{time, }\AttributeTok{cex.axis=}\NormalTok{.}\DecValTok{8}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{05-Causalityii_files/figure-pdf/unnamed-chunk-3-1.pdf}

}

\end{figure}

YOUR TURN: Make a causal claim about the increase in Kelce's followers

\begin{itemize}
\tightlist
\item
  What is the outcome? the number of followers
\item
  What is the treatment? what do you think caused the increase
\item
  What are the two counterfactual states of the world under treatment
  vs.~not under treatment?
\end{itemize}

Is this a Taylor Swift effect?

\begin{itemize}
\tightlist
\item
  How could we prove it? What are possible confounders?

  \begin{itemize}
  \tightlist
  \item
    Maybe it's just the effect of playing a game on Sunday?
  \item
    Maybe all NFL players experienced a similar increase?
  \item
    Maybe Kelce had a particularly good game relative to other players?
  \end{itemize}
\end{itemize}

\includegraphics{images/kelce.png}

\hypertarget{example-social-mobility-data}{%
\subsection{Example: Social Mobility
Data}\label{example-social-mobility-data}}

Since the onset of the pandemic in 2020, researchers have evaluated
attitudinal and behavioral responses to policy changes, political
messages, and COVID case/hospitalization/death rates.

\begin{itemize}
\tightlist
\item
  Survey data on attitudes and self-reported behavior
\item
  Health care provider administrative data
\item
  Mobile phone data to track locations
\item
  Social media data to track attitudes and mobility
\end{itemize}

\textbf{\emph{Example: Using Survey data from over 1.1 million
responses}} to measure concern about the coronavirus over time.

\begin{itemize}
\tightlist
\item
  Clinton, Joshua, et
  al.~``\href{https://www.science.org/doi/10.1126/sciadv.abd7204}{Partisan
  pandemic: How partisanship and public health concerns affect
  individuals' social mobility during COVID-19}.'' Science advances 7.2
  (2021): eabd7204.
\end{itemize}

\includegraphics{images/covidsurvey.png}

\textbf{\emph{Example: Using the geotracking data of 15million
smartphones}} per day to compute percentage reduction in general
movement and visiting non-essential services relative to before COVID-19
(before March 9).

\begin{itemize}
\tightlist
\item
  Gollwitzer, Anton, et
  al.~``\href{https://www.nature.com/articles/s41562-020-00977-7}{Partisan
  differences in physical distancing are linked to health outcomes
  during the COVID-19 pandemic}.'' Nature human behaviour 4.11 (2020):
  1186-1197.
\end{itemize}

\includegraphics{images/covidphone.png}

\textbf{\emph{Example: Using Twitter geolocation data}} to track how
much movement users have by looking at the distances from all locations
where a given user has tweeted.

\begin{itemize}
\tightlist
\item
  Paiheng Xu, Mark Dredze, David A Broniatowski.
  ``\href{https://socialmobility.covid19dataresources.org/}{The Twitter
  Social Mobility Index: Measuring Social Distancing Practices from
  Geolocated Tweets}.'' Journal of Medical Internet Research (JMIR),
  2020.
\end{itemize}

\includegraphics{images/covidtwitter.png}

We will use the Twitter social mobility index to study how the movement
of geo-located Twitter users changed from 2019 into April 2022.

\begin{itemize}
\tightlist
\item
  We will compare this movement for users located in the Northeast
  vs.~South
\end{itemize}

Each row of the dataset represents a week of the year. Each column
represents a particular geography for which social mobility was
calculated by the researchers.

\begin{itemize}
\tightlist
\item
  \texttt{Dates} indicates the date
\item
  \texttt{Northeast}: social mobility data for those in the northeast of
  the U.S.
\item
  \texttt{South}: social mobility data for those in the south of the
  U.S.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Load the data from the author Mark Dredze\textquotesingle{}s website}
\NormalTok{covid }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"https://raw.githubusercontent.com/mdredze/covid19\_social\_mobility.github.io/master/data/longitudinal\_compiled.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Just like we have encountered numeric, factor, and character variables,
R also has the ability to treat variables specifically as dates. We will
want R to treat the date variable we read in as a date, and not as raw
text or some other variable type. To do this, we will use the
\texttt{as.Date} function.

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Date variable original format and class}
\FunctionTok{head}\NormalTok{(covid}\SpecialCharTok{$}\NormalTok{Dates)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "2019-01-01" "2019-01-07" "2019-01-14" "2019-01-21" "2019-01-28"
[6] "2019-02-04"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(covid}\SpecialCharTok{$}\NormalTok{Dates)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "character"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Convert to class Date}
\NormalTok{covid}\SpecialCharTok{$}\NormalTok{Dates }\OtherTok{\textless{}{-}} \FunctionTok{as.Date}\NormalTok{(covid}\SpecialCharTok{$}\NormalTok{Date)}
\FunctionTok{head}\NormalTok{(covid}\SpecialCharTok{$}\NormalTok{Dates)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "2019-01-01" "2019-01-07" "2019-01-14" "2019-01-21" "2019-01-28"
[6] "2019-02-04"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(covid}\SpecialCharTok{$}\NormalTok{Dates)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "Date"
\end{verbatim}

The researchers continue to add to these data. Let's look at the portion
of data from 2019 to April 2022.

\begin{itemize}
\tightlist
\item
  Note the use of \texttt{as.Date} again to make sure R knows our text
  should be treated as a date
\item
  Note the use of the greater than or equal to \texttt{\textgreater{}=}
  and less than or equal signs \texttt{\textless{}=} to specify which
  rows we want to keep in the data. We want rows that are in dates after
  January 1, 2019 and (\texttt{\&}) on or before April 25, 2022.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{covidsub }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(covid, Dates }\SpecialCharTok{\textgreater{}=} \FunctionTok{as.Date}\NormalTok{(}\StringTok{"2019{-}01{-}01"}\NormalTok{) }\SpecialCharTok{\&}
\NormalTok{                     Dates }\SpecialCharTok{\textless{}=} \FunctionTok{as.Date}\NormalTok{(}\StringTok{"2022{-}04{-}25"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

These data are collected by week. That is very detailed. While that may
be useful, let us create another variable that contains just the month
and year, which will allow us to calculate the average per month. With a
date variable, we can use the \texttt{format} function to change the
format to just year and month.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{covidsub}\SpecialCharTok{$}\NormalTok{monthyear }\OtherTok{\textless{}{-}} \FunctionTok{format}\NormalTok{(covidsub}\SpecialCharTok{$}\NormalTok{Dates, }\StringTok{"\%Y{-}\%m"}\NormalTok{)}
\FunctionTok{range}\NormalTok{(covidsub}\SpecialCharTok{$}\NormalTok{monthyear)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "2019-01" "2022-04"
\end{verbatim}

Where we are going \ldots{}

\includegraphics{05-Causalityii_files/figure-pdf/unnamed-chunk-8-1.pdf}

Starting from the bottom \ldots{}

\begin{itemize}
\tightlist
\item
  Let's first create a scatterplot by providing R with our two variables
\item
  In a trend/line plot, we want each month on the x-axis
\item
  We want our outcome on the y-axis, in this case, average social
  mobility by month
\item
  Ultimately we will want to compare the Northeast with the South. We
  will plot one line at a time, starting with the Northeast
\end{itemize}

We first need to find the average by month. Recall our \texttt{tapply()}
function.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mobilitybymonthNE }\OtherTok{\textless{}{-}} \FunctionTok{tapply}\NormalTok{(covidsub}\SpecialCharTok{$}\NormalTok{Northeast, covidsub}\SpecialCharTok{$}\NormalTok{monthyear, mean,}
                          \AttributeTok{na.rm=}\NormalTok{T)}

\NormalTok{mobilitybymonthSO }\OtherTok{\textless{}{-}} \FunctionTok{tapply}\NormalTok{(covidsub}\SpecialCharTok{$}\NormalTok{South, covidsub}\SpecialCharTok{$}\NormalTok{monthyear, mean,}
                          \AttributeTok{na.rm=}\NormalTok{T)}
\end{Highlighting}
\end{Shaded}

Let's look at the output for the Northeast. Each value is what we
ultimately want on the y-axis-- the average social mobility in a given
month.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mobilitybymonthNE}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 2019-01  2019-02  2019-03  2019-04  2019-05  2019-06  2019-07  2019-08 
51.22066 52.26420 63.20130 61.38417 61.27622 60.49753 58.91779 61.20730 
 2019-09  2019-10  2019-11  2019-12  2020-01  2020-02  2020-03  2020-04 
54.44546 54.93814 56.59830 55.44538 51.12414 45.80660 34.55917 18.15076 
 2020-05  2020-06  2020-07  2020-08  2020-09  2020-10  2020-11  2020-12 
23.29190 28.71901 27.02149 32.73828 29.07536 32.07877 29.83641 30.56208 
 2021-01  2021-02  2021-03  2021-04  2021-05  2021-06  2021-07  2021-08 
28.75507 28.76227 35.35340 45.02537 48.19897 50.18401 52.96105 51.19241 
 2021-09  2021-10  2021-11  2021-12  2022-01  2022-02  2022-03  2022-04 
45.81695 49.15654 48.69051 51.24941 46.96813 53.55241 59.70933 54.04312 
\end{verbatim}

We want to plot them each at their own point on the x-axis, from the
first month to the last month. We can start by creating a vector of the
same length as we have months:

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(mobilitybymonthNE)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
[26] 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40
\end{verbatim}

These become our two inputs in the plot.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(}\AttributeTok{x=}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(mobilitybymonthNE),}
     \AttributeTok{y=}\NormalTok{mobilitybymonthNE, }\AttributeTok{pch=}\DecValTok{16}\NormalTok{) }\CommentTok{\# pch is point type}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{05-Causalityii_files/figure-pdf/unnamed-chunk-12-1.pdf}

}

\end{figure}

We now transform it to a line by specifying \texttt{type="l"}

\begin{itemize}
\tightlist
\item
  By default, R creates a plot with \texttt{type=p} for points. R also
  has \texttt{type=b} which has both a line and points.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(}\AttributeTok{x=}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(mobilitybymonthNE),}
     \AttributeTok{y=}\NormalTok{mobilitybymonthNE, }\AttributeTok{type=}\StringTok{"l"}\NormalTok{) }\CommentTok{\# makes it a line}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{05-Causalityii_files/figure-pdf/unnamed-chunk-13-1.pdf}

}

\end{figure}

Let us change the aesthetics a bit by adding labels and removing the
border with \texttt{bty="n"}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(}\AttributeTok{x=}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(mobilitybymonthNE),}
     \AttributeTok{y=}\NormalTok{mobilitybymonthNE,}
     \AttributeTok{type=}\StringTok{"l"}\NormalTok{, }
     \AttributeTok{main=}\StringTok{"Social Mobility by Month and Region"}\NormalTok{,}
     \AttributeTok{ylab=}\StringTok{"Twitter Social Mobility Index"}\NormalTok{,}
     \AttributeTok{xlab=}\StringTok{""}\NormalTok{,}
     \AttributeTok{ylim =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{80}\NormalTok{), }\CommentTok{\# y{-}axis limits}
     \AttributeTok{las=}\DecValTok{1}\NormalTok{, }\CommentTok{\# orientation of axis labels}
     \AttributeTok{lwd=}\DecValTok{2}\NormalTok{, }\CommentTok{\# line width}
     \AttributeTok{bty=}\StringTok{"n"}\NormalTok{) }\CommentTok{\# removes border}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{05-Causalityii_files/figure-pdf/unnamed-chunk-14-1.pdf}

}

\end{figure}

Let's add a comparison line with the \texttt{lines()} function to look
at trends for the south.

\begin{itemize}
\tightlist
\item
  Note that this is outside of the \texttt{plot()} function, but the
  inputs are very similar. We supply a set of x and y coordindates.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(}\AttributeTok{x=}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(mobilitybymonthNE),}
     \AttributeTok{y=}\NormalTok{mobilitybymonthNE,}
     \AttributeTok{type=}\StringTok{"l"}\NormalTok{, }
     \AttributeTok{main=}\StringTok{"Social Mobility by Month and Region"}\NormalTok{,}
     \AttributeTok{ylab=}\StringTok{"Twitter Social Mobility Index"}\NormalTok{,}
     \AttributeTok{xlab=}\StringTok{""}\NormalTok{,}
     \AttributeTok{ylim =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{80}\NormalTok{), }\CommentTok{\# y{-}axis limits}
     \AttributeTok{las=}\DecValTok{1}\NormalTok{, }\CommentTok{\# orientation of axis labels}
     \AttributeTok{lwd=}\DecValTok{2}\NormalTok{, }\CommentTok{\# line width}
     \AttributeTok{bty=}\StringTok{"n"}\NormalTok{) }\CommentTok{\# removes border}
\DocumentationTok{\#\# Add line to the plot }
\FunctionTok{lines}\NormalTok{(}\AttributeTok{x=}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(mobilitybymonthSO),}
     \AttributeTok{y=}\NormalTok{mobilitybymonthSO, }\AttributeTok{col=}\StringTok{"red3"}\NormalTok{, }\AttributeTok{lwd=}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{05-Causalityii_files/figure-pdf/unnamed-chunk-15-1.pdf}

}

\end{figure}

Let's create our own axis for the plot to add detail. To do this, we add
\texttt{xaxt} to the \texttt{plot} function and then use \texttt{axis()}
below the function.

The labels we will add are the actual months in the data. These happen
to be the labels or \texttt{names} of our vectors:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{names}\NormalTok{(mobilitybymonthNE)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] "2019-01" "2019-02" "2019-03" "2019-04" "2019-05" "2019-06" "2019-07"
 [8] "2019-08" "2019-09" "2019-10" "2019-11" "2019-12" "2020-01" "2020-02"
[15] "2020-03" "2020-04" "2020-05" "2020-06" "2020-07" "2020-08" "2020-09"
[22] "2020-10" "2020-11" "2020-12" "2021-01" "2021-02" "2021-03" "2021-04"
[29] "2021-05" "2021-06" "2021-07" "2021-08" "2021-09" "2021-10" "2021-11"
[36] "2021-12" "2022-01" "2022-02" "2022-03" "2022-04"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(}\AttributeTok{x=}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(mobilitybymonthNE),}
     \AttributeTok{y=}\NormalTok{mobilitybymonthNE,}
     \AttributeTok{type=}\StringTok{"l"}\NormalTok{, }
     \AttributeTok{main=}\StringTok{"Social Mobility by Month and Region"}\NormalTok{,}
     \AttributeTok{ylab=}\StringTok{"Twitter Social Mobility Index"}\NormalTok{,}
     \AttributeTok{xlab=}\StringTok{""}\NormalTok{,}
     \AttributeTok{ylim =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{80}\NormalTok{),}
     \AttributeTok{las=}\DecValTok{1}\NormalTok{, }
     \AttributeTok{lwd=}\DecValTok{2}\NormalTok{, }
     \AttributeTok{bty=}\StringTok{"n"}\NormalTok{,}
     \AttributeTok{xaxt=}\StringTok{"n"}\NormalTok{) }\CommentTok{\# removes original x{-}axis}
\DocumentationTok{\#\# Add line to the plot }
\FunctionTok{lines}\NormalTok{(}\AttributeTok{x=}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(mobilitybymonthSO),}
     \AttributeTok{y=}\NormalTok{mobilitybymonthSO, }\AttributeTok{col=}\StringTok{"red3"}\NormalTok{, }\AttributeTok{lwd=}\DecValTok{2}\NormalTok{)}
\DocumentationTok{\#\# add the axis the "1" means x{-}axis. A "2" would create a y{-}axis}
\FunctionTok{axis}\NormalTok{(}\DecValTok{1}\NormalTok{, }\AttributeTok{at =} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(mobilitybymonthNE), }
     \AttributeTok{labels=}\FunctionTok{names}\NormalTok{(mobilitybymonthNE), }\AttributeTok{las=}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{05-Causalityii_files/figure-pdf/unnamed-chunk-17-1.pdf}

}

\end{figure}

Finally, let's add a \texttt{legend()}. Now we're here!

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(}\AttributeTok{x=}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(mobilitybymonthNE),}
     \AttributeTok{y=}\NormalTok{mobilitybymonthNE,}
     \AttributeTok{type=}\StringTok{"l"}\NormalTok{, }
     \AttributeTok{main=}\StringTok{"Social Mobility by Month and Region"}\NormalTok{,}
     \AttributeTok{ylab=}\StringTok{"Twitter Social Mobility Index"}\NormalTok{,}
     \AttributeTok{xlab=}\StringTok{""}\NormalTok{,}
     \AttributeTok{ylim =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{80}\NormalTok{),}
     \AttributeTok{las=}\DecValTok{1}\NormalTok{, }
     \AttributeTok{lwd=}\DecValTok{2}\NormalTok{, }
     \AttributeTok{bty=}\StringTok{"n"}\NormalTok{,}
     \AttributeTok{xaxt=}\StringTok{"n"}\NormalTok{) }\CommentTok{\# removes original x{-}axis}
\DocumentationTok{\#\# Add line to the plot }
\FunctionTok{lines}\NormalTok{(}\AttributeTok{x=}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(mobilitybymonthSO),}
     \AttributeTok{y=}\NormalTok{mobilitybymonthSO, }\AttributeTok{col=}\StringTok{"red3"}\NormalTok{, }\AttributeTok{lwd=}\DecValTok{2}\NormalTok{)}
\DocumentationTok{\#\# add the axis the "1" means x{-}axis. A "2" would create a y{-}axis}
\FunctionTok{axis}\NormalTok{(}\DecValTok{1}\NormalTok{, }\AttributeTok{at =} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(mobilitybymonthNE), }
     \AttributeTok{labels=}\FunctionTok{names}\NormalTok{(mobilitybymonthNE), }\AttributeTok{las=}\DecValTok{2}\NormalTok{)}

\DocumentationTok{\#\# Add legend, "bottomleft" indicates where on the plot to locate it}
\DocumentationTok{\#\# Could use "topright" instead, for example}
\FunctionTok{legend}\NormalTok{(}\StringTok{"bottomleft"}\NormalTok{,  }\AttributeTok{col=}\FunctionTok{c}\NormalTok{(}\StringTok{"red3"}\NormalTok{, }\StringTok{"black"}\NormalTok{), }
       \FunctionTok{c}\NormalTok{(}\StringTok{"South"}\NormalTok{, }\StringTok{"Northeast"}\NormalTok{), }
       \AttributeTok{cex =}\NormalTok{ .}\DecValTok{7}\NormalTok{, }\CommentTok{\# size of legend}
       \AttributeTok{lwd=}\DecValTok{2}\NormalTok{,}
       \AttributeTok{bty=}\StringTok{"n"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{05-Causalityii_files/figure-pdf/unnamed-chunk-18-1.pdf}

}

\end{figure}

\hypertarget{causal-claims-from-before-vs.-after-comparisons}{%
\subsection{Causal claims from before vs.~after
comparisons}\label{causal-claims-from-before-vs.-after-comparisons}}

\textbf{\emph{What types of research questions could these trends
generate?}}

\includegraphics{05-Causalityii_files/figure-pdf/unnamed-chunk-19-1.pdf}

What would you want to know about how movement has changed over time.
Think about examples of causal claims you might make:

\begin{itemize}
\tightlist
\item
  Example: X caused mobility to decline
\item
  Example: Z caused mobility to decrease
\item
  Example: W caused mobility to increase at different rates across
  different regions.
\end{itemize}

So what can we do to test causal claims?

\begin{itemize}
\tightlist
\item
  What is the fundamental problem of causal inference in this case?
\item
  Can we do an experiment?
\item
  Researchers try to form comparison groups, in a strategic way, with
  the data they have (i.e., ``observational'' or ``non-experimental''
  data).
\item
  Because they cannot randomly assign two different experiences of the
  world, instead they choose two cases or two groups of cases that

  \begin{itemize}
  \tightlist
  \item
    Seem extremely similar except
  \item
    One has the treatment of interest, and one does not
  \end{itemize}
\end{itemize}

\textbf{Example: Before vs.~After Comparison}

Let's examine social mobility just before vs.~just after the federal
announcement of social distancing guidelines to stop the spread of
COVID-19.

\begin{itemize}
\tightlist
\item
  To do so, we will draw a vertical line at March 2020

  \begin{itemize}
  \tightlist
  \item
    Note we use \texttt{abline(v=)} to indicate a vertical line at a
    location to cross the x-axis
  \end{itemize}
\end{itemize}

This is the 15th entry in our vector, which means at point 15 on the
x-axis.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mobilitybymonthNE[}\StringTok{"2020{-}03"}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 2020-03 
34.55917 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mobilitybymonthNE[}\DecValTok{15}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 2020-03 
34.55917 
\end{verbatim}

\begin{itemize}
\tightlist
\item
  We will also add text to inform views what that line represents

  \begin{itemize}
  \tightlist
  \item
    Note we use \texttt{text(x=\ ,\ y=,\ labels)} to indicate where to
    put text
  \end{itemize}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(}\AttributeTok{x=}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(mobilitybymonthNE),}
     \AttributeTok{y=}\NormalTok{mobilitybymonthNE,}
     \AttributeTok{type=}\StringTok{"l"}\NormalTok{, }
     \AttributeTok{main=}\StringTok{"Social Mobility by Month and Region"}\NormalTok{,}
     \AttributeTok{ylab=}\StringTok{"Twitter Social Mobility Index"}\NormalTok{,}
     \AttributeTok{xlab=}\StringTok{""}\NormalTok{,}
     \AttributeTok{ylim =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{80}\NormalTok{),}
     \AttributeTok{las=}\DecValTok{1}\NormalTok{, }
     \AttributeTok{lwd=}\DecValTok{2}\NormalTok{, }
     \AttributeTok{bty=}\StringTok{"n"}\NormalTok{,}
     \AttributeTok{xaxt=}\StringTok{"n"}\NormalTok{) }\CommentTok{\# removes original x{-}axis}
\DocumentationTok{\#\# Add line to the plot }
\FunctionTok{lines}\NormalTok{(}\AttributeTok{x=}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(mobilitybymonthSO),}
     \AttributeTok{y=}\NormalTok{mobilitybymonthSO, }\AttributeTok{col=}\StringTok{"red3"}\NormalTok{, }\AttributeTok{lwd=}\DecValTok{2}\NormalTok{)}

\DocumentationTok{\#\# add the axis the "1" means x{-}axis. A "2" would create a y{-}axis}
\FunctionTok{axis}\NormalTok{(}\DecValTok{1}\NormalTok{, }\AttributeTok{at =} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(mobilitybymonthNE), }
     \AttributeTok{labels=}\FunctionTok{names}\NormalTok{(mobilitybymonthNE), }\AttributeTok{las=}\DecValTok{2}\NormalTok{)}
\DocumentationTok{\#\# add dashed blue vertical line}
\FunctionTok{abline}\NormalTok{(}\AttributeTok{v=}\DecValTok{15}\NormalTok{, }\AttributeTok{lty=}\DecValTok{2}\NormalTok{, }\AttributeTok{col=}\StringTok{"dodgerblue"}\NormalTok{, }\AttributeTok{lwd=}\FloatTok{1.5}\NormalTok{)}

\DocumentationTok{\#\# add text near the line}
\DocumentationTok{\#\# the \textbackslash{}n breaks the text into different lines}
\FunctionTok{text}\NormalTok{(}\AttributeTok{x=}\DecValTok{15}\NormalTok{, }\AttributeTok{y=}\DecValTok{65}\NormalTok{, }\AttributeTok{labels =} \StringTok{"Federal }\SpecialCharTok{\textbackslash{}n}\StringTok{ Announcement"}\NormalTok{, }\AttributeTok{cex=}\NormalTok{.}\DecValTok{6}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{05-Causalityii_files/figure-pdf/unnamed-chunk-21-1.pdf}

}

\end{figure}

We see mobility does appear to be lower after the announcement relative
to before the announcement. Is this causal?

\begin{itemize}
\tightlist
\item
  Assumption: We would want to be able to argue that social mobility in
  the weeks following the announcement (after time period) would look
  similar to social mobility in the weeks prior to the announcement
  (before period) \textbf{if not for the federal announcement}

  \begin{itemize}
  \tightlist
  \item
    That the before vs.~after time periods would be similar in any
    meaningful way if not for the presence of the treatment in the after
    period.
  \end{itemize}
\end{itemize}

Does this seem like a plausible argument? Could other things
(confounders) occurring around the time of the federal announcement also
have caused the steep decline in social mobility?

\begin{itemize}
\tightlist
\item
  If we think something else happened around the same time that might
  have caused mobility to go down anyway, then we may be doubtful that
  this is a \emph{causal} effect.
\end{itemize}

\hypertarget{three-common-identification-strategies}{%
\section{Three Common Identification
Strategies}\label{three-common-identification-strategies}}

Example: Does drinking Sprite make a person a better basketball player?
(Inspired by 1990s commercial where a kid believes drinking Sprite will
cause him to play basketball better.)

\url{https://www.youtube.com/watch?v=zbavu2Al-ME}

\begin{itemize}
\tightlist
\item
  \textbf{Cross-section comparison}: Compare Grant Hill (who drinks
  Sprite) to others (who don't)
\item
  \textbf{Before-and-after}: Compare Grant Hill after he started
  drinking Sprite to Grant Hill before
\item
  \textbf{Difference-in-differences}: Compare Grant Hill before and
  after drinking Sprite and subtract from this the difference for some
  other person (who never drank Sprite) during the same two periods
\end{itemize}

(Note: ``drinking Sprite'' is our treatment.)

\hypertarget{threats-to-cross-section-designs}{%
\subsection{Threats to Cross-Section
Designs}\label{threats-to-cross-section-designs}}

\textbf{\emph{Assumption}}: Must assume no confounders and any
alternative explanations related to differences between the treated and
control subjects that also relate to the outcome. The Threat: Your two
groups may differ in ways beyond the ``treatment'' in ways that are
relevant to the outcome you care about.

\begin{itemize}
\tightlist
\item
  Compare Grant Hill, a tall NBA player who currently drinks Sprite
  (treatment group) to
\item
  Yourself, assuming you and they do not drink Sprite (control group)
\item
  Compare your basketball skill levels (the outcome).
\item
  Suppose Grant Hill is better (a positive treatment effect).

  \begin{itemize}
  \tightlist
  \item
    Can we conclude Sprite \emph{causes} a person to be a better player?
  \end{itemize}
\end{itemize}

Nope, because other things that affect basketball talent differ between
you and Grant Hill, and these things, not Sprite, may explain the
difference in basketball talent.

Moreover, even if we compared just among NBA players (Grant Hill
vs.~non-Sprite drinking players of his era), it's possible that Sprite
targeted all-stars to recruit to drink Sprite. In this way, pre-existing
basketball talent (a \emph{confounder}) both explains why Grant Hill
drank Sprite (relates to the treatment) and explains his higher level of
basketball talent (relates to the outcome) in the time period after
drinking Sprite.

\begin{itemize}
\tightlist
\item
  For a cross-sectional comparison to be plausible, we need to choose a
  very similar comparison in order to isolate the treatment as the main
  variable that is causing a change in an outcome.
\end{itemize}

\hypertarget{threats-to-before-after-designs}{%
\subsection{Threats to Before-After
Designs}\label{threats-to-before-after-designs}}

\textbf{\emph{Assumption}}: Must assume no confounding time trend.
Threat: Something else may be changing over time, aside from the
treatment, that is affecting your outcome.

\begin{itemize}
\tightlist
\item
  Compare Grant Hill in the years after he started drinking Sprite
  (treated) to
\item
  Grant Hill the years before he started drinking Sprite (control)
\item
  Compare his basketball skill levels (outcome).
\item
  Suppose Grant Hill after Sprite is better (a positive treatment
  effect).
\item
  Can we conclude Sprite causes a person to be a better player?
\end{itemize}

Not if something else Grant Hill started doing during that time period
made him better (e.g., maybe during that time the NBA provided higher
quality coaches and trainers, and everyone (including Grant Hill) got
better).

\begin{itemize}
\tightlist
\item
  You want your treatment to be the only thing relevant to basketball
  talent changing over time.
\end{itemize}

\hypertarget{threats-to-diff-in-diff-designs}{%
\subsection{Threats to Diff-in-Diff
Designs}\label{threats-to-diff-in-diff-designs}}

\textbf{\emph{Assumption}}: Must assume parallel trends: That in the
absence of treatment, your treatment group would have changed in the
same way as your control

\begin{itemize}
\tightlist
\item
  Compare Grant Hill in the years before vs.~after he started drinking
  Sprite to Grant Hill's teammate, who never drank sprite, in the same
  two time periods (before Hill drinks Sprite vs.~after Hill drinks
  Sprite)
\item
  Compare the \textbf{change in each player's basketball skill levels}.
  Suppose Grant Hill's skills increased to a greater degree than his
  teammate's over the same time period.
\item
  Can we conclude Sprite causes a person to be a better player?
\end{itemize}

If we are confident that Grant Hill did not have a unique (non-Sprite)
advantage over that time period relative to other players, then our
assumption might be plausible-- that Grant Hill and other players would
have experienced a similar growth in their skills if not for Grant Hill
getting the extra benefit of Sprite.

Instead, if, for example, Grant Hill got a new trainer during this
period AND his teammate did not, then we might have expected Grant Hill
to see more improvement even if he didn't start drinking Sprite. A
violation of the parallel trends assumption!

\begin{itemize}
\tightlist
\item
  Causality is hard!
\end{itemize}

\hypertarget{application-economic-effects-of-basque-terrorism}{%
\section{Application: Economic Effects of Basque
Terrorism}\label{application-economic-effects-of-basque-terrorism}}

Research Question: What is the economic impact of terrorism?

\begin{itemize}
\tightlist
\item
  Factual (\(Y(1)\)): Economy given Basque region hit with terrorism in
  early 1970s

  \begin{itemize}
  \tightlist
  \item
    From 1973 to late 1990s, ETA killed almost 800 people
  \item
    Activity localized to Basque area
  \end{itemize}
\item
  Counterfactual (\(Y(0)\)): How would Basque economy have fared in the
  absence of the terrorism?

  \begin{itemize}
  \tightlist
  \item
    Basque was the 3rd richest region in Spain at onset
  \item
    Dropped to the 6th position by late 1990s
  \item
    Would this fall have happened in the absence of terrorism?
  \end{itemize}
\end{itemize}

Problem: We can't observe the counterfactual. We can't go back in time
to manipulate the experience of terrorism.

\hypertarget{applying-3-identification-strategies}{%
\subsection{Applying 3 Identification
Strategies}\label{applying-3-identification-strategies}}

\begin{itemize}
\tightlist
\item
  Compare Basque to others after 1973 (Cross-section comparison)
\item
  Compare Basque before and after 1973 (Before-and-after)
\item
  Compare others before and after 1973 and subtract the difference from
  Basque's difference (Difference-in-differences)
\end{itemize}

For a video explainer of the code for this application, see below. (Via
youtube, you can speed up the playback to 1.5 or 2x speed.)

\url{https://www.youtube.com/watch?v=E4PqZgcv5IQ}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{basque }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"basque.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(basque)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
     region year   gdpcap
1 Andalucia 1955 1.688732
2 Andalucia 1956 1.758498
3 Andalucia 1957 1.827621
4 Andalucia 1958 1.852756
5 Andalucia 1959 1.878035
6 Andalucia 1960 2.010140
\end{verbatim}

Variables

\begin{itemize}
\tightlist
\item
  \texttt{region}: 17 regions including Basque
\item
  \texttt{year}: 1955 -- 1997
\item
  \texttt{gdpcap}: real GDP per capita (in 1986 USD, thousands)
\end{itemize}

Subset Basque Data into Four Groups

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Basque before terrorism}
\NormalTok{basqueBefore }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(basque, (year }\SpecialCharTok{\textless{}} \DecValTok{1973}\NormalTok{) }\SpecialCharTok{\&}
\NormalTok{                            (region }\SpecialCharTok{==} \StringTok{"Basque Country"}\NormalTok{))}
\DocumentationTok{\#\# Basque after terrorism}
\NormalTok{basqueAfter }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(basque, (year }\SpecialCharTok{\textgreater{}=} \DecValTok{1973}\NormalTok{) }\SpecialCharTok{\&}
\NormalTok{                           (region }\SpecialCharTok{==} \StringTok{"Basque Country"}\NormalTok{))}
\DocumentationTok{\#\# others before terrorism}
\NormalTok{othersBefore }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(basque, (year }\SpecialCharTok{\textless{}} \DecValTok{1973}\NormalTok{) }\SpecialCharTok{\&}
\NormalTok{                            (region }\SpecialCharTok{!=} \StringTok{"Basque Country"}\NormalTok{))}
\DocumentationTok{\#\# others after terrorism}
\NormalTok{othersAfter }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(basque, (year }\SpecialCharTok{\textgreater{}=} \DecValTok{1973}\NormalTok{) }\SpecialCharTok{\&}
\NormalTok{                           (region }\SpecialCharTok{!=} \StringTok{"Basque Country"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

What is the economic impact of terrorism?

Cross-section comparison

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(basqueAfter}\SpecialCharTok{$}\NormalTok{gdpcap) }\SpecialCharTok{{-}} \FunctionTok{mean}\NormalTok{(othersAfter}\SpecialCharTok{$}\NormalTok{gdpcap)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1.132917
\end{verbatim}

Before-and-after design

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(basqueAfter}\SpecialCharTok{$}\NormalTok{gdpcap) }\SpecialCharTok{{-}} \FunctionTok{mean}\NormalTok{(basqueBefore}\SpecialCharTok{$}\NormalTok{gdpcap)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 2.678146
\end{verbatim}

Difference-in-Differences design

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{treatDiff }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(basqueAfter}\SpecialCharTok{$}\NormalTok{gdpcap) }\SpecialCharTok{{-}}
    \FunctionTok{mean}\NormalTok{(basqueBefore}\SpecialCharTok{$}\NormalTok{gdpcap)}
\NormalTok{controlDiff }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(othersAfter}\SpecialCharTok{$}\NormalTok{gdpcap) }\SpecialCharTok{{-}}
    \FunctionTok{mean}\NormalTok{(othersBefore}\SpecialCharTok{$}\NormalTok{gdpcap)}
\NormalTok{treatDiff }\SpecialCharTok{{-}}\NormalTok{ controlDiff}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] -0.48316
\end{verbatim}

Here is a way to visualize this difference-in-differences. Our estimated
causal effect is the difference between the observed post-1973 economy
in the Basque region \texttt{mean(basqueAfter\$gdpcap)} and what we
assume the economy \textbf{would have been} in the absence of terrorism
(the treatment) using the dotted line-- adding the control group's
trajectory to the pre-1973 Basque economy
\texttt{(mean(basqueBefore\$gdpcap)\ +\ controlDiff)}.

\includegraphics{05-Causalityii_files/figure-pdf/unnamed-chunk-29-1.pdf}

What should we conclude from each approach?

\begin{itemize}
\tightlist
\item
  Each approach resulted in a different estimate of the impact of
  terrorism on the economy. We should choose the approach for which we
  think the underlying assumptions are most plausible.
\end{itemize}

\hypertarget{placebo-tests}{%
\section{Placebo Tests}\label{placebo-tests}}

Which Results Should We Believe? Role of Placebo Tests

Cross-section comparison

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# were there pre{-}existing differences between the groups?}
\FunctionTok{mean}\NormalTok{(basqueBefore}\SpecialCharTok{$}\NormalTok{gdpcap) }\SpecialCharTok{{-}} \FunctionTok{mean}\NormalTok{(othersBefore}\SpecialCharTok{$}\NormalTok{gdpcap)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1.616077
\end{verbatim}

Before-and-After design

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# was there a change in a group we don\textquotesingle{}t think should have changed?}
\FunctionTok{mean}\NormalTok{(othersAfter}\SpecialCharTok{$}\NormalTok{gdpcap) }\SpecialCharTok{{-}} \FunctionTok{mean}\NormalTok{(othersBefore}\SpecialCharTok{$}\NormalTok{gdpcap)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 3.161306
\end{verbatim}

What about the Difference-in-Differences design?

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# here we go back in time even further to examine "pre{-}treatment" trends}
\DocumentationTok{\#\# we want them to be similar}
\NormalTok{(basqueBefore}\SpecialCharTok{$}\NormalTok{gdpcap[basqueBefore}\SpecialCharTok{$}\NormalTok{year }\SpecialCharTok{==} \DecValTok{1972}\NormalTok{] }\SpecialCharTok{{-}}
\NormalTok{ basqueBefore}\SpecialCharTok{$}\NormalTok{gdpcap[basqueBefore}\SpecialCharTok{$}\NormalTok{year }\SpecialCharTok{==} \DecValTok{1955}\NormalTok{]) }\SpecialCharTok{{-}}
\NormalTok{    (}\FunctionTok{mean}\NormalTok{(othersBefore}\SpecialCharTok{$}\NormalTok{gdpcap[othersBefore}\SpecialCharTok{$}\NormalTok{year }\SpecialCharTok{==} \DecValTok{1972}\NormalTok{]) }\SpecialCharTok{{-}}
     \FunctionTok{mean}\NormalTok{(othersBefore}\SpecialCharTok{$}\NormalTok{gdpcap[othersBefore}\SpecialCharTok{$}\NormalTok{year }\SpecialCharTok{==} \DecValTok{1955}\NormalTok{]))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0.07147071
\end{verbatim}

These ``placebo'' checks are closest to zero for diff-in-diff, so we may
believe that the most.

\emph{Thanks to Will Lowe and QSS for providing the foundations for this
example}

\hypertarget{wrapping-up-causality}{%
\section{Wrapping Up Causality}\label{wrapping-up-causality}}

Do you get this joke?

\includegraphics{images/causality-cartoon.png}

\bookmarksetup{startatroot}

\hypertarget{loops}{%
\chapter{Loops in R}\label{loops}}

In this brief section, we will go over conducting loops in R.

Loops are a tool in R that are useful for situations where we want to do
something over and over and over and \ldots{} over again, where we just
change something small each time.

A quick example using the Basque data from the previous section:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{basque }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"basque.csv"}\NormalTok{, }\AttributeTok{stringsAsFactors =}\NormalTok{ T)}
\end{Highlighting}
\end{Shaded}

Let's say I wanted to know the GDP for each region for the earliest year
they are in the data.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{regionsubset }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(basque, region }\SpecialCharTok{==} \StringTok{"Andalucia"}\NormalTok{)}
\NormalTok{regionsubset}\SpecialCharTok{$}\NormalTok{gdpcap[regionsubset}\SpecialCharTok{$}\NormalTok{year }\SpecialCharTok{==} \FunctionTok{min}\NormalTok{(regionsubset}\SpecialCharTok{$}\NormalTok{year)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1.688732
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Repeat for a new region}
\NormalTok{regionsubset }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(basque, region }\SpecialCharTok{==} \StringTok{"Aragon"}\NormalTok{)}
\NormalTok{regionsubset}\SpecialCharTok{$}\NormalTok{gdpcap[regionsubset}\SpecialCharTok{$}\NormalTok{year }\SpecialCharTok{==} \FunctionTok{min}\NormalTok{(regionsubset}\SpecialCharTok{$}\NormalTok{year)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 2.288775
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Repeat for a new region}
\NormalTok{regionsubset }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(basque, region }\SpecialCharTok{==} \StringTok{"Baleares"}\NormalTok{)}
\NormalTok{regionsubset}\SpecialCharTok{$}\NormalTok{gdpcap[regionsubset}\SpecialCharTok{$}\NormalTok{year }\SpecialCharTok{==} \FunctionTok{min}\NormalTok{(regionsubset}\SpecialCharTok{$}\NormalTok{year)]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 3.143959
\end{verbatim}

Ughhh can we automate this? we have 17 regions!!!

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{unique}\NormalTok{(basque}\SpecialCharTok{$}\NormalTok{region)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] Andalucia              Aragon                 Principado De Asturias
 [4] Baleares               Canarias               Cantabria             
 [7] Castilla Y Leon        Castilla-La Mancha     Cataluna              
[10] Comunidad Valenciana   Extremadura            Galicia               
[13] Madrid                 Murcia                 Navarra               
[16] Basque Country         Rioja                 
17 Levels: Andalucia Aragon Baleares Basque Country Canarias ... Rioja
\end{verbatim}

Where we will be going by the end of this section:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{gdpminyear }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\ConstantTok{NA}\NormalTok{, }\DecValTok{17}\NormalTok{) }\CommentTok{\# empty "container" vector}
\NormalTok{regions }\OtherTok{\textless{}{-}} \FunctionTok{unique}\NormalTok{(basque}\SpecialCharTok{$}\NormalTok{region) }\CommentTok{\# what we iterate through}
\FunctionTok{names}\NormalTok{(gdpminyear) }\OtherTok{\textless{}{-}} \FunctionTok{unique}\NormalTok{(basque}\SpecialCharTok{$}\NormalTok{region) }\CommentTok{\# labels for our output}

\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\DecValTok{17}\NormalTok{)\{}
\NormalTok{  regionsubset }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(basque, region }\SpecialCharTok{==}\NormalTok{ regions[i])}
\NormalTok{  gdpminyear[i] }\OtherTok{\textless{}{-}}\NormalTok{ regionsubset}\SpecialCharTok{$}\NormalTok{gdpcap[regionsubset}\SpecialCharTok{$}\NormalTok{year }\SpecialCharTok{==} 
                                         \FunctionTok{min}\NormalTok{(regionsubset}\SpecialCharTok{$}\NormalTok{year)]}
\NormalTok{\}}
\FunctionTok{head}\NormalTok{(gdpminyear) }\CommentTok{\# output}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
             Andalucia                 Aragon Principado De Asturias 
              1.688732               2.288775               2.502928 
              Baleares               Canarias              Cantabria 
              3.143959               1.914382               2.559412 
\end{verbatim}

We got all of the answers with just one chunk of code!

\hypertarget{the-anatomy-of-a-loop}{%
\section{The anatomy of a loop}\label{the-anatomy-of-a-loop}}

\emph{A short video introduction to the anatomy of a loop}
\url{https://www.youtube.com/watch?v=RDsnhVpM1To}

In many situations, we want to repeat the same calculations with
different inputs. Loops allow you to avoid writing many similar code
chunks.

\begin{itemize}
\tightlist
\item
  The function \texttt{for(i\ in\ X)\{\}\}} will create a loop in your
  programming code where \texttt{i} is a counter and
\item
  \texttt{X} is a placeholder for a vector for the possible values of
  the counter.
\end{itemize}

We use the following syntax:

\texttt{for\ (i\ in\ X)\ \{}

\texttt{command1...}

\texttt{command2...}

\texttt{...}

\texttt{\}}

to indicate we want to repeat command1 and command2 and \ldots. as many
commands as we want, for each \texttt{i} in the set of possible values
for \texttt{i} stored in \texttt{X}.

\hypertarget{the-key-parts-of-a-loop}{%
\subsection{The key parts of a loop}\label{the-key-parts-of-a-loop}}

The meat: the command or set of commands you want to do over and over.

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# the meat}
\NormalTok{result }\OtherTok{\textless{}{-}} \DecValTok{6} \SpecialCharTok{+} \DecValTok{2}
\NormalTok{result }\OtherTok{\textless{}{-}} \DecValTok{8} \SpecialCharTok{+} \DecValTok{2}
\NormalTok{result }\OtherTok{\textless{}{-}} \DecValTok{4} \SpecialCharTok{+} \DecValTok{2}
\NormalTok{result }\OtherTok{\textless{}{-}} \DecValTok{7} \SpecialCharTok{+} \DecValTok{2}
\NormalTok{result }\OtherTok{\textless{}{-}} \DecValTok{11} \SpecialCharTok{+} \DecValTok{2}
\end{Highlighting}
\end{Shaded}

Note the pattern: we take some number and + 2 each time.

\begin{itemize}
\tightlist
\item
  It is the number that is changing -\textgreater{} what we will
  iterate.
\end{itemize}

For a loop, you want to:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  The Meat: Write down the code for one version.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{result }\OtherTok{\textless{}{-}} \DecValTok{6} \SpecialCharTok{+} \DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  The Bread: Embed this code in the loop syntax
  (\texttt{for(i\ in\ X)\{\}})
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in}\NormalTok{ X)\{}
\NormalTok{    result }\OtherTok{\textless{}{-}} \DecValTok{6} \SpecialCharTok{+} \DecValTok{2}
\NormalTok{    \}}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  Create a vector that contains the values you want to loop through
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{somenumbers }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{6}\NormalTok{, }\DecValTok{8}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{7}\NormalTok{, }\DecValTok{11}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  Create a storage vector that will contain the results
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{result }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\ConstantTok{NA}\NormalTok{, }\FunctionTok{length}\NormalTok{(somenumbers))}
\end{Highlighting}
\end{Shaded}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{4}
\tightlist
\item
  Modify the meat and bread to iterate by using \texttt{{[}i{]}}, and
  replace \texttt{X}.
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(somenumbers))\{}
\NormalTok{  result[i] }\OtherTok{\textless{}{-}}\NormalTok{ somenumbers[i] }\SpecialCharTok{+} \DecValTok{2}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  where `1:length(somenumbers)` reflects possible values `i` will take 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(somenumbers)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1 2 3 4 5
\end{verbatim}

\hypertarget{a-short-example}{%
\subsection{A short example}\label{a-short-example}}

Let's put these parts together:

Suppose we want to add 2 to a set of numbers
\texttt{c(6,\ 8,\ 4,\ 7,\ 11)}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{somenumbers }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{6}\NormalTok{, }\DecValTok{8}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{7}\NormalTok{, }\DecValTok{11}\NormalTok{) }\CommentTok{\# iteration vector}
\NormalTok{result }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\ConstantTok{NA}\NormalTok{, }\FunctionTok{length}\NormalTok{(somenumbers)) }\CommentTok{\# container vector}

\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(somenumbers))\{}
\NormalTok{  result[i] }\OtherTok{\textless{}{-}}\NormalTok{ somenumbers[i] }\SpecialCharTok{+} \DecValTok{2}
\NormalTok{\}}
\NormalTok{result}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]  8 10  6  9 13
\end{verbatim}

How does this work? Every iteration, the value of i changes.

\begin{itemize}
\tightlist
\item
  For example, when \texttt{i} is 1, we take the first value in our
  \texttt{somenumbers} vector \texttt{somenumbers{[}1{]}}, add 2 to it,
  and store it in the first position of our container vector
  \texttt{result{[}1{]}}. When \texttt{i} is 2, we switch the number in
  the brackets to 2, corresponding to the second entry in each vector,
  and so on.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Suppose i is 1}
\NormalTok{result[}\DecValTok{1}\NormalTok{] }\OtherTok{\textless{}{-}}\NormalTok{ somenumbers[}\DecValTok{1}\NormalTok{] }\SpecialCharTok{+} \DecValTok{2}
\NormalTok{result[}\DecValTok{1}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 8
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Suppose i is 2}
\NormalTok{result[}\DecValTok{2}\NormalTok{] }\OtherTok{\textless{}{-}}\NormalTok{ somenumbers[}\DecValTok{2}\NormalTok{] }\SpecialCharTok{+} \DecValTok{2}
\NormalTok{result[}\DecValTok{2}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Suppose i is 3}
\NormalTok{result[}\DecValTok{3}\NormalTok{] }\OtherTok{\textless{}{-}}\NormalTok{ somenumbers[}\DecValTok{3}\NormalTok{] }\SpecialCharTok{+} \DecValTok{2}
\NormalTok{result[}\DecValTok{3}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 6
\end{verbatim}

\hypertarget{troubleshooting-a-loop}{%
\subsection{Troubleshooting a loop}\label{troubleshooting-a-loop}}

The inside part of the loop should run if we set \texttt{i} to a
particular value.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{i }\OtherTok{\textless{}{-}} \DecValTok{1}
\NormalTok{result[i] }\OtherTok{\textless{}{-}}\NormalTok{ somenumbers[i] }\SpecialCharTok{+} \DecValTok{2}
\end{Highlighting}
\end{Shaded}

If you get an error here, there is something wrong with the meat! (and
not necessarily the loop)

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{result[i]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 8
\end{verbatim}

For example, if we had a typo, we'd get an error. Try running the below!

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{i }\OtherTok{\textless{}{-}} \DecValTok{1}
\NormalTok{result[i] }\OtherTok{\textless{}{-}}\NormalTok{ somenumberz[i] }\SpecialCharTok{+} \DecValTok{2}
\end{Highlighting}
\end{Shaded}

\hypertarget{your-turn}{%
\subsection{Your turn}\label{your-turn}}

Using a loop, for each value in our poll results, add 10 and divide by
100. Store in a vector called \texttt{adjustedpollresults}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pollresults }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{70}\NormalTok{, }\DecValTok{40}\NormalTok{, }\DecValTok{45}\NormalTok{, }\DecValTok{60}\NormalTok{, }\DecValTok{43}\NormalTok{, }\DecValTok{80}\NormalTok{, }\DecValTok{23}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Remember the steps:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  The Meat: Write down the code for one version.
\item
  The Bread: Embed this code in the loop syntax
  (\texttt{for(i\ in\ X)\{\}})
\item
  Create a vector that contains the values you want to loop through
  (here it's \texttt{pollresults})
\item
  Create a storage vector that will contain the results (here it's
  \texttt{adjustedpollresults})
\item
  Modify the meat and bread to iterate by using \texttt{{[}i{]}} and
  replace \texttt{X}.
\end{enumerate}

Try on your own, then expand for the solution.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{pollresults }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{70}\NormalTok{, }\DecValTok{40}\NormalTok{, }\DecValTok{45}\NormalTok{, }\DecValTok{60}\NormalTok{, }\DecValTok{43}\NormalTok{, }\DecValTok{80}\NormalTok{, }\DecValTok{23}\NormalTok{)}
\NormalTok{adjustedpollresults }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\ConstantTok{NA}\NormalTok{, }\FunctionTok{length}\NormalTok{(pollresults))}

\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(pollresults))\{}
\NormalTok{  adjustedpollresults[i] }\OtherTok{\textless{}{-}}\NormalTok{ (pollresults[i] }\SpecialCharTok{+} \DecValTok{10}\NormalTok{)}\SpecialCharTok{/}\DecValTok{100} 
\NormalTok{\}}
\NormalTok{adjustedpollresults}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0.80 0.50 0.55 0.70 0.53 0.90 0.33
\end{verbatim}

\hypertarget{application-u.s.-supreme-court}{%
\section{Application: U.S. Supreme
Court}\label{application-u.s.-supreme-court}}

\emph{A video explainer of the loop in this section using a similar
dataset that goes through 2020. We now have data going through 2022!}
\url{https://www.youtube.com/watch?v=Ij9YWgUQg_s}

The Court has changed a lot recently in its composition (and will
continue to do so).

\includegraphics[width=0.4\textwidth,height=\textheight]{images/sccourt6.jpeg}
\includegraphics[width=0.35\textwidth,height=\textheight]{images/sccourt.jpg}

\includegraphics[width=0.4\textwidth,height=\textheight]{images/sccourt5.jpeg}

\includegraphics[width=0.4\textwidth,height=\textheight]{images/sc24.jpeg}

Ideology on the U.S. Supreme Court over the past decade:

\begin{itemize}
\tightlist
\item
  With Justice Anthony Kennedy out, Kavanaugh in, did the Court have a
  Conservative shift?
\item
  What about with the death of Ruth Bader Ginsburg and confirmation of
  Amy Coney Barrett?
\item
  What about with the introduction of Justice Kentanji Brown Jackson?
\end{itemize}

Many people predicted it would. See this
\href{https://fivethirtyeight.com/features/how-kavanaugh-will-change-the-supreme-court/}{FiveThirtyEight
article} as an example. The graph from the article shows Kavanaugh's
predicted ideology.

\includegraphics[width=0.5\textwidth,height=\textheight]{images/kav.png}

\includegraphics{images/kavcourt.png}

We will explore how the Court has changed ideologically, with a focus on
how the location of the median U.S. Supreme Court Justice shifted over
time.

Why does the median matter? A refresher on the Court

\begin{itemize}
\tightlist
\item
  President nominates the justice. Senate must confirm.
\item
  Justices serve lifetime appointments.
\item
  Trump nominated Gorsuch, following Scalia death, confirmed 2017.
\item
  Trump nominated Kavanaugh, following Kennedy retirement, confirmed
  2018.
\item
  The Court typically has 9 justices, so whichever justice is the median
  in terms of ideology, can act as the ``swing'' vote in cases where the
  Court is divided

  \begin{itemize}
  \tightlist
  \item
    Anthony Kennedy was often the ``swing'' justice for a decade.
  \end{itemize}
\item
  With Kennedy out, the prediction was that the Court would return to
  similar balance as when O'Connor was the median.
\item
  In 2020, Ruth Bader Ginsburg died and Amy Coney Barrett was confirmed
  to Court late that year, likely shifting the Court again.
\item
  We can continue to update the data to examine what happened. We don't
  yet have a lot of data on changes to the Court that have come about
  since Justice Ketanji Brown Jackson was confirmed following the
  retirement of Justice Breyer, but we can examine changes to the court
  median through 2022.
\end{itemize}

Let's load and explore our data.

\begin{itemize}
\tightlist
\item
  \texttt{term}: is the year of the SC (1991-2022 except for 2005),
\item
  \texttt{justiceName}: contains the name of the Justice, and\\
\item
  \texttt{post\_mn}: includes the ``ideal point''-- this is the
  estimated ideology
\end{itemize}

Martin-Quinn Scores assess ideology based on how judges ``cluster''
together in their voting patterns. Every Justice gets an ideology score,
and this score can change each SC term (year) they are on the Court.
Higher scores are more conservative justices, and lower, more liberal.
More information is available at the
\href{http://mqscores.lsa.umich.edu/measures.php}{MQScores website}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{justices }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"justices24.csv"}\NormalTok{, }\AttributeTok{stringsAsFactors =}\NormalTok{ T)}

\DocumentationTok{\#\# alternative}
\NormalTok{justices }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"https://raw.githubusercontent.com/ktmccabe/teachingdata/main/justices24.csv"}\NormalTok{, }\AttributeTok{stringsAsFactors =}\NormalTok{ T)}
\end{Highlighting}
\end{Shaded}

We are going to make the name variable a character class. This will make
R treat the names as raw text rather than valued categories. This will
be useful later on in the application.

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# justice Name as character}
\NormalTok{justices}\SpecialCharTok{$}\NormalTok{justiceName }\OtherTok{\textless{}{-}} \FunctionTok{as.character}\NormalTok{(justices}\SpecialCharTok{$}\NormalTok{justiceName)}
\end{Highlighting}
\end{Shaded}

We can use \texttt{tapply()} to see the median ``ideal point'' (ideology
score) each term in our data.

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Note: we use tapply like before but replace mean with median}
\NormalTok{medians }\OtherTok{\textless{}{-}} \FunctionTok{tapply}\NormalTok{(justices}\SpecialCharTok{$}\NormalTok{post\_mn, justices}\SpecialCharTok{$}\NormalTok{term, median)}

\FunctionTok{plot}\NormalTok{(}\AttributeTok{x =}\FunctionTok{names}\NormalTok{(medians),}
     \AttributeTok{y=}\NormalTok{ medians, }
    \AttributeTok{ylim =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{.}\DecValTok{4}\NormalTok{, }\DecValTok{1}\NormalTok{),}
     \AttributeTok{type =} \StringTok{"b"}\NormalTok{,}
    \AttributeTok{cex=}\FloatTok{1.5}\NormalTok{,}
     \AttributeTok{ylab=}\StringTok{"Conservatism"}\NormalTok{,}
     \AttributeTok{xlab=}\StringTok{"Term"}\NormalTok{,}
     \AttributeTok{main=}\StringTok{"Median of US Supreme Court over Time"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{06-Loops_files/figure-pdf/unnamed-chunk-23-1.pdf}

}

\end{figure}

We see a conservative shift at the end of the plot. However, we cannot
tell from this specific data result whether this represents a shift
within a particular justice's ideology or a shift in which justice has
become the median, due perhaps, to the change in the Court's
composition.

\textbf{\emph{We need to find which justice is the median!}}

Loops to the rescue!

We will start our process by defining the meat of the operation.

\begin{itemize}
\tightlist
\item
  We want to find the median SC Justice for each term. To get started,
  let's pretend we only have to find the median Supreme Court Justice
  for one term.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{SCterms }\OtherTok{\textless{}{-}} \FunctionTok{sort}\NormalTok{(}\FunctionTok{unique}\NormalTok{(justices}\SpecialCharTok{$}\NormalTok{term))}
\NormalTok{SCterms}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 [1] 1991 1992 1993 1994 1995 1996 1997 1998 1999 2000 2001 2002 2003 2004 2006
[16] 2007 2008 2009 2010 2011 2012 2013 2014 2015 2016 2017 2018 2019 2020 2021
[31] 2022
\end{verbatim}

Note that where you have a vector where some entries in the vector are
repeated (such as terms on the Supreme Court), you can extract the
unique elements of that vector using the \texttt{unique()} function. You
can also \texttt{sort()} them in numeric or alphabetical order. This
won't be necessary most times.

First, let's think about how we would do this for just one of the
Supreme Court terms. Well we would first subset our data frame to
contain only that one Supreme Court term.

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Example for the first term}
\NormalTok{SCterms[}\DecValTok{1}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 1991
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Subset data to include only rows from 1991}
\NormalTok{subterm }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(justices, term }\SpecialCharTok{==} \DecValTok{1991}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Then, we would take the median of these ideal points

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{median.ip }\OtherTok{\textless{}{-}} \FunctionTok{median}\NormalTok{(subterm}\SpecialCharTok{$}\NormalTok{post\_mn)}
\end{Highlighting}
\end{Shaded}

Finally, we would figure out which justice has this median.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{result }\OtherTok{\textless{}{-}}\NormalTok{ subterm}\SpecialCharTok{$}\NormalTok{justiceName[subterm}\SpecialCharTok{$}\NormalTok{post\_mn }\SpecialCharTok{==}\NormalTok{ median.ip]}
\NormalTok{result}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] "SDOConnor"
\end{verbatim}

Now let's put it into our loop syntax

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# for(i  in . . . )\{}
\CommentTok{\#  subterm \textless{}{-} subset(justices, term == 1991)}
\CommentTok{\#  median.ip \textless{}{-} median(subterm$post\_mn)}
\CommentTok{\#  result \textless{}{-} subterm$justiceName[subterm$post\_mn == median.ip]}
\CommentTok{\#\}}
\end{Highlighting}
\end{Shaded}

Now, we need our container vector and iteration vectors.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{SCterms }\OtherTok{\textless{}{-}} \FunctionTok{sort}\NormalTok{(}\FunctionTok{unique}\NormalTok{(justices}\SpecialCharTok{$}\NormalTok{term))}
\NormalTok{results }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\ConstantTok{NA}\NormalTok{, }\FunctionTok{length}\NormalTok{(SCterms))}
\FunctionTok{names}\NormalTok{(results) }\OtherTok{\textless{}{-}}\NormalTok{ SCterms}
\end{Highlighting}
\end{Shaded}

Finally, we would modify our loop syntax with \texttt{i} and
\texttt{{[}i{]}}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{for}\NormalTok{(i  }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(SCterms))\{}
\NormalTok{  subterm }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(justices, term }\SpecialCharTok{==}\NormalTok{ SCterms[i])}
\NormalTok{  median.ip }\OtherTok{\textless{}{-}} \FunctionTok{median}\NormalTok{(subterm}\SpecialCharTok{$}\NormalTok{post\_mn)}
\NormalTok{  results[i] }\OtherTok{\textless{}{-}}\NormalTok{ subterm}\SpecialCharTok{$}\NormalTok{justiceName[subterm}\SpecialCharTok{$}\NormalTok{post\_mn }\SpecialCharTok{==}\NormalTok{ median.ip]}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Did it work?

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{results}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
         1991          1992          1993          1994          1995 
  "SDOConnor"   "SDOConnor"   "AMKennedy"   "SDOConnor"   "AMKennedy" 
         1996          1997          1998          1999          2000 
  "AMKennedy"   "AMKennedy"   "AMKennedy"   "SDOConnor"   "SDOConnor" 
         2001          2002          2003          2004          2006 
  "SDOConnor"   "SDOConnor"   "SDOConnor"   "SDOConnor"   "AMKennedy" 
         2007          2008          2009          2010          2011 
  "AMKennedy"   "AMKennedy"   "AMKennedy"   "AMKennedy"   "AMKennedy" 
         2012          2013          2014          2015          2016 
  "AMKennedy"   "AMKennedy"   "AMKennedy"   "AMKennedy"   "AMKennedy" 
         2017          2018          2019          2020          2021 
  "AMKennedy"   "JGRoberts"   "JGRoberts" "BMKavanaugh" "BMKavanaugh" 
         2022 
"BMKavanaugh" 
\end{verbatim}

Our evidence aligns with others:

\includegraphics{images/sccourt2.png}

\hypertarget{troubleshooting-the-loop}{%
\subsection{Troubleshooting the loop}\label{troubleshooting-the-loop}}

Recall, the inside part of the loop should run if we set \texttt{i} to a
particular value.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{  i }\OtherTok{\textless{}{-}} \DecValTok{1}
\NormalTok{  subterm }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(justices, term }\SpecialCharTok{==}\NormalTok{ SCterms[i])}
\NormalTok{  median.ip }\OtherTok{\textless{}{-}} \FunctionTok{median}\NormalTok{(subterm}\SpecialCharTok{$}\NormalTok{post\_mn)}
\NormalTok{  results[i] }\OtherTok{\textless{}{-}}\NormalTok{ subterm}\SpecialCharTok{$}\NormalTok{justiceName[subterm}\SpecialCharTok{$}\NormalTok{post\_mn }\SpecialCharTok{==}\NormalTok{ median.ip]}
  
\NormalTok{  results[i]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       1991 
"SDOConnor" 
\end{verbatim}

We are in good shape! If we had a typo, we'd get an error message there,
and that would be a sign that we need to work on the inside part of the
code before putting it back into the loop structure.

\hypertarget{visualizing-the-results}{%
\subsection{Visualizing the Results}\label{visualizing-the-results}}

To get a bit more practice with plots, let's visualize the results and
make our interpretations.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{medians }\OtherTok{\textless{}{-}} \FunctionTok{tapply}\NormalTok{(justices}\SpecialCharTok{$}\NormalTok{post\_mn, justices}\SpecialCharTok{$}\NormalTok{term, median)}
\FunctionTok{plot}\NormalTok{(}\AttributeTok{x =}\FunctionTok{names}\NormalTok{(medians),}
     \AttributeTok{y=}\NormalTok{ medians, }
     \AttributeTok{ylim =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{.}\DecValTok{4}\NormalTok{, }\DecValTok{1}\NormalTok{),}
     \AttributeTok{type =} \StringTok{"b"}\NormalTok{,}
     \AttributeTok{cex=}\FloatTok{1.5}\NormalTok{,}
     \AttributeTok{ylab=}\StringTok{"Conservatism"}\NormalTok{,}
     \AttributeTok{xlab=}\StringTok{"Term"}\NormalTok{,}
     \AttributeTok{main=}\StringTok{"Median of US Supreme Court over Time"}\NormalTok{)}

\DocumentationTok{\#\# Add the names to the plot}
\DocumentationTok{\#\# Note: we want to make sure medians and results are in the same order for this to work}
\FunctionTok{text}\NormalTok{(}\AttributeTok{x=}\FunctionTok{names}\NormalTok{(results), }\AttributeTok{y=}\NormalTok{(medians }\SpecialCharTok{{-}}\NormalTok{ .}\DecValTok{14}\NormalTok{), }\AttributeTok{labels=}\NormalTok{results, }\AttributeTok{cex=}\NormalTok{.}\DecValTok{35}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{06-Loops_files/figure-pdf/unnamed-chunk-33-1.pdf}

}

\end{figure}

We have now used the \texttt{text()} function. Similar to plot, the
\texttt{text()} takes a set of x and y coordinates that tells R the
location of where you want to add a piece(s) of text to the plot. The
third input is the actual text.

Why did the Court shift more conservative at the end of the time trend?

\begin{itemize}
\tightlist
\item
  Well we see that Justice Roberts and then Justice Kavanaugh became the
  median!
\end{itemize}

\begin{figure}

{\centering \includegraphics{images/sccourt3.png}

}

\caption{\href{https://fivethirtyeight.com/features/the-supreme-courts-conservative-supermajority-is-just-beginning-to-flex-its-muscles}{FiveThirtyEight}}

\end{figure}

As
\href{https://fivethirtyeight.com/features/roberts-is-the-new-swing-justice-that-doesnt-mean-hes-becoming-more-liberal/}{FiveThirtyEight}
notes, just because Justice Roberts is the new median, does not mean he
has become more liberal. The Court composition is shifting, and the MQ
scores also depend on the issues being heard before the Court.

\includegraphics{images/sccourt.png}

Recall, the Martin-Quinn scores measure justice ideology based on voting
patterns. What are the strengths and weaknesses of using this type of
information to score the ideology of a justice?

\hypertarget{enhancing-the-plot}{%
\subsection{Enhancing the plot}\label{enhancing-the-plot}}

Let's make the plot more beautiful by color coding.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{medians }\OtherTok{\textless{}{-}} \FunctionTok{tapply}\NormalTok{(justices}\SpecialCharTok{$}\NormalTok{post\_mn, justices}\SpecialCharTok{$}\NormalTok{term, median)}
\FunctionTok{plot}\NormalTok{(}\AttributeTok{x =}\FunctionTok{names}\NormalTok{(medians),}
     \AttributeTok{y=}\NormalTok{ medians, }
     \AttributeTok{ylim =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{.}\DecValTok{4}\NormalTok{, }\DecValTok{1}\NormalTok{),}
     \AttributeTok{type =} \StringTok{"b"}\NormalTok{,}
     \AttributeTok{ylab=}\StringTok{"Conservatism"}\NormalTok{,}
     \AttributeTok{xlab=}\StringTok{"Term"}\NormalTok{,}
     \AttributeTok{main=}\StringTok{"Median of US Supreme Court over Time"}\NormalTok{,}
     \AttributeTok{xaxt=}\StringTok{"n"}\NormalTok{, }\DocumentationTok{\#\# removes the x{-}axis}
     \AttributeTok{las=}\DecValTok{1}\NormalTok{)}

\DocumentationTok{\#\# Adds text}
\FunctionTok{text}\NormalTok{(}\AttributeTok{x=}\FunctionTok{names}\NormalTok{(results), }\AttributeTok{y=}\NormalTok{(medians }\SpecialCharTok{{-}}\NormalTok{ .}\DecValTok{14}\NormalTok{), results, }\AttributeTok{cex=}\NormalTok{.}\DecValTok{35}\NormalTok{)}

\DocumentationTok{\#\# Adds color{-}coded points on top of existing points}
\FunctionTok{points}\NormalTok{(}\AttributeTok{x =}\FunctionTok{names}\NormalTok{(medians),}
     \AttributeTok{y=}\NormalTok{ medians,}
     
     \DocumentationTok{\#\# Adds colors according to how results is coded}
     \AttributeTok{col=} \FunctionTok{ifelse}\NormalTok{(results }\SpecialCharTok{==} \StringTok{"AMKennedy"}\NormalTok{, }\StringTok{"orange"}\NormalTok{, }
                 \FunctionTok{ifelse}\NormalTok{(results }\SpecialCharTok{==}\StringTok{"SDOConnor"}\NormalTok{, }\StringTok{"light blue"}\NormalTok{, }
                        \FunctionTok{ifelse}\NormalTok{(results }\SpecialCharTok{==} \StringTok{"JGRoberts"}\NormalTok{, }\StringTok{"purple"}\NormalTok{,}
                        \StringTok{"red3"}\NormalTok{))), }
     \AttributeTok{pch=}\DecValTok{15}\NormalTok{, }\CommentTok{\# point type{-} squares }
     \AttributeTok{cex=}\FloatTok{1.5}\NormalTok{) }\CommentTok{\# size of points}

\DocumentationTok{\#\# Adds custom x{-}axis at the specific years included in names(medians)}
\FunctionTok{axis}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FunctionTok{names}\NormalTok{(medians), }\AttributeTok{cex.axis=}\NormalTok{.}\DecValTok{6}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{06-Loops_files/figure-pdf/unnamed-chunk-34-1.pdf}

}

\end{figure}

We have used the \texttt{points()} function. This adds an additional
layer of points to a plot. It works much like the \texttt{plot} function
in that in takes a set of x and y coordinates.

We could change the look of the plot even more by adding a legend and
altering the borders and look of the plot.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{medians }\OtherTok{\textless{}{-}} \FunctionTok{tapply}\NormalTok{(justices}\SpecialCharTok{$}\NormalTok{post\_mn, justices}\SpecialCharTok{$}\NormalTok{term, median)}
\FunctionTok{plot}\NormalTok{(}\AttributeTok{x =}\FunctionTok{names}\NormalTok{(medians),}
     \AttributeTok{y=}\NormalTok{ medians, }
     \AttributeTok{ylim =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{.}\DecValTok{4}\NormalTok{, }\DecValTok{1}\NormalTok{),}
     \AttributeTok{type =} \StringTok{"b"}\NormalTok{,}
     \AttributeTok{ylab=}\StringTok{"Conservatism"}\NormalTok{,}
     \AttributeTok{xlab=}\StringTok{"Term"}\NormalTok{,}
     \AttributeTok{main=}\StringTok{"Median of US Supreme Court over Time"}\NormalTok{,}
     \AttributeTok{xaxt=}\StringTok{"n"}\NormalTok{, }\CommentTok{\# removes x axis}
     \AttributeTok{las=}\DecValTok{1}\NormalTok{, }\CommentTok{\# changes the orientation of the axis labels}
     \AttributeTok{lwd=}\DecValTok{2}\NormalTok{, }\CommentTok{\# increases the thickness of the lines}
     \AttributeTok{tick=}\NormalTok{F, }\CommentTok{\# removes the tick marks from the axis}
     \AttributeTok{bty=}\StringTok{"n"}\NormalTok{) }\CommentTok{\# removes the plot border}

\DocumentationTok{\#\# adds horizontal dashed gray lines}
\FunctionTok{abline}\NormalTok{(}\AttributeTok{h=}\FunctionTok{seq}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{.}\DecValTok{4}\NormalTok{, }\DecValTok{1}\NormalTok{, .}\DecValTok{2}\NormalTok{), }\AttributeTok{lty=}\DecValTok{2}\NormalTok{, }\AttributeTok{col=}\StringTok{"light gray"}\NormalTok{)}

\DocumentationTok{\#\# Adds a legend}
\FunctionTok{legend}\NormalTok{(}\StringTok{"bottomleft"}\NormalTok{, }\AttributeTok{pch=}\DecValTok{15}\NormalTok{, }\AttributeTok{col =} \FunctionTok{c}\NormalTok{(}\StringTok{"orange"}\NormalTok{, }\StringTok{"light blue"}\NormalTok{, }\StringTok{"purple"}\NormalTok{, }\StringTok{"red3"}\NormalTok{),}
       \FunctionTok{c}\NormalTok{(}\StringTok{"Kennedy"}\NormalTok{, }\StringTok{"O\textquotesingle{}Connor"}\NormalTok{, }\StringTok{"Roberts"}\NormalTok{, }\StringTok{"Kavanaugh"}\NormalTok{), }\AttributeTok{bty=}\StringTok{"n"}\NormalTok{)}

\DocumentationTok{\#\# Adds the color{-}coded points}
\FunctionTok{points}\NormalTok{(}\AttributeTok{x =}\FunctionTok{names}\NormalTok{(medians), }\AttributeTok{y=}\NormalTok{ medians,}
          \AttributeTok{col=} \FunctionTok{ifelse}\NormalTok{(results }\SpecialCharTok{==} \StringTok{"AMKennedy"}\NormalTok{, }\StringTok{"orange"}\NormalTok{, }
                 \FunctionTok{ifelse}\NormalTok{(results }\SpecialCharTok{==}\StringTok{"SDOConnor"}\NormalTok{, }\StringTok{"light blue"}\NormalTok{, }
                        \FunctionTok{ifelse}\NormalTok{(results }\SpecialCharTok{==} \StringTok{"JGRoberts"}\NormalTok{, }\StringTok{"purple"}\NormalTok{,}
                        \StringTok{"red3"}\NormalTok{))), }
     \AttributeTok{pch=}\DecValTok{15}\NormalTok{, }\AttributeTok{cex=}\DecValTok{2}\NormalTok{)}

\DocumentationTok{\#\# Adds our custom x{-}axis}
\FunctionTok{axis}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FunctionTok{names}\NormalTok{(medians), }\AttributeTok{cex.axis=}\NormalTok{.}\DecValTok{6}\NormalTok{, }\AttributeTok{tick=}\NormalTok{F)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{06-Loops_files/figure-pdf/unnamed-chunk-35-1.pdf}

}

\end{figure}

\hypertarget{wrapping-up}{%
\subsection{Wrapping Up}\label{wrapping-up}}

We have calculated and visualized how the median U.S. Supreme Court
Justice and Justice's ideology has changed over the past three decades.

\begin{itemize}
\tightlist
\item
  This gave us additional practice with loops and visualization
\item
  We also gained exposure to an example of how political scientists take
  a large amount of information-- votes on all Supreme Court cases-- and
  try to summarize it using a single number that represents how liberal
  or conservative a justice is
\end{itemize}

This type of information can be used for many social science goals: 1)
To describe trends in the Court 2) To help explain why the Court has
voted a particular way on recent cases 3) To predict how the Court will
vote in the future as new justices arrive.

With Amy Coney Barrett now on the Court for multiple terms and Ketanji
Brown Jackson beginning to decide cases, the MQ scores will continue to
be updated to allow for future exploration of these dynamics.

\begin{figure}

{\centering \includegraphics{images/sccourtkj.png}

}

\caption{\href{https://fivethirtyeight.com/features/how-ketanji-brown-jackson-could-change-the-supreme-court/}{FiveThirtyEight}}

\end{figure}

\bookmarksetup{startatroot}

\hypertarget{prediction}{%
\chapter{Prediction}\label{prediction}}

In this section, we move to our next social science goal

\begin{itemize}
\tightlist
\item
  Describe
\item
  Explain, evaluate, and recommend \(\rightarrow\) Causality
\item
  \textbf{\emph{Predict}}
\item
  Discover
\end{itemize}

Most of the tools we have been working on thus far have focused on first
describing our data and then conducting tests through different types of
comparisons and visualizations, in order to assess a deductive
hypothesis, explaining the relationship between two variables.

Now we turn to a different goal.

Recall the difference between Correlation vs.~Causality using our
graphic showing the popularity of \emph{Duck Dynasty} in different parts
of the country. In 2016, researchers at the
\href{https://www.nytimes.com/interactive/2016/12/26/upshot/duck-dynasty-vs-modern-family-television-maps.html}{NY
Times} noticed that areas in the country where the television show Duck
Dynasty was popular also tended to support Donald Trump at higher rates.

\includegraphics[width=0.7\textwidth,height=\textheight]{images/duckdynasty.png}

For those used to working with the goal of explanation, shifting to
prediction and classification may mean we need to shift what types of
information we think is important.

\begin{itemize}
\tightlist
\item
  Correlation: Areas that watch Duck Dynasty are more likely to support
  Trump (degree to which two variables ``move together'')
\item
  Causality: Watching Duck Dynasty (vs.~not watching) causes you to
  support Trump.
\end{itemize}

If we were interested in the goal of explaining voting decisions (what
causes someone to vote a certain way?), we might not care if someone
watches the show. However, if we were just interested in predicting vote
share or voting decisions, a strong correlation could still be useful.
Without spending a single dollar on surveying a community, we might have
a general sense of their support for a candidate.

\hypertarget{prediction-overview}{%
\section{Prediction Overview}\label{prediction-overview}}

Our goal: Predict (estimate/guess) some unknown using information we
have as accurately and precisely as possible

\begin{itemize}
\tightlist
\item
  Prediction could involve estimating a numeric outcome. Alternatively,
  prediction also involves classification-- predicting a categorical
  outcome (e.g., prediction of who wins vs.~who loses).
\end{itemize}

Some political science examples of this might include

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Categorizing comments on social media as being toxic/nasty/uncivil
\end{enumerate}

\begin{figure}

{\centering \includegraphics{images/instagramhate.png}

}

\caption{Wired}

\end{figure}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  Detecting Fake news and misinformation
\end{enumerate}

\begin{figure}

{\centering \includegraphics{images/fakenewsai.png}

}

\caption{PBS}

\end{figure}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  Forecasting election results
\end{enumerate}

\includegraphics{images/forecast24.png}

Other examples

\begin{itemize}
\tightlist
\item
  Trying to detect hate speech online
\item
  Predicting where or when an attack might occur
\item
  Trying to classify a large amount of text into subject or topic
  categories for analysis
\end{itemize}

What other types of things might we try to predict or classify in
political science?

\hypertarget{process-of-prediction}{%
\section{Process of Prediction}\label{process-of-prediction}}

Predict (estimate/guess) some unknown using information we have -- and
do so as accurately and precisely as possible.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Choose an approach

  \begin{itemize}
  \tightlist
  \item
    Using an observed (known) measure as a direct proxy to predict an
    outcome
  \item
    Using one or more observed (known) measures in a regression model to
    predict an outcome
  \item
    (Beyond the course) Using a statistical model to select the measures
    to use for predicting an outcome
  \end{itemize}
\item
  Assess accuracy and precision

  \begin{itemize}
  \tightlist
  \item
    Prediction error: \(Prediction - Truth\)
  \item
    Bias: Average prediction error: \(\text{mean}(Prediction - Truth)\)

    \begin{itemize}
    \tightlist
    \item
      A prediction is `unbiased' if the bias is zero (If the prediction
      is on average true)
    \end{itemize}
  \item
    Root-mean squared error:
    \(\sqrt{\text{mean}((Prediction - Truth)^2)}\)

    \begin{itemize}
    \tightlist
    \item
      Like `absolute' error-- the average magnitude of the prediction
      error
    \item
      the typical distance the prediction is from the truth
    \end{itemize}
  \item
    Confusion Matrix

    \begin{itemize}
    \tightlist
    \item
      A cross-tab of predictions you got correct vs.~predictions you got
      wrong (misclassified)
    \item
      Gives you true positives and true negatives vs.~false positives
      and false negatives
    \end{itemize}
  \end{itemize}
\item
  Iterate to improve the prediction/classification

  \begin{itemize}
  \tightlist
  \item
    Often, we repeat steps 1-3 until we are confident in your method for
    predicting.
  \end{itemize}
\item
  Danger Zone: Eventually, after you have tested the approach and are
  satisfied with the accuracy, you may start applying it to new data for
  which you do not know the right answer.
\end{enumerate}

\hypertarget{example-forecasting-2020-us-election-based-on-2016-results}{%
\section{Example: Forecasting 2020 US Election based on 2016
Results}\label{example-forecasting-2020-us-election-based-on-2016-results}}

Let's try to predict the 2020 election results using just the 2016
results.

\emph{For a video explainer of the code for this application, see below.
(Via youtube, you can speed up the playback to 1.5 or 2x speed.)}

\url{https://www.youtube.com/watch?v=zWDxZogRwOs}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{results2020 }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"elecresults2020.csv"}\NormalTok{, }\AttributeTok{stringsAsFactors =}\NormalTok{ T)}
\end{Highlighting}
\end{Shaded}

Variables

\begin{itemize}
\tightlist
\item
  \texttt{state}: state or state and district
\item
  \texttt{called}: result of 2020 election
\item
  \texttt{margin2016}: two-party margin in 2016. Positive values
  indicate Democratic win, negative indicate Republican win
\item
  \texttt{EV}: Electoral votes associated with a state/ district of a
  state
\end{itemize}

\includegraphics[width=0.8\textwidth,height=\textheight]{images/result2020.png}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sum}\NormalTok{(results2020}\SpecialCharTok{$}\NormalTok{EV[results2020}\SpecialCharTok{$}\NormalTok{called }\SpecialCharTok{==} \StringTok{"R"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 232
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sum}\NormalTok{(results2020}\SpecialCharTok{$}\NormalTok{EV[results2020}\SpecialCharTok{$}\NormalTok{called }\SpecialCharTok{==} \StringTok{"D"}\NormalTok{])}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 306
\end{verbatim}

\hypertarget{choose-approach}{%
\subsection{Choose Approach}\label{choose-approach}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\tightlist
\item
  Choose an approach: Using an observed (known) measure as a direct
  proxy to predict an outcome
\end{enumerate}

\begin{itemize}
\tightlist
\item
  Let's use the 2016 result as a direct proxy to predict 2020.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{results2020}\SpecialCharTok{$}\NormalTok{predicted2020 }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(results2020}\SpecialCharTok{$}\NormalTok{margin2016 }\SpecialCharTok{\textless{}} \DecValTok{0}\NormalTok{, }\StringTok{"R"}\NormalTok{, }\StringTok{"D"}\NormalTok{)}
\NormalTok{results2020}\SpecialCharTok{$}\NormalTok{predicted2020 }\OtherTok{\textless{}{-}} \FunctionTok{as.factor}\NormalTok{(results2020}\SpecialCharTok{$}\NormalTok{predicted2020)}
\end{Highlighting}
\end{Shaded}

\hypertarget{assess-accuracy}{%
\subsection{Assess Accuracy}\label{assess-accuracy}}

\begin{enumerate}
\def\labelenumi{\arabic{enumi})}
\setcounter{enumi}{1}
\tightlist
\item
  Assess accuracy
\end{enumerate}

What proportion of states did we get correct?

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(results2020}\SpecialCharTok{$}\NormalTok{predicted2020 }\SpecialCharTok{==}\NormalTok{ results2020}\SpecialCharTok{$}\NormalTok{called)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0.8928571
\end{verbatim}

Classification

We want to correctly predict the winner of each state

Prediction of binary outcome variable = classification problem

\begin{itemize}
\tightlist
\item
  true positive: correctly predicting Biden to be the winner
\item
  false positive: incorrectly predicting Biden to be the winner
  (misclassification)
\item
  true negative: correctly predicting Biden to be the loser
\item
  false negative: incorrectly predicting Biden to be the loser
  (misclassification)
\end{itemize}

We define one outcome as the ``positive'' and one as the ``negative.''
Here we will say a Biden win is the positive and a Trump win is the
negative. You could flip this and make a Trump win the positive and a
Biden win the negative. This terminology comes from settings where there
is a more objective positive vs.~negative result (e.g., a positive
medical test result) than most social science settings. The key thing is
that we are trying to identify different types of correct
classifications vs.~misclassifications.

Confusion Matrix: Tells us how we went right, how we went wrong.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(}\AttributeTok{predicted=}\NormalTok{results2020}\SpecialCharTok{$}\NormalTok{predicted2020, }\AttributeTok{actual =}\NormalTok{ results2020}\SpecialCharTok{$}\NormalTok{called)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
         actual
predicted  D  R
        D 22  0
        R  6 28
\end{verbatim}

Which states did we get wrong?

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{results2020}\SpecialCharTok{$}\NormalTok{state[results2020}\SpecialCharTok{$}\NormalTok{predicted2020 }\SpecialCharTok{!=}\NormalTok{ results2020}\SpecialCharTok{$}\NormalTok{called]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] Arizona               Georgia               Michigan             
[4] Nebraska 2nd District Pennsylvania          Wisconsin            
56 Levels: Alabama Alaska Arizona Arkansas California Colorado ... Wyoming
\end{verbatim}

\hypertarget{iterate-to-improve-predictions}{%
\subsection{Iterate to improve
predictions}\label{iterate-to-improve-predictions}}

Start back at step one. We continue to repeat steps 1 and 2 until we are
confident in our predictions.

How could we improve our predictions of elections? What other
information could we use?

\hypertarget{example-using-polls-to-predict-the-2020-election-results}{%
\section{Example: Using polls to predict the 2020 election
results}\label{example-using-polls-to-predict-the-2020-election-results}}

\emph{For a video explainer of the code for this application, see below.
(Via youtube, you can speed up the playback to 1.5 or 2x speed.)}

\url{https://www.youtube.com/watch?v=zWDxZogRwOs}

Many forecasters use pre-election polls in their models to predict
election outcomes. In 2016 and 2020, polling-based forecasts received a
lot of criticism

Prior to the 2016 elections, forecasts that used polls seemed confident
that Hillary Clinton would win the election.
\href{https://www.youtube.com/watch?v=zerWCVpXTr8}{Political analysts}
also seemed to think the polls were favorable to Clinton.

\begin{figure}

{\centering \includegraphics{images/clintonupshot.png}

}

\caption{\emph{NY Upshot}}

\end{figure}

We all know that afterwards, Clinton did not win.

\begin{figure}

{\centering \includegraphics[width=0.7\textwidth,height=\textheight]{images/afterpolls.png}

}

\caption{\emph{Pew}}

\end{figure}

This led public opinion scholars and practitioners to do a deep
investigation into the quality of pre-election polling. Like 2016,
following the 2020 election, a similar team investigated the quality of
pre-election polling in 2020. Here, while many polls pointed to a
favorable outcome for Biden, the results seemed closer than one might
have anticipated.

\includegraphics{images/aaportitle.png}

The results of these findings are in the
\href{https://www.aapor.org/AAPOR_Main/media/MainSiteFiles/AAPOR-Task-Force-on-2020-Pre-Election-Polling_Report-FNL.pdf}{AAPOR
report}.

\hypertarget{choose-an-approach-lets-analyze-some-polls}{%
\subsection{Choose an approach: Let's analyze some
polls}\label{choose-an-approach-lets-analyze-some-polls}}

We are going to do our own analysis of pre-election polls as a
prediction of the 2020 election results. We will use a large number of
state polls conducted from May-November 2020 that were made available to
the public on FiveThirtyEight.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{polls2020 }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"pollsandresults2020.csv"}\NormalTok{, }\AttributeTok{stringsAsFactors =}\NormalTok{ T)}
\end{Highlighting}
\end{Shaded}

Variables

\begin{itemize}
\tightlist
\item
  \texttt{TrumpPoll,\ BidenPoll}: Poll-based vote share for Biden or
  Trump
\item
  \texttt{TrumpResult,\ BidenResult}: Actual vote share for Biden or
  Trump
\item
  \texttt{EV}: Electoral votes associated with state/CD
\item
  \texttt{days\_to\_election}: Days until Election Day
\item
  \texttt{stateid}: state abbreviation
\item
  \texttt{fte\_grade}: FiveThirtyEight Pollster grade
\item
  \texttt{sample\_size}: Poll sample size
\end{itemize}

Can we predict the outcome of an election using polls?

Let's create our outcome variables.

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Biden\textquotesingle{}s margin of victory (or defeat) in  the polls}
\NormalTok{polls2020}\SpecialCharTok{$}\NormalTok{polldiff }\OtherTok{\textless{}{-}}\NormalTok{ polls2020}\SpecialCharTok{$}\NormalTok{BidenPoll }\SpecialCharTok{{-}}\NormalTok{ polls2020}\SpecialCharTok{$}\NormalTok{TrumpPoll}

\DocumentationTok{\#\# Biden\textquotesingle{}s margin of victory (or defeat) in the actual election result}
\NormalTok{polls2020}\SpecialCharTok{$}\NormalTok{resultdiff }\OtherTok{\textless{}{-}}\NormalTok{ polls2020}\SpecialCharTok{$}\NormalTok{BidenResult }\SpecialCharTok{{-}}\NormalTok{ polls2020}\SpecialCharTok{$}\NormalTok{TrumpResult}
\end{Highlighting}
\end{Shaded}

Positive numbers mean Biden was ahead/won. Negative mean Trump was
ahead/won.

\includegraphics[width=0.8\textwidth,height=\textheight]{images/result2020.png}

Let's predict the amount of electoral votes for Biden based on polls in
each state close to Election Day.

Let's start with 1 state.

\begin{itemize}
\tightlist
\item
  Let's grab all polls within 2 weeks of the election or the most recent
  day polled (for areas that did not have recent polls)
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Iteration vector}
\NormalTok{states }\OtherTok{\textless{}{-}} \FunctionTok{unique}\NormalTok{(polls2020}\SpecialCharTok{$}\NormalTok{stateid)}
\NormalTok{states[}\DecValTok{1}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] AL
55 Levels: AK AL AR AZ CA CO CT DC DE FL GA HI IA ID IL IN KS KY LA MA ... WY
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Subset to just Alabama}
\NormalTok{subdata }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(polls2020, stateid }\SpecialCharTok{==}\NormalTok{ states[}\DecValTok{1}\NormalTok{])}

\DocumentationTok{\#\# Further subset to the "latest polls"}
\NormalTok{subdata }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(subdata, days\_to\_election }\SpecialCharTok{\textless{}} \DecValTok{15} \SpecialCharTok{|} 
\NormalTok{                      days\_to\_election }\SpecialCharTok{==} \FunctionTok{min}\NormalTok{(subdata}\SpecialCharTok{$}\NormalTok{days\_to\_election) )}
\end{Highlighting}
\end{Shaded}

Now let's extract the actual margin for Biden, the poll-based predicted
margin, and finally, let's assign electoral votes based on our
prediction.

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Find the margin for the actual result}
\NormalTok{result.marginAL }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(subdata}\SpecialCharTok{$}\NormalTok{resultdiff)}
\NormalTok{result.marginAL}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] -25.4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Find the margin for our prediction}
\NormalTok{polls.marginAL }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(subdata}\SpecialCharTok{$}\NormalTok{polldiff)}
\NormalTok{polls.marginAL}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] -21.16667
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Allocate votes for Biden according to the margin}
\NormalTok{bidenvotesAL }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(}\FunctionTok{mean}\NormalTok{(subdata}\SpecialCharTok{$}\NormalTok{polldiff) }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{, }
                            \FunctionTok{unique}\NormalTok{(subdata}\SpecialCharTok{$}\NormalTok{EV), }\DecValTok{0}\NormalTok{)}
\NormalTok{bidenvotesAL}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0
\end{verbatim}

We predicted Biden would lose Alabama because the
\texttt{polls.marginAL} is negative. Therefore, we assigned Biden 0
electoral votes in this example.

\hypertarget{loop-through-all-states}{%
\subsection{Loop through all states}\label{loop-through-all-states}}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Iteration vector}
\NormalTok{states }\OtherTok{\textless{}{-}} \FunctionTok{unique}\NormalTok{(polls2020}\SpecialCharTok{$}\NormalTok{stateid)}
\DocumentationTok{\#\# Container vector}
\NormalTok{polls.margin }\OtherTok{\textless{}{-}}\NormalTok{ result.margin }\OtherTok{\textless{}{-}}\NormalTok{ bidenvotes }\OtherTok{\textless{}{-}} 
  \FunctionTok{rep}\NormalTok{(}\ConstantTok{NA}\NormalTok{, }\FunctionTok{length}\NormalTok{(states))}

\FunctionTok{names}\NormalTok{(polls.margin) }\OtherTok{\textless{}{-}} \FunctionTok{names}\NormalTok{(result.margin) }\OtherTok{\textless{}{-}} 
  \FunctionTok{names}\NormalTok{(bidenvotes)  }\OtherTok{\textless{}{-}}\FunctionTok{as.character}\NormalTok{(}\FunctionTok{unique}\NormalTok{(states))}

\DocumentationTok{\#\# Loop}
\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(states))\{}
\NormalTok{  subdata }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(polls2020, stateid }\SpecialCharTok{==}\NormalTok{ states[i] )}
\NormalTok{  subdata }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(subdata, days\_to\_election }\SpecialCharTok{\textless{}} \DecValTok{15} \SpecialCharTok{|} 
\NormalTok{                      days\_to\_election }\SpecialCharTok{==} \FunctionTok{min}\NormalTok{(subdata}\SpecialCharTok{$}\NormalTok{days\_to\_election) )}
\NormalTok{  result.margin[i] }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(subdata}\SpecialCharTok{$}\NormalTok{resultdiff)}
\NormalTok{  polls.margin[i] }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(subdata}\SpecialCharTok{$}\NormalTok{polldiff)}
\NormalTok{  bidenvotes[i] }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(}\FunctionTok{mean}\NormalTok{(subdata}\SpecialCharTok{$}\NormalTok{polldiff) }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{, }
                            \FunctionTok{unique}\NormalTok{(subdata}\SpecialCharTok{$}\NormalTok{EV), }\DecValTok{0}\NormalTok{)}
\NormalTok{ \}}
\FunctionTok{sum}\NormalTok{(bidenvotes) }\CommentTok{\# predicted}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 351
\end{verbatim}

\hypertarget{check-accuracy}{%
\subsection{Check Accuracy}\label{check-accuracy}}

\hypertarget{quantitative-measures-of-accuracy}{%
\subsubsection{Quantitative Measures of
Accuracy}\label{quantitative-measures-of-accuracy}}

Let's calculate two common measures of prediction error: bias (the
average prediction error) and root-mean-squared error (a typical
magnitude of the prediction error).

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Calculate Bias (Predicted Biden {-} True Biden)}
\NormalTok{predictionerror }\OtherTok{\textless{}{-}}\NormalTok{ polls.margin }\SpecialCharTok{{-}}\NormalTok{result.margin }
\NormalTok{bias }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(predictionerror)}

\DocumentationTok{\#\# Root Mean Squared Error}
\FunctionTok{sqrt}\NormalTok{(}\FunctionTok{mean}\NormalTok{((predictionerror)}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 6.052873
\end{verbatim}

On average, the poll-based prediction was more than 4 points larger for
Biden's margin than the actual result.

We can create a plot similar to the left plot from the AAPOR report.

\includegraphics{images/aaporhist20.png}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Histogram of Prediction Errors to Show Bias}
\FunctionTok{hist}\NormalTok{(predictionerror, }
     \AttributeTok{xlab =} \StringTok{"Prediction Error (Predicted Biden Margin {-} Actual)"}\NormalTok{,}
     \AttributeTok{main =} \StringTok{"Histogram of Prediction Error in Latest Polls"}\NormalTok{)}
\FunctionTok{abline}\NormalTok{(}\AttributeTok{v=}\FunctionTok{mean}\NormalTok{(predictionerror), }\AttributeTok{col=}\StringTok{"red"}\NormalTok{)}
\FunctionTok{abline}\NormalTok{(}\AttributeTok{v=}\DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{07-Prediction_files/figure-pdf/unnamed-chunk-15-1.pdf}

}

\end{figure}

Bonus: Another way to visualize the prediction error

\begin{itemize}
\tightlist
\item
  Let's create our own version of this AAPOR Plot
\end{itemize}

\includegraphics{images/aapor20.png}

We will plot the prediction error on the x-axis, and list the
corresponding states on the y-axis.

\begin{itemize}
\tightlist
\item
  We will sort the prediction error to make it easier to see the pattern
  of results.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(}\AttributeTok{x=}\FunctionTok{sort}\NormalTok{(predictionerror), }\AttributeTok{y=}\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(predictionerror),}
     \AttributeTok{main=}\StringTok{"Average Prediction Error by State }\SpecialCharTok{\textbackslash{}n}\StringTok{ Biden {-} Trump Margin"}\NormalTok{,}
     \AttributeTok{ylab=}\StringTok{"State"}\NormalTok{,}
     \AttributeTok{xlab=}\StringTok{"Prediction Error (Predicted Biden Margin {-} Actual Margin)"}\NormalTok{,}
     \AttributeTok{yaxt=}\StringTok{"n"}\NormalTok{,}
     \AttributeTok{bty=}\StringTok{"n"}\NormalTok{,}
     \AttributeTok{xlim =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{5}\NormalTok{, }\DecValTok{15}\NormalTok{)) }
\FunctionTok{abline}\NormalTok{(}\AttributeTok{v=}\DecValTok{0}\NormalTok{, }\AttributeTok{lty=}\DecValTok{2}\NormalTok{)}
\FunctionTok{axis}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(predictionerror), }\AttributeTok{labels=}\FunctionTok{names}\NormalTok{(}\FunctionTok{sort}\NormalTok{(predictionerror)), }\AttributeTok{las=}\DecValTok{1}\NormalTok{, }
     \AttributeTok{cex.axis=}\NormalTok{.}\DecValTok{5}\NormalTok{,}\AttributeTok{tick=}\NormalTok{F)}
\FunctionTok{axis}\NormalTok{(}\DecValTok{1}\NormalTok{, }\FunctionTok{seq}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{5}\NormalTok{, }\DecValTok{15}\NormalTok{, }\DecValTok{5}\NormalTok{), }\FunctionTok{seq}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{5}\NormalTok{, }\DecValTok{15}\NormalTok{, }\DecValTok{5}\NormalTok{))}
\FunctionTok{text}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{3}\NormalTok{, }\DecValTok{15}\NormalTok{, }\StringTok{"Poll Margin }\SpecialCharTok{\textbackslash{}n}\StringTok{ Skewed Toward Trump"}\NormalTok{, }\AttributeTok{cex=}\NormalTok{.}\DecValTok{7}\NormalTok{)}
\FunctionTok{text}\NormalTok{(}\DecValTok{8}\NormalTok{, }\DecValTok{15}\NormalTok{, }\StringTok{"Poll Margin }\SpecialCharTok{\textbackslash{}n}\StringTok{ Skewed Toward Biden"}\NormalTok{, }\AttributeTok{cex=}\NormalTok{.}\DecValTok{7}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{07-Prediction_files/figure-pdf/unnamed-chunk-16-1.pdf}

}

\end{figure}

\hypertarget{classification}{%
\subsubsection{Classification}\label{classification}}

Instead of quantifying how far we were off, let's see where we were
right vs.~where we were wrong.

Classification

\begin{itemize}
\tightlist
\item
  true positive: correctly predicting Biden to be the winner
\item
  false positive: incorrectly predicting Biden to be the winner
\item
  true negative: correctly predicting Biden to be the loser
\item
  false negative: incorrectly predicting Biden to be the loser
\end{itemize}

Confusion Matrix

Let's classify our predictions.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{actualwins }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(result.margin }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{, }\StringTok{"Biden Won"}\NormalTok{, }\StringTok{"Trump Won"}\NormalTok{)}
\NormalTok{predictedwins }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(polls.margin }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{, }\StringTok{"Biden Won"}\NormalTok{, }\StringTok{"Trump Won"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(predictedwins, actualwins)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
             actualwins
predictedwins Biden Won Trump Won
    Biden Won        28         3
    Trump Won         0        24
\end{verbatim}

Where did the polls get it wrong?

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{actualwins[actualwins }\SpecialCharTok{!=}\NormalTok{ predictedwins]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
         FL         ME2          NC 
"Trump Won" "Trump Won" "Trump Won" 
\end{verbatim}

What's your conclusion?

\begin{itemize}
\tightlist
\item
  Are the polls alright?
\item
  How could you improve the prediction?
\item
  Wait a second\ldots{} why even poll?
\end{itemize}

\bookmarksetup{startatroot}

\hypertarget{regression}{%
\chapter{Prediction with Regression}\label{regression}}

We are continuing our topic of prediction, this time adding a new tool:
linear regression.

Recall that we predict (estimate/guess) some unknown using information
we have -- and do so as accurately and precisely as possible.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Choose an approach

  \begin{itemize}
  \tightlist
  \item
    Using an observed (known) measure as a direct proxy to predict an
    outcome
  \item
    \textbf{\emph{Using one or more observed (known) measures in a
    regression model to predict an outcome}}
  \item
    (Beyond the course) Using a statistical model to select the measures
    to use for predicting an outcome
  \end{itemize}
\item
  Assess accuracy and precision
\item
  Iterate to improve the prediction/classification

  \begin{itemize}
  \tightlist
  \item
    Often, we \href{https://www.youtube.com/watch?v=rXPfovXw2tw}{repeat
    steps 1-3} until we are confident in your method for predicting.
  \end{itemize}
\item
  Danger Zone: Eventually, after you have tested the approach and are
  satisfied with the accuracy, you may start applying it to new data for
  which you do not know the right answer.
\end{enumerate}

\hypertarget{regression-in-the-wild.}{%
\section{Regression in the wild.}\label{regression-in-the-wild.}}

Regression is used across many domains for prediction and
classification, from fantasy football to making World Cup predictions,
or even predicting how far a contestant will go on \emph{The Bachelor}
or \emph{The Bachelorette}.

\includegraphics{images/fantasy1.png}

Using data to predict reality TV outcomes.

\includegraphics[width=0.4\textwidth,height=\textheight]{images/bach1.png}
\includegraphics[width=0.4\textwidth,height=\textheight]{images/bachinp.png}

In politics, we might use regression to build campaign models--
predicting which voters are persuadable, which supporters will volunteer
at campaign events, which supporters will turn out to vote, etc.

\includegraphics{images/polcampaign.png}

\hypertarget{application-baseball-predictions}{%
\section{Application: Baseball
Predictions}\label{application-baseball-predictions}}

For our first example, we will stay outside of politics and use
regression to predict the success of a baseball team.

\href{https://www.youtube.com/watch?v=-4QPVo0UIzc}{Moneyball} is a \$100
million Hollywood movie that is all about linear regression\ldots{} and
some baseball\ldots{} and Brad Pitt, but really\ldots{} it's MOSTLY
about linear regression

\includegraphics{images/moneyball.jpeg}

The movie describes the Oakland A's shift to start using data to build
their team. They make two observations 1) To win baseball games, you
need runs. 2) To score runs, you need to get on base. We can estimate
what on base percentage we would need as a team to score enough runs to
make the playoffs in a typical season.

We will use regression to make these predictions.

\emph{For a video explainer of the code for this application, see below.
(Via youtube, you can speed up the playback to 1.5 or 2x speed.)}

\url{https://www.youtube.com/watch?v=wtn-W8Uv32E}

We use \texttt{baseball.csv} data

\begin{itemize}
\tightlist
\item
  \texttt{RS}: runs scored;
\item
  \texttt{RA}: runs allowed;
\item
  \texttt{W}: wins;
\item
  \texttt{Playoffs}: whether team made playoffs;
\item
  \texttt{OBP}: on base percentage;
\item
  \texttt{BA}: batting average;
\item
  \texttt{SLG}: Slugging Percentage
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{baseball }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"baseball.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(baseball)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  Team League Year  RS  RA  W   OBP   SLG    BA Playoffs RankSeason
1  ARI     NL 2012 734 688 81 0.328 0.418 0.259        0         NA
2  ATL     NL 2012 700 600 94 0.320 0.389 0.247        1          4
3  BAL     AL 2012 712 705 93 0.311 0.417 0.247        1          5
4  BOS     AL 2012 734 806 69 0.315 0.415 0.260        0         NA
5  CHC     NL 2012 613 759 61 0.302 0.378 0.240        0         NA
6  CHW     AL 2012 748 676 85 0.318 0.422 0.255        0         NA
  RankPlayoffs   G  OOBP  OSLG
1           NA 162 0.317 0.415
2            5 162 0.306 0.378
3            4 162 0.315 0.403
4           NA 162 0.331 0.428
5           NA 162 0.335 0.424
6           NA 162 0.319 0.405
\end{verbatim}

Below we can see the first observation made: Runs scored are highly
correlated with team wins

\includegraphics{08-Regression_files/figure-pdf/unnamed-chunk-4-1.pdf}

What the A's noticed is that a team's On Base Percentage is also highly
correlated with runs scored. This aligns with conventional wisdom.
Players get a lot of hype when they achieve a high OBP.

\includegraphics{images/harper.png}

Harper is one of only 11 players with at least 100 plate appearances and
a postseason on base percentage plus slugging percentage greater than
1.000. - USA Today

This correlation shows up in our data, too.

\includegraphics{08-Regression_files/figure-pdf/unnamed-chunk-5-1.pdf}

\hypertarget{step-1-approach--regression-in-r}{%
\section{Step 1: Approach- Regression in
R}\label{step-1-approach--regression-in-r}}

A regression draws a ``best fit line'' between the points. This allows
us -- for any given OBP -- to estimate the number of runs scored.

\begin{itemize}
\tightlist
\item
  Our best prediction of the number of runs scored would be the spot on
  the purple line directly above a given OBP.
\end{itemize}

\includegraphics{08-Regression_files/figure-pdf/unnamed-chunk-6-1.pdf}

The regression model is \(Y = \alpha + \beta X + \epsilon\). Let's
demystify this. See also this interactive tutorial:
https://ellaudet.iq.harvard.edu/linear\_model.

\begin{itemize}
\tightlist
\item
  A regression model describes the relationship between one or more
  independent variables \(X\) (explanatory variables) and an outcome
  variable \(Y\) (dependent variable)

  \begin{itemize}
  \tightlist
  \item
    For example, the relationship between our independent variable, On
    Base Percentage, and our dependent variable, Runs Scored
  \end{itemize}
\item
  We want to know what happens with our dependent variable \(Y\) if our
  independent variable \(X\) increases.

  \begin{itemize}
  \tightlist
  \item
    As we increase our On Base Percentage, a regression model will help
    us estimate how much we should expect our Runs Scored to increase
    (or decrease)
  \end{itemize}
\item
  \(\alpha\) and \(\beta\) are considered ``parameters'' -- things we
  don't know but want to estimate. These two numbers will define exactly
  how we think \(X\) and \(Y\) are related (the shape of the line).
\item
  No two variables are perfectly related, so we also have the
  \(\epsilon\) term, which describes the error in the model
\end{itemize}

When we have data, we estimate \(Y\), \(\alpha\), and \(\beta\):
\(\hat Y = \hat \alpha + \hat \beta X\).

\begin{itemize}
\tightlist
\item
  The \({\hat{hat}}\) over the letters means those are our estimated
  values.
\end{itemize}

In R, the regression syntax is similar to what we use in making a
boxplot:
\texttt{fit\ \textless{}-\ lm(y\ \textasciitilde{}\ x,\ data\ =\ mydata)}

\begin{itemize}
\tightlist
\item
  \texttt{fit} is just whatever you want to call the output of the
  model,
\item
  \texttt{y} is the name of the dependent variable,
\item
  \texttt{x} is the name of the independent variable, and
\item
  \texttt{mydata} is whatever you have called your dataframe. E.g.:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(RS }\SpecialCharTok{\textasciitilde{}}\NormalTok{ OBP, }\AttributeTok{data =}\NormalTok{ baseball)}
\end{Highlighting}
\end{Shaded}

When we have data, we estimate \(Y\), \(\alpha\), and \(\beta\):
\(\hat Y = \hat \alpha + \hat \beta X\).

\begin{itemize}
\tightlist
\item
  Our model gives us the ``coefficient'' estimates for \(\hat \alpha\)
  and \(\hat \beta\).
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{coef}\NormalTok{(fit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
(Intercept)         OBP 
  -1076.602    5490.386 
\end{verbatim}

The first coefficient is \(\hat \alpha\), this represents the intercept
-- the estimated value our dependent variable will take if our
independent variable (\(x\)) is 0.

\begin{itemize}
\tightlist
\item
  The value the estimated runs scored would be if a team had a 0.000 on
  base percentage. In our case, this value is estimated to be negative,
  which is impossible (but it would also be unusual for a team to have a
  0.000 on base percentage). Therefore, the intercept isn't inherently
  substantively interesting to us.
\end{itemize}

The second coefficient is \(\hat \beta\) is the slope This represents
the \textbf{expected change in our dependent variable for a 1-unit
increase in our independent variable}.

\begin{itemize}
\tightlist
\item
  For example, if we go from a 0.000 on base percentage to a 1.000 on
  base percentage, we would expect a 5490.4 increase in runs scored!
\item
  Note: slope can be positive or negative similar to correlation
  \ldots{} BUT \ldots{}
\item
  Note: slope is in the units of the dependent variable (e.g., runs). It
  is not constrained to be between -1 and 1.
\item
  It is telling us that the greater the OBP, the better!
\end{itemize}

\hypertarget{visualizing-a-regression}{%
\subsection{Visualizing a regression}\label{visualizing-a-regression}}

We can plot the regression using a scatterplot and \texttt{abline()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(}\AttributeTok{x=}\NormalTok{baseball}\SpecialCharTok{$}\NormalTok{OBP, }\AttributeTok{y=}\NormalTok{baseball}\SpecialCharTok{$}\NormalTok{RS, }
     \AttributeTok{ylab =} \StringTok{"Runs Scored"}\NormalTok{,}
     \AttributeTok{xlab =}  \StringTok{"On Base Percentage"}\NormalTok{, }
     \AttributeTok{main=}\StringTok{"Runs Scored by On Base Percentage"}\NormalTok{,}
     \AttributeTok{pch=}\DecValTok{20}\NormalTok{)}

\DocumentationTok{\#\# Add regression line}
\FunctionTok{abline}\NormalTok{(fit, }\AttributeTok{lwd=}\DecValTok{3}\NormalTok{, }\AttributeTok{col =} \StringTok{"purple"}\NormalTok{) }\CommentTok{\# add line}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{08-Regression_files/figure-pdf/unnamed-chunk-9-1.pdf}

}

\end{figure}

\hypertarget{making-predictions-with-regression}{%
\subsection{Making predictions with
regression}\label{making-predictions-with-regression}}

A regression model allows us to estimate or ``predict'' values of our
dependent variable for a given value of our independent variable.

\includegraphics{08-Regression_files/figure-pdf/unnamed-chunk-10-1.pdf}

The red dot represents our estimate (best prediction) of the number of
runs scored if a team has an on base percentage of .300. In R, we can
calculate this value using \texttt{predict()}.

\begin{itemize}
\tightlist
\item
  The syntax is \texttt{predict(fit,\ data.frame(x\ =\ value))} where
  \texttt{fit} is the name of the model, \texttt{x} is the name of the
  independent variable, and \texttt{value} represents the value for the
  independent variable for which you want to predict your outcome (e.g.,
  .300).
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{predict}\NormalTok{(fit, }\FunctionTok{data.frame}\NormalTok{(}\AttributeTok{OBP=}\NormalTok{.}\DecValTok{300}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       1 
570.5137 
\end{verbatim}

Under the hood, this is just using the regression formula described
above. For example, to estimate the number of runs scored for a .300 on
base percentage, we take \(\hat \alpha + \hat \beta * .300\)

\begin{itemize}
\tightlist
\item
  Note that below we compare the output of the predict function to our
  output if we manually calculated the estimated value.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{predict}\NormalTok{(fit, }\FunctionTok{data.frame}\NormalTok{(}\AttributeTok{OBP=}\NormalTok{.}\DecValTok{300}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       1 
570.5137 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# a + b*.300}
\FunctionTok{coef}\NormalTok{(fit)[}\DecValTok{1}\NormalTok{] }\SpecialCharTok{+}  \FunctionTok{coef}\NormalTok{(fit)[}\DecValTok{2}\NormalTok{]}\SpecialCharTok{*}\NormalTok{.}\DecValTok{300}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
(Intercept) 
   570.5137 
\end{verbatim}

Let's say a team thought they needed about 900 runs scored to get to the
playoffs, and they were pretty sure they could get a team on base
percentage of .500. How many runs would they be expected to score with
that OBP? Do you think they will make the playoffs?

Try on your own, then expand for the solution.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{predict}\NormalTok{(fit, }\FunctionTok{data.frame}\NormalTok{(}\AttributeTok{OBP=}\NormalTok{.}\DecValTok{500}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       1 
1668.591 
\end{verbatim}

It's greater than 900, so we should feel good about our chances.

\hypertarget{step-2-checking-accuracy-of-model}{%
\section{Step 2: Checking accuracy of
model}\label{step-2-checking-accuracy-of-model}}

Understanding prediction error: Where do \(\hat \alpha\) and
\(\hat \beta\) come from? Recall that a regression tries to draw a
``best fit line'' between the points of data.

Under the hood of the regression function, we are searching for the
values of \(\hat \alpha\) and \(\hat \beta\) that try to minimize the
distance between the individual points and the regression line.

\includegraphics[width=0.8\textwidth,height=\textheight]{images/residual.png}

This distance is called the residual:
\(\hat \epsilon_i = Y_i - \hat Y_i\).

\begin{itemize}
\tightlist
\item
  This is our \textbf{\emph{prediction error}}: How far off our estimate
  of Y is (\(\hat Y_i\)) from the true value of Y (\(Y_i\))
\item
  Linear regressions choose \(\hat \alpha\) and \(\hat \beta\) to
  minimize the ``squared distance'' of this error (think of this as the
  magnitude of the distance). This is why we tend to call this type of
  linear regression ordinary least squares (OLS regression).
\end{itemize}

If instead we chose the red line in the image below to be the regression
line, you can see that the typical prediction error would be much
larger. That's why we end up with the purple line.

\includegraphics[width=0.8\textwidth,height=\textheight]{images/bestfit.png}

\hypertarget{root-mean-squared-error}{%
\subsection{Root Mean Squared Error}\label{root-mean-squared-error}}

Just like we had root mean squared error in our poll predictions, we can
calculate this for our regression.

\begin{itemize}
\tightlist
\item
  Just like with the polls, this is the square root of the mean of our
  squared prediction errors, or ``residuals'' in the case of regression.

  \begin{itemize}
  \tightlist
  \item
    R will give us this output using this formula where \texttt{fit} is
    the hypothetical name we have provided for the regression model:
    \texttt{sqrt(mean(fit\$residuals\^{}2))}
  \end{itemize}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sqrt}\NormalTok{(}\FunctionTok{mean}\NormalTok{(fit}\SpecialCharTok{$}\NormalTok{residuals}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 39.78956
\end{verbatim}

\begin{itemize}
\tightlist
\item
  In our case, using on based percentage to predict runs scored, our
  estimates are off typically, by about 40 runs scored.
\item
  On the graph, this means that the typical distance between a black
  point and the purple line is about 40.
\end{itemize}

\hypertarget{step-3-iterate-and-compare-models}{%
\section{Step 3: Iterate and Compare
Models}\label{step-3-iterate-and-compare-models}}

When building predictive models, often researchers want to minimize this
Root-Mean Squared Error -- minimizing the magnitude of the typical
prediction error (the distance between the actual value of our outcome,
and the true value)

Example: Let's compare the RMSE from two different models:

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Predicting Runs Scored with OBP}
\NormalTok{fit }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(RS }\SpecialCharTok{\textasciitilde{}}\NormalTok{ OBP, }\AttributeTok{data =}\NormalTok{ baseball)}

\DocumentationTok{\#\# Predicting Runs Scored with Batting Average}
\NormalTok{fit2 }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(RS }\SpecialCharTok{\textasciitilde{}}\NormalTok{ BA, }\AttributeTok{data =}\NormalTok{ baseball)}
\end{Highlighting}
\end{Shaded}

The Oakland A's noticed that OBP was a more precise predictor than BA,
and RMSE gives us one way to assess this.

\hypertarget{regression-with-multiple-predictors}{%
\subsection{Regression with Multiple
Predictors}\label{regression-with-multiple-predictors}}

You can also add more than 1 predictor to a regression using the
\texttt{+} sign.

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Predicting Runs Scored with OBP and Slugging Percentage}
\NormalTok{fit3 }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(RS }\SpecialCharTok{\textasciitilde{}}\NormalTok{ OBP }\SpecialCharTok{+}\NormalTok{ SLG, }\AttributeTok{data =}\NormalTok{ baseball)}
\FunctionTok{sqrt}\NormalTok{(}\FunctionTok{mean}\NormalTok{(fit3}\SpecialCharTok{$}\NormalTok{residuals}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 25.09135
\end{verbatim}

Look how the RMSE dropped again, improving our prediction.

\hypertarget{application-predicting-campaign-donations}{%
\section{Application: Predicting Campaign
Donations}\label{application-predicting-campaign-donations}}

Can we predict campaign donations?

\includegraphics{images/moneymoney.jpeg}

Data from Barber, Michael J., Brandice CanesWrone, and Sharece Thrower.
``Ideologically sophisticated donors: Which candidates do individual
contributors finance?.'' American Journal of Political Science 61.2
(2017): 271-288

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{load}\NormalTok{(}\StringTok{"donationdata.RData"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Variables

\begin{itemize}
\tightlist
\item
  \texttt{donation}: 1=made donation to senator, 0=no donation made
\item
  \texttt{total\_donation}: Dollar amount of donation made by donor to
  Senator
\item
  \texttt{sameparty}: 1=self-identifies as being in the candidate's
  party; 0 otherwise
\item
  \texttt{NetWorth}: Donor's net worth. 1=less than 250k, 2=250-500k;
  3=500k-1m; 4=1-2.5m; 5=2.5-5m; 6=5-10m; 7=more than 10m
\item
  \texttt{IncomeLastYear}: Donor's household annual income in 2013.
  1=less than 50k; 2=50-100k; 3=100-125k; 4=125-150k; 5=150-250k;
  6=250-300k; 7=300-350k; 8=350-400k; 9=400-500k; 10=more than 500k
\item
  \texttt{peragsen}: percent issue agreement between donor and senator
\item
  \texttt{per2agchal}: percent issue agreement between donor and the
  senator's challenger
\item
  \texttt{cook}: Cook competitiveness score for the senator's race. 1 =
  Solid Dem or Solid Rep; 2 = Likely
\item
  \texttt{matchcommf}: 1=Senator committee matches donor's profession as
  reported in FEC file; 0=otherwise
\item
  \texttt{Edsum}: Donor's self-described educational attainment. 1=less
  than high school; 2=high school; 3=some college; 4=2-year college
  degree; 5=4-year college degree; 6=graduate degree
\end{itemize}

Data represent information on past donors to campaigns across different
states. The key dependent variable that we want to predict is
\texttt{total\_donation}: the total dollar amount a particular person in
the data gave to their senator in the 2012 election campaign.

Can we predict how much someone donates to a U.S. Senate campaign?

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Choose approach: regression of donations on donor characteristics
\item
  Check accuracy: calculate root-mean-squared error
\item
  Iterate: try different regression model specifications
\end{enumerate}

Let's try a prediction based on a person's income.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(total\_donation }\SpecialCharTok{\textasciitilde{}}\NormalTok{ IncomeLastYear, }\AttributeTok{data =}\NormalTok{ donationdata)}
\end{Highlighting}
\end{Shaded}

From this, we can

\begin{itemize}
\tightlist
\item
  Plot the relationship
\item
  Make specific predictions at different levels of income
\item
  Check accuracy by calculating the prediction errors and RMSE
\end{itemize}

\hypertarget{visualizing-the-results-1}{%
\subsection{Visualizing the results}\label{visualizing-the-results-1}}

Note that the correlation is a bit weaker here.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(}\AttributeTok{x=}\NormalTok{donationdata}\SpecialCharTok{$}\NormalTok{IncomeLastYear, }
     \AttributeTok{y=}\NormalTok{donationdata}\SpecialCharTok{$}\NormalTok{total\_donation,}
     \AttributeTok{ylab=} \StringTok{"Total Donation ($)"}\NormalTok{,}
     \AttributeTok{xlab =} \StringTok{"Income Last Year"}\NormalTok{,}
     \AttributeTok{main =} \StringTok{"Predicting Total Donations Using Income"}\NormalTok{)}
\FunctionTok{abline}\NormalTok{(fit, }\AttributeTok{col=}\StringTok{"green4"}\NormalTok{, }\AttributeTok{lwd=}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{08-Regression_files/figure-pdf/unnamed-chunk-20-1.pdf}

}

\end{figure}

\hypertarget{step-1-calculate-predictions}{%
\subsection{Step 1: Calculate
Predictions}\label{step-1-calculate-predictions}}

We can calculate predictions based on a level of income. Example: Level
5 of income represents an income of \$150k-250k. What level of donation
would we expect?

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{predict}\NormalTok{(fit, }\FunctionTok{data.frame}\NormalTok{(}\AttributeTok{IncomeLastYear =} \DecValTok{5}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       1 
348.8581 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# alternative using coef()}
\FunctionTok{coef}\NormalTok{(fit)[}\DecValTok{1}\NormalTok{] }\SpecialCharTok{+} \FunctionTok{coef}\NormalTok{(fit)[}\StringTok{"IncomeLastYear"}\NormalTok{]}\SpecialCharTok{*}\DecValTok{5}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
(Intercept) 
   348.8581 
\end{verbatim}

\hypertarget{step-2-check-accuracy}{%
\subsection{Step 2: Check Accuracy}\label{step-2-check-accuracy}}

We can calculate the Root Mean Squared Error

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sqrt}\NormalTok{(}\FunctionTok{mean}\NormalTok{(fit}\SpecialCharTok{$}\NormalTok{residuals}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 914.5273
\end{verbatim}

\hypertarget{step-3-iterate}{%
\subsection{Step 3: Iterate}\label{step-3-iterate}}

YOUR TURN: Change the model and see if it improves the prediction using
RMSE using \texttt{sqrt(mean(fit\$residuals\^{}2))}.

\hypertarget{adding-model-predictors}{%
\subsection{Adding Model Predictors}\label{adding-model-predictors}}

New Model Example

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fitnew }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(total\_donation }\SpecialCharTok{\textasciitilde{}}\NormalTok{ IncomeLastYear }\SpecialCharTok{+}\NormalTok{ NetWorth }\SpecialCharTok{+}\NormalTok{ sameparty, }
             \AttributeTok{data=}\NormalTok{donationdata)}
\end{Highlighting}
\end{Shaded}

New Predictions: note how we add more variables

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{predict}\NormalTok{(fitnew, }\FunctionTok{data.frame}\NormalTok{(}\AttributeTok{IncomeLastYear =} \DecValTok{5}\NormalTok{, }\AttributeTok{NetWorth =} \DecValTok{4}\NormalTok{, }\AttributeTok{sameparty =} \DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       1 
406.9705 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# alternative using coef()}
\FunctionTok{coef}\NormalTok{(fitnew)[}\DecValTok{1}\NormalTok{] }\SpecialCharTok{+} \FunctionTok{coef}\NormalTok{(fitnew)[}\StringTok{"IncomeLastYear"}\NormalTok{]}\SpecialCharTok{*}\DecValTok{5} \SpecialCharTok{+} 
  \FunctionTok{coef}\NormalTok{(fitnew)[}\StringTok{"NetWorth"}\NormalTok{]}\SpecialCharTok{*}\DecValTok{4} \SpecialCharTok{+} \FunctionTok{coef}\NormalTok{(fitnew)[}\StringTok{"sameparty"}\NormalTok{]}\SpecialCharTok{*}\DecValTok{1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
(Intercept) 
   406.9705 
\end{verbatim}

Root Mean Squared Error

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sqrt}\NormalTok{(}\FunctionTok{mean}\NormalTok{(fitnew}\SpecialCharTok{$}\NormalTok{residuals}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 908.9817
\end{verbatim}

When we have multiple predictors, this changes our interpretation of the
coefficients slightly.

\begin{itemize}
\tightlist
\item
  We now interpret the slope as the change in the outcome expected with
  a 1-unit change in the independent variable-- holding all other
  variables constant (or ``controlling'' for all other variables)
\item
  For example, for a 1-unit change in Income, we would expect about a
  \$68 increase in estimated donations, holding constant Net Worth and
  whether the person shared partisanship with the senator.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{coef}\NormalTok{(fitnew)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
   (Intercept) IncomeLastYear       NetWorth      sameparty 
    -242.02780       67.96825       29.55847      190.92323 
\end{verbatim}

Think of this like a set of light switches. How does adjusting one light
switch affect the light in the room-- holding constant all other
switches.

\includegraphics[width=0.6\textwidth,height=\textheight]{images/lightswitch.jpeg}

When we make predictions with multiple variables, we have to tell R
where we want to set each variable's value.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{predict}\NormalTok{(fitnew, }\FunctionTok{data.frame}\NormalTok{(}\AttributeTok{IncomeLastYear =} \DecValTok{5}\NormalTok{, }\AttributeTok{NetWorth =} \DecValTok{4}\NormalTok{, }\AttributeTok{sameparty =} \DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       1 
406.9705 
\end{verbatim}

See how the prediction changes if you shift \texttt{IncomeLastYear} but
keep Net Worth and partisanship where they are. That's the idea of
``controlling'' for the other variables!

How could we keep improving the predictions?

Eventually, we would want to apply this prediction model in a real-world
setting.

\begin{itemize}
\tightlist
\item
  How could campaigns use these types of prediction models?
\end{itemize}

\hypertarget{uncertainty-with-prediction}{%
\section{Uncertainty with
Prediction}\label{uncertainty-with-prediction}}

Regression (and other prediction algorithms) give us our best guess

\begin{itemize}
\tightlist
\item
  But any guess has some uncertainty, prediction error, and potential
  outliers
\item
  Sometimes these errors can be systematic
\item
  Even when we use more advanced statistical models
\item
  A ``best guess'' is often better than a random guess-- but shouldn't
  necessarily be treated as ``ground truth.''
\end{itemize}

Prediction helps us guess unknowns with observed data, but MUST PROCEED
WITH CAUTION

\hypertarget{example-butterfly-ballot-in-florida}{%
\subsection{Example: Butterfly Ballot in
Florida}\label{example-butterfly-ballot-in-florida}}

In the U.S. 2000 presidential election, the race came down to Florida,
which was extremely close. As part of the contest, different counties in
Florida came under a microscope. One result that seemed unusual was the
amount of votes Buchanan received in certain areas, which seemed to be a
result of an odd ballot design choice. In this exercise, we examine
voting patterns in Florida during the 2000 election.

\includegraphics{images/chad.jpg}

For more on the 2000 race, you can watch this
\href{https://www.youtube.com/watch?v=D-nR_hmS6V0\&ab_channel=HISTORY}{video}.

Load the data and explore the variables

\begin{itemize}
\tightlist
\item
  \texttt{county}: county name
\item
  \texttt{Clinton96}: Clinton's votes in 1996
\item
  \texttt{Dole96}: Dole's votes in 1996
\item
  \texttt{Perot96}: Perot's votes in 1996
\item
  \texttt{Bush00}: Bush's votes in 2000
\item
  \texttt{Gore00}: Gore's votes in 2000
\item
  \texttt{Buchanan00}: Buchanan's votes in 2000
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{florida }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"florida.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Chapter 4 in QSS also discusses this example.

Using what you learned from the last section, try to complete the
following steps:

\begin{itemize}
\tightlist
\item
  Regress Buchanan 2000 votes (your Y) on Perot 1996 (your X) votes
\item
  Create a scatterplot of the two variables and add the regression line
\item
  Find and interpret the slope coefficient for the relationship between
  Perot and Buchanan votes
\item
  Calculate the root-mean-squared error for the regression and interpret
  this
\end{itemize}

Try on your own, then expand for the solution.

For every 1 additional vote Perot received in 1996, we expect Buchanan
to receive .036 additional votes in 2000.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(Buchanan00 }\SpecialCharTok{\textasciitilde{}}\NormalTok{ Perot96, }\AttributeTok{data =}\NormalTok{ florida)}
\FunctionTok{coef}\NormalTok{(fit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
(Intercept)     Perot96 
 1.34575212  0.03591504 
\end{verbatim}

In 1996, Perot received 8 million votes as a third-party candidate.
Buchanan received less than 1/2 a million. Overall Perot received more
votes, but where Perot received votes in 1996 was positively correlated
with where Buchanan received votes in 2000.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(}\AttributeTok{x=}\NormalTok{florida}\SpecialCharTok{$}\NormalTok{Perot96,}
     \AttributeTok{y=}\NormalTok{florida}\SpecialCharTok{$}\NormalTok{Buchanan00,}
     \AttributeTok{ylab=}\StringTok{"Buchanan Votes 2000"}\NormalTok{,}
     \AttributeTok{xlab=}\StringTok{"Perot Votes 1996"}\NormalTok{,  }
     \AttributeTok{pch=}\DecValTok{20}\NormalTok{)}
\FunctionTok{abline}\NormalTok{(fit, }\AttributeTok{lwd=}\DecValTok{3}\NormalTok{, }\AttributeTok{col=}\StringTok{"purple"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{08-Regression_files/figure-pdf/unnamed-chunk-31-1.pdf}

}

\end{figure}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sqrt}\NormalTok{(}\FunctionTok{mean}\NormalTok{(fit}\SpecialCharTok{$}\NormalTok{residuals}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 311.6187
\end{verbatim}

A typical prediction error is about 316.4 votes above or below the
Buchanan total.

\hypertarget{multiple-predictors}{%
\subsection{Multiple Predictors}\label{multiple-predictors}}

Can we reduce the error by adding more variables?

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fitnew }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(Buchanan00 }\SpecialCharTok{\textasciitilde{}}\NormalTok{ Perot96 }\SpecialCharTok{+}\NormalTok{ Dole96 }\SpecialCharTok{+}\NormalTok{ Clinton96, }\AttributeTok{data =}\NormalTok{ florida)}
\FunctionTok{coef}\NormalTok{(fitnew)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
 (Intercept)      Perot96       Dole96    Clinton96 
20.572650070  0.030663207 -0.001559196  0.001865809 
\end{verbatim}

Again, when we have multiple predictors, this changes our interpretation
of the coefficients slightly.

\begin{itemize}
\tightlist
\item
  We now interpret the slope as the change in the outcome expected with
  a 1-unit change in the independent variable-- holding all other
  variables constant (or ``controlling'' for all other variables)
\item
  For example, a 1-unit increase (a 1-vote increase) in the number of
  Perot voters in 1996 is associated with a 0.03 vote increase in the
  number of Buchanan votes in 2000, holding constant the number of
  Clinton and Dole votes a county received.
\end{itemize}

When we make predictions with multiple variables, we have to tell R
where we want to set each variable's value.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{predict}\NormalTok{(fitnew, }\FunctionTok{data.frame}\NormalTok{(}\AttributeTok{Perot96=}\DecValTok{20000}\NormalTok{, }\AttributeTok{Clinton96=}\DecValTok{300000}\NormalTok{, }\AttributeTok{Dole96=}\DecValTok{300000}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       1 
725.8208 
\end{verbatim}

See how the prediction changes if you shift \texttt{Perot96} but keep
the other variables where they are. That's the idea of ``controlling''
for the other variables!

The addition of the new variables, in this case, made very little
difference in the RMSE.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sqrt}\NormalTok{(}\FunctionTok{mean}\NormalTok{(fit}\SpecialCharTok{$}\NormalTok{residuals}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 311.6187
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sqrt}\NormalTok{(}\FunctionTok{mean}\NormalTok{(fitnew}\SpecialCharTok{$}\NormalTok{residuals}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 308.7296
\end{verbatim}

With little change from the addition of predictors, let's stick with the
more simple model and explore the prediction errors.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(}\AttributeTok{x=}\FunctionTok{fitted}\NormalTok{(fit), }\CommentTok{\# predicted outcome}
     \AttributeTok{y=}\FunctionTok{resid}\NormalTok{(fit),  }\CommentTok{\# prediction error}
     \AttributeTok{type=}\StringTok{"n"}\NormalTok{, }\CommentTok{\# makes the plot blank}
     \AttributeTok{xlim =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{1500}\NormalTok{), }
     \AttributeTok{ylim =} \FunctionTok{c}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{750}\NormalTok{, }\DecValTok{2500}\NormalTok{), }
     \AttributeTok{xlab =} \StringTok{"Predicted Buchanan Votes"}\NormalTok{, }
     \AttributeTok{ylab =} \StringTok{"Prediction Error"}\NormalTok{)}
\FunctionTok{abline}\NormalTok{(}\AttributeTok{h =} \DecValTok{0}\NormalTok{) }\CommentTok{\# adds horizontal line}
\FunctionTok{text}\NormalTok{(}\AttributeTok{x=}\FunctionTok{fitted}\NormalTok{(fit), }\AttributeTok{y=}\FunctionTok{resid}\NormalTok{(fit), }\AttributeTok{labels =}\NormalTok{ florida}\SpecialCharTok{$}\NormalTok{county, }\AttributeTok{cex=}\NormalTok{.}\DecValTok{8}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{figure}[H]

{\centering \includegraphics{08-Regression_files/figure-pdf/unnamed-chunk-36-1.pdf}

}

\end{figure}

How does the prediction error change if we remove Palm Beach County?

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{florida.pb }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(florida, }\AttributeTok{subset =}\NormalTok{ (county }\SpecialCharTok{!=} \StringTok{"PalmBeach"}\NormalTok{))}
\NormalTok{fit2 }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(Buchanan00 }\SpecialCharTok{\textasciitilde{}}\NormalTok{ Perot96, }\AttributeTok{data =}\NormalTok{ florida.pb)}
\FunctionTok{sqrt}\NormalTok{(}\FunctionTok{mean}\NormalTok{(fit2}\SpecialCharTok{$}\NormalTok{residuals}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 86.41017
\end{verbatim}

My, oh my, our RMSE also goes way down if we remove Palm Beach.
Something unique seems to be happening in that county. See this
\href{http://sekhon.berkeley.edu/papers/butterfly.pdf}{academic paper}
for an elaboration of the evidence that ``The Butterfly {[}ballot{]} Did
it.''

\hypertarget{confidence-intervals}{%
\subsection{Confidence Intervals}\label{confidence-intervals}}

Social scientists like to characterize the uncertainty in their
predictions using what is called a ``confidence interval.''

\begin{itemize}
\tightlist
\item
  Confidence intervals show a range of values that are likely to contain
  the true value
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{predict}\NormalTok{(fit, }\FunctionTok{data.frame}\NormalTok{(}\AttributeTok{Perot96 =} \DecValTok{13600}\NormalTok{), }\AttributeTok{interval =} \StringTok{"confidence"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       fit      lwr      upr
1 489.7903 394.8363 584.7443
\end{verbatim}

By default, R supplies the 95\% confidence interval.

\begin{itemize}
\tightlist
\item
  For example, our estimate is for a county with 13,600 votes for Perot
  in 1996, the expected Buchanan vote is 489.79 votes.

  \begin{itemize}
  \tightlist
  \item
    The confidence interval is 394.84 to 584.74 votes, which means we
    believe there is a 95\% chance that this interval contains the true
    value of the Buchanan 2000 vote share.
  \end{itemize}
\item
  Instead of thinking about our prediction as just 489.79, we should
  think about the entire interval as having a good chance of including
  the true value.
\end{itemize}

Similarly, our coefficients also have uncertainty.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{coef}\NormalTok{(fit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
(Intercept)     Perot96 
 1.34575212  0.03591504 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{confint}\NormalTok{(fit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
                   2.5 %       97.5 %
(Intercept) -98.03044506 100.72194929
Perot96       0.02724733   0.04458275
\end{verbatim}

For every 1 vote increase in the Perot 1996 vote, we expect a
\(\hat \beta =.036\) increase in Buchanan votes. However, the confidence
interval is 0.027 to 0.045.

\begin{itemize}
\tightlist
\item
  We think there is a 95\% chance that this interval 0.027 to 0.045
  includes the true \(\beta\), describing the rate of change in Buchanan
  votes for a given change in Perot 1996 votes
\end{itemize}

\hypertarget{cross-validation}{%
\section{Cross-Validation}\label{cross-validation}}

So far, we've been ``cheating.'' We've been analyzing a prediction in
cases where we know the right answer. Now we will focus more squarely on
how to develop an ``out-of-sample'' prediction.

Problem: Models that fit our existing (``in-sample'') data might not be
the best for predicting out-of-sample data.

Example: Compare regression line with vs.~without Palm Beach included in
the sample.

\begin{itemize}
\tightlist
\item
  Outliers ``in-sample'' can lead to overfitting to weird, idiosyncratic
  data points
\end{itemize}

\includegraphics{images/overfit.png}

Example: Error Rates in Speech Recognition. See study
\href{https://news.stanford.edu/2020/03/23/automated-speech-recognition-less-accurate-blacks/}{here}

\begin{itemize}
\tightlist
\item
  Predictions/Classification that works well for one group might not
  work well for all groups
\end{itemize}

\includegraphics{images/speecherrors.png}

Problem: Models that fit our existing (``in-sample'') data might not be
the best for predicting out-of-sample data. Approaches to diagnose the
problem or help address it:

\begin{itemize}
\tightlist
\item
  Detect potential outliers within existing data by exploring the
  prediction errors
\item
  Make sure the training (in-sample) data is as representative as
  possible
\item
  Incorporate out-of-sample testing in prediction process
\end{itemize}

\hypertarget{cross-validation-process}{%
\subsection{Cross-Validation Process}\label{cross-validation-process}}

Cross-validation incorporates the idea of out-of-sample testing into the
process of how we evaluate the accuracy of prediction and classification
approaches.

Cross-validation (train vs.~test data)

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Subset your data into two portions: Training and Test data.
\item
  Run a model based on the training data.
\item
  Make a prediction and test the accuracy on the test data.
\item
  Repeat process training and testing on different portions of the data.
\item
  Summarize the results and choose a preferred model

  \begin{itemize}
  \tightlist
  \item
    Eventually: Apply this model to entirely new data
  \end{itemize}
\end{enumerate}

Goal: Test accuracy in a way that can help detect overfitting. See how
well our model will generalize to new data (data the model hasn't seen).

\hypertarget{application-forecasting-election-results}{%
\subsection{Application: Forecasting Election
Results}\label{application-forecasting-election-results}}

Macro political and economic fundamentals are sometimes used for early
forecasting of an election. We will build a version of this model and
test its accuracy using a process of ``Leave-one-out'' cross-validation.

Below is a video explainer of this application, which uses
cross-validation.

\url{https://www.youtube.com/watch?v=Wqj9Jm8heAA}

The data and model are based on the
\href{Based\%20on\%20the\%20FAIR\%20model\%20for\%20forecasting\%20elections\%20/url\%7Bhttps://fairmodel.econ.yale.edu/vote2016/computev.htm\%7D}{FAIR
model} of forecasting.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fair }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"fair.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Key Variables:

\begin{itemize}
\tightlist
\item
  \texttt{VP}: Democratic share of the two-party presidential vote
\item
  \texttt{t}: Year (presidential years only)
\item
  \texttt{G}: growth rate of real per capita GDP in the first 3 quarters
\item
  \texttt{P}: growth rate of the GDP deflator in the first 15 quarters
  of the recent administration
\item
  \texttt{Z}: number of quarters in the first 15 quarters of recent
  administration in which the growth rate of real per capita GDP is
  greater than 3.2 percent at an annual rate
\item
  \texttt{I}: 1 if Democrats in WH and -1 if Republicans in WH
\item
  \texttt{WAR}: 1 if 1920, 1944, 1948 (denoting the ``WAR'' elections,
  which are believed to be particular)
\item
  \texttt{DUR}: indicating how many consecutive terms
  Democrats/Republicans have been office (e.g., in 2020 it will be 0
  because Republicans will have been in office for only 1 term.)
\end{itemize}

Let's propose a model

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(VP }\SpecialCharTok{\textasciitilde{}}\NormalTok{ DUR, }\AttributeTok{data =}\NormalTok{ fair)}
\end{Highlighting}
\end{Shaded}

Let's propose an alternative model and see which one we think is better.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit2 }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(VP }\SpecialCharTok{\textasciitilde{}}\NormalTok{ G}\SpecialCharTok{*}\NormalTok{I }\SpecialCharTok{+}\NormalTok{  DUR, }\AttributeTok{data =}\NormalTok{ fair)}
\end{Highlighting}
\end{Shaded}

Note: The asterisk represents an ``interaction.'' See QSS Chapter 4. We
use this when we think the effect of one variable (growth) may depend on
the values of another variable (the party of who is in office).

\hypertarget{steps-1-and-2}{%
\subsubsection{Steps 1 and 2}\label{steps-1-and-2}}

We are going to run a model where each time we `leave out' one row of
data (in our case, one election). Let's try this once:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{years }\OtherTok{\textless{}{-}}\NormalTok{ fair}\SpecialCharTok{$}\NormalTok{t}

\DocumentationTok{\#\# Step 1: Subset data into two portions}
\NormalTok{traindata }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(fair, t }\SpecialCharTok{!=}\NormalTok{ years[}\DecValTok{1}\NormalTok{])}
\NormalTok{testdata }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(fair, t }\SpecialCharTok{==}\NormalTok{ years[}\DecValTok{1}\NormalTok{])}

\DocumentationTok{\#\# Step 2: Run model on training data}
\NormalTok{fit }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(VP }\SpecialCharTok{\textasciitilde{}}\NormalTok{ DUR, }\AttributeTok{data =}\NormalTok{ traindata)}
\NormalTok{fit2 }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(VP }\SpecialCharTok{\textasciitilde{}}\NormalTok{  G}\SpecialCharTok{*}\NormalTok{I }\SpecialCharTok{+}\NormalTok{  DUR, }\AttributeTok{data =}\NormalTok{ traindata)}
\end{Highlighting}
\end{Shaded}

\hypertarget{step-3-predict-and-assess-accuracy-with-test-data}{%
\subsubsection{Step 3: Predict and assess accuracy with test
data}\label{step-3-predict-and-assess-accuracy-with-test-data}}

Out-of-Sample prediction

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Step 3: Make a Prediction using test data and}
\NormalTok{yhat.fit }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(fit, testdata)}
\NormalTok{yhat.fit2 }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(fit2, testdata)}
\end{Highlighting}
\end{Shaded}

Prediction error (Truth - Prediction)

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Step 3: Test accuracy of prediction}
\NormalTok{error.fit }\OtherTok{\textless{}{-}}\NormalTok{ testdata}\SpecialCharTok{$}\NormalTok{VP }\SpecialCharTok{{-}}\NormalTok{ yhat.fit}
\NormalTok{error.fit2 }\OtherTok{\textless{}{-}}\NormalTok{ testdata}\SpecialCharTok{$}\NormalTok{VP }\SpecialCharTok{{-}}\NormalTok{ yhat.fit2}
\end{Highlighting}
\end{Shaded}

\hypertarget{step-4-repeat-process-across-all-data}{%
\subsubsection{Step 4: Repeat process across all
data}\label{step-4-repeat-process-across-all-data}}

Step 4: Let's do this for each row, storing the prediction errors.

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Iteration vector}
\NormalTok{years }\OtherTok{\textless{}{-}}\NormalTok{ fair}\SpecialCharTok{$}\NormalTok{t}
\DocumentationTok{\#\# Empty container vectors}
\NormalTok{errors.fit }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\ConstantTok{NA}\NormalTok{, }\FunctionTok{length}\NormalTok{(years))}
\NormalTok{errors.fit2 }\OtherTok{\textless{}{-}} \FunctionTok{rep}\NormalTok{(}\ConstantTok{NA}\NormalTok{, }\FunctionTok{length}\NormalTok{(years))}

\DocumentationTok{\#\# Loop (copy paste meat from  above)}
\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in}  \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(years))\{}
\NormalTok{  traindata }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(fair, t }\SpecialCharTok{!=}\NormalTok{ years[i])}
\NormalTok{  testdata }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(fair, t }\SpecialCharTok{==}\NormalTok{ years[i])}
\NormalTok{  fit }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(VP }\SpecialCharTok{\textasciitilde{}}\NormalTok{  DUR, }\AttributeTok{data =}\NormalTok{ traindata)}
\NormalTok{  fit2 }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(VP }\SpecialCharTok{\textasciitilde{}}\NormalTok{ G}\SpecialCharTok{*}\NormalTok{I }\SpecialCharTok{+}\NormalTok{  DUR , }\AttributeTok{data =}\NormalTok{ traindata)}
\NormalTok{  yhat.fit }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(fit, testdata)}
\NormalTok{  yhat.fit2 }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(fit2, testdata)}
\NormalTok{  errors.fit[i] }\OtherTok{\textless{}{-}}\NormalTok{ testdata}\SpecialCharTok{$}\NormalTok{VP }\SpecialCharTok{{-}}\NormalTok{ yhat.fit}
\NormalTok{  errors.fit2[i] }\OtherTok{\textless{}{-}}\NormalTok{ testdata}\SpecialCharTok{$}\NormalTok{VP }\SpecialCharTok{{-}}\NormalTok{ yhat.fit2}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{step-5-summarize-performance}{%
\subsubsection{Step 5: Summarize
performance}\label{step-5-summarize-performance}}

Step 5: Summarize the model performance

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# RMSE}
\FunctionTok{sqrt}\NormalTok{(}\FunctionTok{mean}\NormalTok{((errors.fit)}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 7.170149
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sqrt}\NormalTok{(}\FunctionTok{mean}\NormalTok{((errors.fit2)}\SpecialCharTok{\^{}}\DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 3.793135
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Mean Absolute Error}
\FunctionTok{mean}\NormalTok{(}\FunctionTok{abs}\NormalTok{(errors.fit))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 5.937542
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(}\FunctionTok{abs}\NormalTok{(errors.fit2))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 3.363163
\end{verbatim}

Which model tends to have less error?

\hypertarget{applying-model-to-new-data}{%
\subsubsection{Applying Model to New
Data}\label{applying-model-to-new-data}}

Eventually, you might further test the model on data that has been
``held out''-- data that neither your train/test has seen. How good was
our model? We can do this for the 2016 election, which was not in the
data.

Truth: 2016 VP was 51.1 Democratic ``two-party'' vote share.

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Let\textquotesingle{}s use the winner of our two models}
\NormalTok{fit2 }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(VP }\SpecialCharTok{\textasciitilde{}}\NormalTok{ G}\SpecialCharTok{*}\NormalTok{I }\SpecialCharTok{+}\NormalTok{  DUR, }\AttributeTok{data =}\NormalTok{ fair)}
\FloatTok{51.1}\SpecialCharTok{{-}}\FunctionTok{predict}\NormalTok{(fit2, }\FunctionTok{data.frame}\NormalTok{(}\AttributeTok{G=}\FloatTok{0.97}\NormalTok{, }\AttributeTok{I=}\DecValTok{1}\NormalTok{, }\AttributeTok{DUR=}\DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       1 
2.472147 
\end{verbatim}

2016 values based on the FAIR
\href{https://fairmodel.econ.yale.edu/vote2016/index2.htm}{site}

\hypertarget{challenge}{%
\subsubsection{Challenge}\label{challenge}}

Can you build a better model? What would your prediction for 2020 have
been?

\begin{itemize}
\tightlist
\item
  -5.07: growth rate of real per capita GDP in the first 3 quarters of
  2020 (annual rate) (G)
\item
  1.80: growth rate of the GDP deflator in the first 15 quarters of the
  Trump administration, (annual rate) (P)
\item
  3: number of quarters in the first 15 quarters of the Trump
  administration in which the growth rate of real per capita GDP is
  greater than 3.2 percent at an annual rate (Z)
\item
  DUR=0
\item
  I = -1
\end{itemize}

Values based on the FAIR
\href{https://fairmodel.econ.yale.edu/vote2020/computev.htm}{site}

\bookmarksetup{startatroot}

\hypertarget{fairness}{%
\chapter{Fairness and Ethics}\label{fairness}}

In this section, we dicuss some issues with fairness in
prediction/classification, as well as broader ethical issues confronting
the intersection of data science and social science.

\textbf{\emph{Fairness in Machine Learning}}

Machine learning comes with a bundle of potential ethical issues. Hold
on-- we are doing machine learning? Yes, in our
prediction/classification sections, we have done a type of it.

\begin{itemize}
\tightlist
\item
  We have used a statistical model (in this case, regression) to learn
  and make inferences about patterns in data.

  \begin{itemize}
  \tightlist
  \item
    A regression can be considered a type of algorithm
  \end{itemize}
\item
  We then apply the model to new data to make predictions and classify
  new data into categories.
\item
  The models we have used are a type of ``supervised machine learning''
  because our outcomes are pre-defined (vote share for Biden, a person
  donates vs.~does not donate)

  \begin{itemize}
  \tightlist
  \item
    Other types of machine learning may be fully ``unsupervised,'' such
    as searching data to come up with outputs, such as topics in books
    of text
  \end{itemize}
\end{itemize}

\hypertarget{application-criminal-justice}{%
\section{Application: Criminal
Justice}\label{application-criminal-justice}}

This application is based on Dressel, Julia, and Hany Farid.
``\href{https://www.science.org/doi/10.1126/sciadv.aao5580}{The
accuracy, fairness, and limits of predicting recidivism}.'' Science
advances 4.1 (2018): eaao5580.

Prediction and classification models are used all of the time in public
policy, including in the criminal justice system: ``where crimes will
most likely occur, who is most likely to commit a violent crime, who is
likely to fail to appear at their court hearing, and who is likely to
reoffend at some point in the future'' (Dressel and Farid)

Dressel and Farid develop and examine models that predict whether
someone will recidivate-- based on a measure of rearrest. They compare
their own models to COMPAS (a well-known proprietary algorithm that
generates risk scores) and to human-based predictions

We will develop a model similar to the one Dressel and Farid use in
their paper, which seems to closely approximate COMPAS predictions.

Note: These algorithms have generated a lot of debate, concern and
controversy, which we will discuss.

\hypertarget{load-data}{%
\subsection{Load data}\label{load-data}}

Below is a video explainer of this application, which uses
classification and cross-validation.

\url{https://www.youtube.com/watch?v=vpNnUR0V1hA}

Data include information about 7214 arrests in Broward County Florida in
2013-2014

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{broward }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"browardsub.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Variables

\begin{itemize}
\tightlist
\item
  \texttt{sex}: 0 male; 1: female
\item
  \texttt{age}
\item
  \texttt{juv\_fel\_count}: total number of juvenile felony criminal
  charges
\item
  \texttt{juv\_\ misd\_count}: total number of juvenile misdemeanor
  criminal charges
\item
  \texttt{priors\_count}: total number of non-juvenile criminal charges
\item
  \texttt{charge\_degree}: a numeric indicator of the degree of the
  charge: 0: misdemeanor; 1: felony
\item
  \texttt{two\_year\_recid}: a numeric indicator of whether the
  defendant recidivated two years after previous charge: 0: no, did not
  recidivate; 1: yes, did recidivate
\end{itemize}

\hypertarget{predictionclassification-process}{%
\subsection{Prediction/Classification
process}\label{predictionclassification-process}}

Recall the steps for prediction/classification

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Choose Approach

  \begin{itemize}
  \tightlist
  \item
    We will use a regression to try to classify subjects as those who
    will / will not recidivate
  \end{itemize}
\item
  Check accuracy

  \begin{itemize}
  \tightlist
  \item
    We will calculate false positive rates and false negative rates
  \item
    We will use cross-validation to do so
  \end{itemize}
\item
  Iterate
\end{enumerate}

\hypertarget{step-1-regression-model}{%
\subsection{Step 1: Regression Model}\label{step-1-regression-model}}

Step 1: Choose Approach

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(two\_year\_recid }\SpecialCharTok{\textasciitilde{}}\NormalTok{ age }\SpecialCharTok{+}\NormalTok{ sex }\SpecialCharTok{+}\NormalTok{ juv\_misd\_count }\SpecialCharTok{+}\NormalTok{ juv\_fel\_count }\SpecialCharTok{+} 
\NormalTok{            priors\_count }\SpecialCharTok{+}\NormalTok{ charge\_degree, }
          \AttributeTok{data =}\NormalTok{ broward)}
\end{Highlighting}
\end{Shaded}

Note: our outcome is binary

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(broward}\SpecialCharTok{$}\NormalTok{two\_year\_recid)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}

   0    1 
3963 3251 
\end{verbatim}

When you use linear regression with a binary outcome, it is called a
linear probability model. We estimate the probability of recidivism-- a
number between 0 and 1.

\begin{itemize}
\tightlist
\item
  There are downsides to using linear regression with this type of
  outcome. Data scientists may often use a different model called
  logistic regression for this.
\end{itemize}

Make Prediction.

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# estimates a predicted probability of recidivism for each subject}
\NormalTok{broward}\SpecialCharTok{$}\NormalTok{predictedrec }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(fit)}

\DocumentationTok{\#\# Range of predicted probabilities}
\FunctionTok{range}\NormalTok{(broward}\SpecialCharTok{$}\NormalTok{predictedrec)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] -0.1463835  1.6059606
\end{verbatim}

Note: One downside of linear models is they can generate probabilities
below 0 or above 1. Logistic regression will constrain these due to a
transformation it makes when estimating the coefficients.

\hypertarget{detour-logistic-regression}{%
\subsubsection{Detour: Logistic
Regression}\label{detour-logistic-regression}}

As an alternative, you could use logistic regression, which data
scientists may often use when trying to do a classification task--
predicting which category a subject belongs to (e.g., recidivate vs.~not
recidivate; turned out to vote vs.~did not turn out to vote). We won't
focus on logistic regression in this class, but you can know it is out
there for future study.

Step 1: Choose Approach- Let's try logistic regression instead

For details, expand.

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Logistic regression}
\NormalTok{fitl }\OtherTok{\textless{}{-}} \FunctionTok{glm}\NormalTok{(two\_year\_recid }\SpecialCharTok{\textasciitilde{}}\NormalTok{ age }\SpecialCharTok{+}\NormalTok{ sex }\SpecialCharTok{+}\NormalTok{ juv\_misd\_count }\SpecialCharTok{+}\NormalTok{ juv\_fel\_count }\SpecialCharTok{+} 
\NormalTok{            priors\_count }\SpecialCharTok{+}\NormalTok{ charge\_degree, }
          \AttributeTok{data =}\NormalTok{ broward, }
          \AttributeTok{family=}\FunctionTok{binomial}\NormalTok{(}\AttributeTok{link =} \StringTok{"logit"}\NormalTok{))}

\DocumentationTok{\#\# estimates a predicted probability of recidivism for each subject}
\NormalTok{broward}\SpecialCharTok{$}\NormalTok{predictedrecl }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(fitl, }\AttributeTok{type=}\StringTok{"response"}\NormalTok{) }\CommentTok{\# need type="response" to make them probabilities}

\DocumentationTok{\#\# Range of predicted probabilities of recidivism}
\FunctionTok{range}\NormalTok{(broward}\SpecialCharTok{$}\NormalTok{predictedrecl)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0.04176846 0.99891808
\end{verbatim}

Logistic regression keeps probabilities between 0 and 1 due to a
transformation it applies to our standard regression formula. As a
result, our coefficient units (\texttt{coef(fitl)}) are in log-odds
units, which are hard to interpret. We can transform our predictions of
the model into probabilities using the \texttt{predict()} function with
\texttt{type\ =\ "response"}.

We can compare the predictions of the probability of recidivism between
the linear and logistic regression models. Note how the linear model
blows past 0 and 1, while the logistic-based predictions can keep them
within those bounds.

\includegraphics{09-Fairness_files/figure-pdf/unnamed-chunk-7-1.pdf}

We don't have time to go into the math of logistic regression in this
course, but know that it is a desirable option for classification.

For now, let's stick with the linear model.

\hypertarget{change-prediction-into-a-classification}{%
\subsubsection{Change Prediction into a
Classification}\label{change-prediction-into-a-classification}}

Recall: we are trying to \textbf{classify}

\begin{itemize}
\tightlist
\item
  We need to make our estimates of the probability of recidivism
  categorical, into simply a prediction of recidivate vs.~not recidivate
\end{itemize}

For now, we will use .5 as a threshold (a probability of more than .5)

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Need to make prediction binary.}
\CommentTok{\# We use .5, but there are other methods for choosing this threshold}
\NormalTok{broward}\SpecialCharTok{$}\NormalTok{predictedrecclass }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(broward}\SpecialCharTok{$}\NormalTok{predictedrec }\SpecialCharTok{\textgreater{}}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Predicted Recidivism

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(}\AttributeTok{predicted=}\NormalTok{broward}\SpecialCharTok{$}\NormalTok{predictedrecclass)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
predicted
   0    1 
4683 2531 
\end{verbatim}

\hypertarget{step-2-check-accuracy-1}{%
\subsection{Step 2: Check Accuracy}\label{step-2-check-accuracy-1}}

We are going to get extra practice with cross-validation as a way to
check accuracy. Recall:

Cross-validation (train vs.~test data)

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Subset your data into two portions: Training and Test data.
\item
  Run a model based on the training data.
\item
  Make a prediction and test the accuracy on the test data.
\item
  Repeat process training and testing on different portions of the data.
\item
  Summarize the results and choose a preferred model

  \begin{itemize}
  \tightlist
  \item
    Eventually: Apply this model to entirely new data
  \end{itemize}
\end{enumerate}

Goal: Test accuracy in a way that can help detect overfitting. See how
well our model will generalize to new data (data the model hasn't seen).

We will use leave-one-out cross-validation again, but there are other
methods, such as splitting data into ``folds'' of multiple observations
at once (i.e., leaving out 100 or 1000 observations for testing instead
of just 1).

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Step 1: Subset Data}
\NormalTok{traindata }\OtherTok{\textless{}{-}}\NormalTok{ broward[}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{,] }\CommentTok{\# all but first row}
\NormalTok{testdata }\OtherTok{\textless{}{-}}\NormalTok{ broward[}\DecValTok{1}\NormalTok{,] }\CommentTok{\# just the first row}

\DocumentationTok{\#\# Step 2: Run model on training data}
\NormalTok{fittrain }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(two\_year\_recid }\SpecialCharTok{\textasciitilde{}}\NormalTok{ age }\SpecialCharTok{+}\NormalTok{ sex }\SpecialCharTok{+}\NormalTok{ juv\_misd\_count }
               \SpecialCharTok{+}\NormalTok{ juv\_fel\_count }\SpecialCharTok{+} 
\NormalTok{            priors\_count }\SpecialCharTok{+}\NormalTok{ charge\_degree, }
          \AttributeTok{data =}\NormalTok{ traindata)}

\DocumentationTok{\#\# Step 3: Predict with test data}
\NormalTok{predictedrec }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(fittrain, testdata)}

\DocumentationTok{\#\# Step 3: Change predicted probability into a classification}
\NormalTok{cvpredictions }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(predictedrec }\SpecialCharTok{\textgreater{}}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Step 4: Repeat across all observations and summarize accuracy.

We want to repeat this process for every row of our data-- leaving out a
different row each time. To construct our loop, we embed the above
process in the loop syntax.

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Iteration vector}
\DocumentationTok{\#\# 1:nrow(broward)}

\DocumentationTok{\#\# Container vector}
\NormalTok{broward}\SpecialCharTok{$}\NormalTok{cvpredictions }\OtherTok{\textless{}{-}} \ConstantTok{NA}

\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{nrow}\NormalTok{(broward))\{}
  \DocumentationTok{\#\# Step 1: Subset Data}
\NormalTok{  traindata }\OtherTok{\textless{}{-}}\NormalTok{ broward[}\SpecialCharTok{{-}}\NormalTok{i,] }\CommentTok{\# all but ith row}
\NormalTok{  testdata }\OtherTok{\textless{}{-}}\NormalTok{ broward[i,] }\CommentTok{\# just the ith row}
  
  \DocumentationTok{\#\# Step 2: Run model on training data}
\NormalTok{  fittrain }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(two\_year\_recid }\SpecialCharTok{\textasciitilde{}}\NormalTok{ age }\SpecialCharTok{+}\NormalTok{ sex }\SpecialCharTok{+}\NormalTok{ juv\_misd\_count }
                 \SpecialCharTok{+}\NormalTok{ juv\_fel\_count }\SpecialCharTok{+} 
\NormalTok{            priors\_count }\SpecialCharTok{+}\NormalTok{ charge\_degree, }
          \AttributeTok{data =}\NormalTok{ traindata)}
  
  \DocumentationTok{\#\# Step 3: Predict with test data}
\NormalTok{  predictedrec }\OtherTok{\textless{}{-}} \FunctionTok{predict}\NormalTok{(fittrain, testdata)}
\NormalTok{  broward}\SpecialCharTok{$}\NormalTok{cvpredictions[i] }\OtherTok{\textless{}{-}} \FunctionTok{ifelse}\NormalTok{(predictedrec }\SpecialCharTok{\textgreater{}}\NormalTok{ .}\DecValTok{5}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\hypertarget{confusion-matrix}{%
\subsubsection{Confusion Matrix}\label{confusion-matrix}}

Check Accuracy: Confusion Matrix

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{confmatrix }\OtherTok{\textless{}{-}} \FunctionTok{table}\NormalTok{(}\AttributeTok{actual =}\NormalTok{ broward}\SpecialCharTok{$}\NormalTok{two\_year\_recid, }
                    \AttributeTok{predicted =}\NormalTok{ broward}\SpecialCharTok{$}\NormalTok{cvpredictions)}
\NormalTok{confmatrix}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
      predicted
actual    0    1
     0 3156  807
     1 1528 1723
\end{verbatim}

How should we interpret each cell?

\begin{itemize}
\tightlist
\item
  Let's Consider 1 = Recidivate = Positive outcome; 0 = Not Recidivate =
  Negative Outcome
\item
  What is a false positive? false negative? true positive? true
  negative?
\end{itemize}

\hypertarget{false-positive-rate}{%
\subsubsection{False Positive Rate}\label{false-positive-rate}}

False Positive Rate:
\(\frac{\text{False Positive}}{\text{(False Positive + True Negative)}}\)

\begin{itemize}
\tightlist
\item
  Out of those who do not recidivate, how often did we predict
  recidivate?
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# One Approach}
\FunctionTok{sum}\NormalTok{(broward}\SpecialCharTok{$}\NormalTok{cvpredictions }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ broward}\SpecialCharTok{$}\NormalTok{two\_year\_recid }\SpecialCharTok{==} \DecValTok{0}\NormalTok{) }\SpecialCharTok{/} 
  \FunctionTok{sum}\NormalTok{(broward}\SpecialCharTok{$}\NormalTok{two\_year\_recid }\SpecialCharTok{==} \DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0.2036336
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Alternative Approach}
\DocumentationTok{\#\# predicted recidivism, actual not}
\NormalTok{fp }\OtherTok{\textless{}{-}}\NormalTok{ confmatrix[}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{]}
\CommentTok{\# predicted not, actual not}
\NormalTok{tn }\OtherTok{\textless{}{-}}\NormalTok{ confmatrix[}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{]}

\DocumentationTok{\#\# False Positive Rate}
\NormalTok{fp }\SpecialCharTok{/}\NormalTok{ (fp }\SpecialCharTok{+}\NormalTok{ tn)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0.2036336
\end{verbatim}

\hypertarget{false-negative-rate}{%
\subsubsection{False Negative Rate}\label{false-negative-rate}}

False Negative Rate:
\(\frac{\text{False Negative}}{\text{(False Negative + True Positive)}}\)

\begin{itemize}
\tightlist
\item
  Out of those who did recidivate, how often did we predict not
  recidivate?
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Out of those who recidivate, how often does it predict not recidivate?}
\FunctionTok{sum}\NormalTok{(broward}\SpecialCharTok{$}\NormalTok{cvpredictions}\SpecialCharTok{==} \DecValTok{0} \SpecialCharTok{\&}\NormalTok{ broward}\SpecialCharTok{$}\NormalTok{two\_year\_recid }\SpecialCharTok{==} \DecValTok{1}\NormalTok{) }\SpecialCharTok{/} 
  \FunctionTok{sum}\NormalTok{(broward}\SpecialCharTok{$}\NormalTok{two\_year\_recid }\SpecialCharTok{==} \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0.4700092
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Alternative Approach}
\DocumentationTok{\#\#  predicted to not recidivate, actual yes}
\NormalTok{fn }\OtherTok{\textless{}{-}}\NormalTok{ confmatrix[}\DecValTok{2}\NormalTok{, }\DecValTok{1}\NormalTok{]}
\NormalTok{tp }\OtherTok{\textless{}{-}}\NormalTok{ confmatrix[}\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{]}

\DocumentationTok{\#\# False Negative Rate}
\NormalTok{fn }\SpecialCharTok{/}\NormalTok{ (fn }\SpecialCharTok{+}\NormalTok{ tp)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0.4700092
\end{verbatim}

\hypertarget{taking-fairness-seriously}{%
\section{Taking Fairness Seriously}\label{taking-fairness-seriously}}

Recall the steps for prediction/classification

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Choose Approach

  \begin{itemize}
  \tightlist
  \item
    We will use a regression to try to classify subjects as those who
    will / will not recidivate
  \end{itemize}
\item
  Check accuracy

  \begin{itemize}
  \tightlist
  \item
    We will calculate false positive rates and false negative rates
  \item
    We will use cross-validation to do so
  \item
    \textbf{\emph{What about fairness?}}
  \end{itemize}
\item
  Iterate
\end{enumerate}

The performance of a prediction/classification may be different for
different groups in the population. Dressel and Farid point to this when
it comes to different racial groups.

\begin{figure}

{\centering \includegraphics{images/fair1.png}

}

\caption{\emph{Dressel and Farid}}

\end{figure}

Let's see how our predictions perform across racial groups

\texttt{race}: 1: White (Caucasian); 2: Black (African American); 3:
Hispanic; 4: Asian; 5: Native American; 6: Other

Wait a second-- we didn't use race in our model. Why could the
performance still differ across racial groups?

\begin{itemize}
\tightlist
\item
  Think about how the inputs in our regression model could be correlated
  with race.
\item
  Think about how existing human biases and inequalities that lead to
  differential arrest rates by racial groups could be reproduced in our
  model.
\item
  Even if a model does not have the intent to include race, its impact
  may nonetheless vary according to race. This could be true for any
  number of characteristics depending on the application.
\end{itemize}

We will subset our data by race.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{black }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(broward, race }\SpecialCharTok{==} \DecValTok{2}\NormalTok{)}
\NormalTok{white }\OtherTok{\textless{}{-}} \FunctionTok{subset}\NormalTok{(broward, race }\SpecialCharTok{==} \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

We can first check overall accuracy

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(black}\SpecialCharTok{$}\NormalTok{cvpredictions }\SpecialCharTok{==}\NormalTok{ black}\SpecialCharTok{$}\NormalTok{two\_year\_recid)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0.6696429
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(white}\SpecialCharTok{$}\NormalTok{cvpredictions }\SpecialCharTok{==}\NormalTok{ white}\SpecialCharTok{$}\NormalTok{two\_year\_recid)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0.6805216
\end{verbatim}

But are we making the same types of errors?

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# False positive rate{-} Black}
\DocumentationTok{\#\# Out of those who do not recidivate, how often did we predict recidivate?}
\NormalTok{fprate.black }\OtherTok{\textless{}{-}} \FunctionTok{sum}\NormalTok{(black}\SpecialCharTok{$}\NormalTok{cvpredictions }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ black}\SpecialCharTok{$}\NormalTok{two\_year\_recid }\SpecialCharTok{==} \DecValTok{0}\NormalTok{) }\SpecialCharTok{/} 
  \FunctionTok{sum}\NormalTok{(black}\SpecialCharTok{$}\NormalTok{two\_year\_recid }\SpecialCharTok{==} \DecValTok{0}\NormalTok{)}

\DocumentationTok{\#\# False negative rate{-} Black}
\DocumentationTok{\#\# Out of those who recidivate, how often does it predict not recidivate?}
\NormalTok{fnrate.black }\OtherTok{\textless{}{-}}\FunctionTok{sum}\NormalTok{(black}\SpecialCharTok{$}\NormalTok{cvpredictions}\SpecialCharTok{==} \DecValTok{0} \SpecialCharTok{\&}\NormalTok{ black}\SpecialCharTok{$}\NormalTok{two\_year\_recid }\SpecialCharTok{==} \DecValTok{1}\NormalTok{) }\SpecialCharTok{/} 
  \FunctionTok{sum}\NormalTok{(black}\SpecialCharTok{$}\NormalTok{two\_year\_recid }\SpecialCharTok{==} \DecValTok{1}\NormalTok{)}

\DocumentationTok{\#\# False positive rate{-} white}
\NormalTok{fprate.white }\OtherTok{\textless{}{-}} \FunctionTok{sum}\NormalTok{(white}\SpecialCharTok{$}\NormalTok{cvpredictions }\SpecialCharTok{==} \DecValTok{1} \SpecialCharTok{\&}\NormalTok{ white}\SpecialCharTok{$}\NormalTok{two\_year\_recid }\SpecialCharTok{==} \DecValTok{0}\NormalTok{) }\SpecialCharTok{/} 
  \FunctionTok{sum}\NormalTok{(white}\SpecialCharTok{$}\NormalTok{two\_year\_recid }\SpecialCharTok{==} \DecValTok{0}\NormalTok{)}

\DocumentationTok{\#\# False negative rate{-} white}
\NormalTok{fnrate.white }\OtherTok{\textless{}{-}}\FunctionTok{sum}\NormalTok{(white}\SpecialCharTok{$}\NormalTok{cvpredictions}\SpecialCharTok{==} \DecValTok{0} \SpecialCharTok{\&}\NormalTok{ white}\SpecialCharTok{$}\NormalTok{two\_year\_recid }\SpecialCharTok{==} \DecValTok{1}\NormalTok{) }\SpecialCharTok{/} 
  \FunctionTok{sum}\NormalTok{(white}\SpecialCharTok{$}\NormalTok{two\_year\_recid }\SpecialCharTok{==} \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Let's see how our predictions perform across racial groups

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# False positive rates}
\NormalTok{fprate.black}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0.2846797
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fprate.white }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0.1323925
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# False negative rates}
\NormalTok{fnrate.black}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0.3734876
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fnrate.white }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0.6076605
\end{verbatim}

We see asymmetries in the types of errors the model is making across
racial groups. Black subjects have higher false positives-- more likely
as being predicted to recidivate (a predicted ``positive'') when they do
not (the ``false'' in false positive). White subjects have higher false
negatives-- predicted not to recidivate (the negative) when they do (the
false in false negative).

Based on these results, reflect on the following:

\begin{itemize}
\tightlist
\item
  Should we use this type of algorithm in public policy?

  \begin{itemize}
  \tightlist
  \item
    What might be desirable about this process over alternatives?
  \item
    What are possible concerns?
  \item
    Does your answer depend on accuracy or other considerations?
  \end{itemize}
\item
  What should we care more about? False positives or false negatives?
\item
  What measures of fairness should be considered?
\item
  Are there ways to avoid an unfair/biased model?
\end{itemize}

\hypertarget{extended-learning}{%
\subsection{Extended Learning}\label{extended-learning}}

Note: There are many debates about the use of these algorithms

\begin{itemize}
\tightlist
\item
  Example of Initial Critique from
  \href{https://www.propublica.org/article/machine-bias-risk-assessments-in-criminal-sentencing}{ProPublica}
\item
  Example of
  \href{https://www.uscourts.gov/federal-probation-journal/2016/09/false-positives-false-negatives-and-false-analyses-rejoinder}{Rejoinder}
\item
  Discussion of what fairness means: J. Kleinberg, S. Mullainathan, M.
  Raghavan, \href{https://arxiv.org/abs/1609.05807v2}{Inherent
  trade-offs in the fair determination of risk scores.} (2016).

  \begin{itemize}
  \tightlist
  \item
    Notes that goals of fairness can be in competition:
  \item
    Well-calibrated: if the algorithm identifies a set of people as
    having a probability z of constituting positive instances, then
    approximately a z fraction of this set should indeed be positive
    instances
  \item
    Balance for positive and negative instances across groups: the
    chance of making a mistake on should not depend on which group they
    belong to.
  \end{itemize}
\end{itemize}

For more on fairness and machine learning

\begin{itemize}
\tightlist
\item
  FAIRNESS AND MACHINE LEARNING:
  \href{https://fairmlbook.org/}{Limitations and Opportunities by Solon
  Barocas, Moritz Hardt, Arvind Narayanan}.
\item
  Vivek Singh's \href{http://behavioralinformatics.org/}{Research Lab}
\item
  Rutgers
  \href{https://sites.rutgers.edu/critical-ai/event-details/}{Critical
  AI group}
\item
  See the ``Gender Shades'' project from
  \href{https://www.youtube.com/watch?v=TWWsW1w-BVo}{Joy Buolamwini}
\item
  See Brookings Report on
  \href{https://www.brookings.edu/research/algorithmic-bias-detection-and-mitigation-best-practices-and-policies-to-reduce-consumer-harms/}{Bias
  in AI}
\end{itemize}

\bookmarksetup{startatroot}

\hypertarget{uncertainty}{%
\chapter{Uncertainty}\label{uncertainty}}

In this section, we bring in some statistical concepts of uncertainty in
data analysis.

Throughout the course, we have come up with estimates:

\begin{itemize}
\item
  Are perceived black job applicants less likely to receive call backs
  for interviews than applicants perceived as white?
\item
  Are job applicants with criminal records less likely to receive call
  backs for interviews than applicants without criminal records?
\item
  Are higher levels of education associated with lower levels of
  tolerance toward domestic violence?

  \item

  Do wind turbines cause backlash in voting behavior?
\end{itemize}

Each time, we come up with a positive or negative number to summarize
the effect. But when should we consider it a reliable effect or big
effect? By what criteria? That's where we are going now.

\hypertarget{hypothesis-testing-overview-of-process}{%
\section{Hypothesis Testing Overview of
Process}\label{hypothesis-testing-overview-of-process}}

Process for Hypothesis Testing

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Start with a research question: Are job applicants with criminal
  records less likely to receive call backs for interviews than
  applicants without criminal records?
\item
  Develop a theory of how the world works

  \begin{itemize}
  \tightlist
  \item
    E.g., ``Job prospects are, in part, a function of someone's criminal
    record.''
  \end{itemize}
\item
  Construct ``null'' and ``alternative'' hypotheses

  \begin{itemize}
  \tightlist
  \item
    E.g., \(H_o\): ``Applicants with a criminal record will receive call
    backs at similar rates as those without a criminal record'' (I.e.,
    no difference)
  \item
    E.g., \(H_A\): ``Applicants with a criminal record will be less
    likely to receive call backs than those without a criminal record''
    or ``Applicants with a criminal record will receive call backs at
    different rates than those without a criminal record'' (I.e., some
    nonzero difference)
  \end{itemize}
\end{enumerate}

\textbf{\emph{Example of Implied Framework}}

Health Savings Experiment (Dupas and Robinson 2013): Researchers
conducted a field experiment in rural Kenya in which they randomly
varied access to four innovative saving technologies and observed the
impact on asset accumulation. Participants who were given a box locked
with a padlock and key saved about 150 Kenyan Shillings more after 12
months relative to those who were simply encouraged to save money for
health. Did the lock box work?

\begin{itemize}
\tightlist
\item
  What are the implied null and alternative hypotheses?
\end{itemize}

Process for Hypothesis Testing

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  Carry out a test of the hypothesis, such as a difference-in-means.

  \begin{itemize}
  \tightlist
  \item
    Applicants with a criminal record receive 12.5 percentage points
    fewer call backs than those without a criminal record
  \end{itemize}
\item
  Calculate the uncertainty around this estimate.
\item
  Decide whether you can reject or fail to reject the hypothesis of no
  difference
\end{enumerate}

\hypertarget{sampling-and-uncertainty}{%
\section{Sampling and Uncertainty}\label{sampling-and-uncertainty}}

Flip a coin 10 times \href{https://flipsimu.com/}{here}. Report how many
times it lands on heads.

\begin{itemize}
\tightlist
\item
  Imagine repeating this process over and over again.
\item
  We know that a fair coin should land on heads 50\% of the time- 5 out
  of 10 times or 50 out of 100 times.
\item
  However, in any given sample of coin flips, you might get a slightly
  different result. If you repeated the sample a bunch of times,
  sometimes you might get 4 heads, 5 heads, 6 heads, 3 heads, etc.
\end{itemize}

This does not mean the coin is unfair. Instead, just due to chance, we
ended up with 6 out of 10 heads in a world where the true proportion of
times that coin would land on heads is .5.

How much evidence would we need to reject the idea that the coin is
unfair? What if we got 90 heads out of 100 coin flips? Would that be
enough to make us skeptical of the coin?

\begin{itemize}
\tightlist
\item
  This is the idea of null hypothesis testing. We gather evidence and
  make a judgment about whether we can reject a null hypothesis. How
  likely would it be that by chance we could flip 90 heads in a world
  where that coin was actually fair?

  \begin{itemize}
  \tightlist
  \item
    For example, when we find a relationship between two variables
    (e.g., a correlation, a difference-in-means, a regression
    coefficient), this could be due to chance in a single sample.
  \end{itemize}
\end{itemize}

When we conduct an experiment and find that applicants with a criminal
record were called back 12.5 percentage points less often than those
without a criminal record, we want to know\ldots{}

\begin{itemize}
\tightlist
\item
  Is that a real difference, or is the real difference 0, and we just
  happened to get our 12.5-point difference in our sample due to chance?
\end{itemize}

In statistical hypothesis testing, what we will try to do is quantify
how likely it is that we could observe a difference as big as 12.5 in a
given sample if, in fact, the real difference is 0. We want to be able
to make a judgment about how likely the relationship we observed in a
sample of applications/hiring decisions could exist in a world where
criminal records really have no impact on job prospects.

We are going to use this example help us break down a few concepts.

\hypertarget{sampling-distribution}{%
\subsection{Sampling Distribution}\label{sampling-distribution}}

The number of heads you generate over repeated samples is the ``sampling
distribution.''

\includegraphics{10-Uncertainty_files/figure-pdf/unnamed-chunk-1-1.pdf}

The higher the curve, the more likely we would observe that number of
heads. For example, if you flip a coin 100 times, it is likely you will
get close to 50 heads (50\%), and very unlikely you will flip more than
80 heads (80\% heads).

\begin{itemize}
\tightlist
\item
  So if you flip a coin and get 55 heads, we might still think the coin
  is fair, but once you start moving to the tails of this curve . . .
\item
  It is highly unlikely we could flip a coin 100 times and get 80 heads
  just by random chance i.e., if the coin were fair.
\item
  The ``bell'' shape of this distribution isn't an anomaly. The
  ``Central Limit Theorem'' tells us that over repeated samples (so long
  as your sample is sufficiently large), the distribution of ``means''
  will be normal

  \begin{itemize}
  \tightlist
  \item
    This is incredibly important because we know a lot about normal
    distributions, such as that 95\% of the sample mean estimates fall
    within two (technically: 1.96) standard errors of the mean.
  \item
    Only if we observe a number of heads outside those lines would we
    think perhaps it is not a fair coin.
  \end{itemize}
\end{itemize}

Let's now imagine our study on criminal records and job prospects.
\textbf{\emph{In a world where the true difference in call back rates
between those with and without criminal records is 0}}, in any given
sample, we might end up with a 3 percentage point difference, -5
percentage point difference, 2 point difference, -1 point difference,
and so on.

\begin{itemize}
\tightlist
\item
  The shape of the bell curve would be centered on 0 difference (Central
  Limit Theorem), meaning on average, over repeated samples of
  applicants/hiring decisions, there would be 0 difference, but
  occasionally we would still find some differences across samples.
\item
  What we want to know is if a 12.5 point difference is within two
  standard errors of 0 or if it is pretty unusual. (Is it more like 55
  heads or 80 heads?)
\end{itemize}

\hypertarget{details-standard-errors}{%
\subsubsection{Details: Standard Errors}\label{details-standard-errors}}

A standard error is the standard deviation of the sampling distribution

\begin{itemize}
\tightlist
\item
  Where a standard deviation is the typical distance between a given
  observation and the mean.
\item
  Compare the two photos below showing 0 standard deviation vs.~a large
  standard deviation
\end{itemize}

\includegraphics[width=0.4\textwidth,height=\textheight]{images/spread1.png}
\includegraphics[width=0.42\textwidth,height=\textheight]{images/spread2.jpg}

\emph{From the Cartoon Guide to Statistics}

In real life studies, we don't know the actual sampling distribution
because we only have 1 sample (we only had one study of
applications/hiring decisions).

So we estimate our standard error using the standard deviation of our
sample (\(S\)) and sample size (\(N\)).

\({\hat {SE}} = \frac{S}{\sqrt{N}}\)

The bigger the sample, the SMALLER the standard error (which is good)
because it means less uncertainty.

\hypertarget{z-scores-and-p-values}{%
\section{Z-scores and p-values}\label{z-scores-and-p-values}}

Recall the Overview of Hypothesis Testing. Now, we are going to add
details to help us make a final decision about the null hypothesis.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  Carry out a test of the hypothesis, such as a difference-in-means.

  \begin{itemize}
  \tightlist
  \item
    Applicants with a criminal record receive 12.5 percentage points
    fewer call backs than those without a criminal record
  \end{itemize}
\item
  Calculate the uncertainty around this estimate.

  \begin{itemize}
  \tightlist
  \item
    We will estimate the standard error of the estimate using the sample
    size and sample spread (standard deviation)
  \item
    We can also estimate the confidence intervals
  \end{itemize}
\item
  Decide whether you can reject or fail to reject the hypothesis of no
  difference

  \begin{itemize}
  \tightlist
  \item
    Standarize the estimate and find the z-score (or t-statistic, which
    is similar)

    \begin{itemize}
    \tightlist
    \item
      The z score is an example of a ``test statistic.'' The type of
      statistic might vary across applications, but its purpose will
      remain similar. Others include t-statistics and Chi-squared
      statistics.
    \end{itemize}
  \item
    How likely is it you would observe the z-score you found under this
    null distribution? (p-value)
  \item
    If the p-value is small (\(< 0.05\)), reject the null.
  \end{itemize}
\end{enumerate}

A z-score helps us standardize the size of estimates across any units of
study by quantifying the size of the estimate in terms of standard
errors.

z-score =
\(\frac{\text{Estimate - Null}}{\hat{SE}} = \frac{\text{Estimate - 0}}{\hat{SE}}\)

The z-score represents a ratio of the estimate over the standard errors.
We can visualize the distribution of z-scores in the image below.

\includegraphics{images/zscore.png}

The bell curve is centered on 0 and represents our null distribution.

\begin{itemize}
\tightlist
\item
  Instead of the axis being the number of heads out of 100 coin flips,
  centered on the null hypothesis of 50 heads for a fair coin, the
  standardized scale is centered on 0. We can then visualize how far 80
  coin flips is away from 50 in terms of standard errors.
\end{itemize}

Recall, we asked: When we conduct an experiment and find that applicants
with a criminal record were called back 12.5 percentage points less
often than those without a criminal record, we want to know\ldots{}

\begin{itemize}
\tightlist
\item
  Is that a real difference, or is the real difference 0, and we just
  happened to get our 12.5-point difference in our sample due to random
  chance?
\end{itemize}

It so happens that our 12.5 percentage difference represents more than
z=7.

We can visualize where z=7 is in our distribution below with the dashed
purple line:

\includegraphics{images/zscore2.png}

It is well outside of the red lines representing 1.96 standard errors.

Interpretation: It is really unlikely we would have observed this
extreme in magnitude of difference if the true difference were 0.

\begin{itemize}
\tightlist
\item
  This likelihood represents the p-value, which is essentially 0 in this
  case. There is essentially 0 chance we would have observed a
  difference as large or larger than 12.5 (or -12.5) in a world where
  the true difference is 0.
\item
  If a p-value is \textless{} 0.05, we reject the null hypothesis.
\item
  If instead, the p-value is larger than 0.05, we fail to reject the
  null. That would mean that we think it is reasonably possible to have
  observed a difference as big as 12.5 if in fact the true difference is
  0.
\end{itemize}

We are going to focus on two-sided p-values, which focus on the
magnitude of the z-score in either direction, instead of whether it is a
positive or negative p-value. In other classes, you may also cover
one-sided p-values.

\hypertarget{relationship-to-confidence-intervals}{%
\subsection{Relationship to Confidence
Intervals}\label{relationship-to-confidence-intervals}}

Relationship to Confidence Intervals: Our 12.5 percentage difference has
a 95\% confidence interval of 6.8 to 18.3

\begin{itemize}
\tightlist
\item
  It is constructed by taking \(12.5 - 1.96*SE\) and \(12.5 + 1.96*SE\)
\item
  This means there is a 95\% chance that this interval contains the true
  population difference.
\end{itemize}

It gives us another way of describing our estimate that includes our
uncertainty. We recognize that over repeated samples, we are not always
going to get a 12.5 point difference. In any given sample, this estimate
will differ a bit over the ``sampling distribution.''

\hypertarget{wrapping-up-the-process}{%
\section{Wrapping up the Process}\label{wrapping-up-the-process}}

Let's Review the Process

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Start with a research question: Are job applicants with criminal
  records less likely to receive call backs for interviews than
  applicants without criminal records?
\item
  Develop a theory of how the world works

  \begin{itemize}
  \tightlist
  \item
    E.g., ``Job prospects are, in part, a function of someone's criminal
    record.''
  \end{itemize}
\item
  Construct ``null'' and ``alternative'' hypotheses

  \begin{itemize}
  \tightlist
  \item
    E.g., \(H_o\): ``Applicants with a criminal record will receive call
    backs at similar rates as those without a criminal record'' (I.e.,
    no difference)
  \item
    E.g., \(H_A\): ``Applicants with a criminal record will be less
    likely to receive call backs than those without a criminal record''
    or ``Applicants with a criminal record will receive call backs at
    different rates than those without a criminal record'' (I.e., some
    nonzero difference)
  \end{itemize}
\item
  Carry out a test of the hypothesis, such as a difference-in-means.

  \begin{itemize}
  \tightlist
  \item
    Applicants with a criminal record receive 12.5 percentage points
    fewer call backs than those without a criminal record
  \end{itemize}
\item
  Calculate the uncertainty around this estimate.

  \begin{itemize}
  \tightlist
  \item
    We could estimate the standard error with the sample standard
    deviation and sample size
  \item
    We could also estimate the confidence intervals.
  \end{itemize}
\item
  Decide whether the result is significant. Can you reject or do you
  fail to reject the hypothesis of no difference?

  \begin{itemize}
  \tightlist
  \item
    Use the z-score/t-statistic and p-value
  \item
    The z score is an example of a ``test statistic.'' The type of
    statistic might vary across applications, but its purpose will
    remain similar. Others include t-statistics and Chi-squared
    statistics.
  \end{itemize}
\end{enumerate}

\hypertarget{application-health-savings-study}{%
\section{Application: Health Savings
Study}\label{application-health-savings-study}}

\emph{For a video explainer of the code in this section, see below. (Via
youtube, you can speed up the playback to 1.5 or 2x speed.)}

\url{https://www.youtube.com/watch?v=kJlonC8AI6w}

Health Savings Experiment (Dupas and Robinson 2013): Field experiment in
rural Kenya in which they randomly varied access to four innovative
saving technologies and observed the impact on asset accumulation.

\textbf{\emph{1. Start with a research question}}

Can savings technologies help people accumulate assets?

\textbf{\emph{2. Develop a theory of how the world works}}

Providing people with a safe place to store money will help them save.

\textbf{\emph{3. Construct ``null'' and ``alternative'' hypotheses}}

What are our null/alternative hypotheses?

\textbf{\emph{4. Carry out a test of the hypothesis, such as a
difference-in-means.}}

\begin{itemize}
\tightlist
\item
  Individuals in all study arms were encouraged to save for health and
  were asked to set a health goal for themselves at the beginning of the
  study.\\
\item
  In the first treatment group (Safe Box), respondents were given a box
  locked with a padlock and the key
\item
  The dependent variable is the amount saved after 12 months
  \texttt{fol2\_amtinvest}
\end{itemize}

We will compare average savings between treatment conditions (a
difference in means).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{rosca }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"https://raw.githubusercontent.com/ktmccabe/teachingdata/main/rosca.csv"}\NormalTok{,}
                  \AttributeTok{stringsAsFactors =}\NormalTok{ T)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Compare means}
\NormalTok{mean.safebox }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(rosca}\SpecialCharTok{$}\NormalTok{fol2\_amtinvest[rosca}\SpecialCharTok{$}\NormalTok{safe\_box }\SpecialCharTok{==} \DecValTok{1}\NormalTok{], }\AttributeTok{na.rm=}\NormalTok{T)}
\NormalTok{mean.encouragement }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(rosca}\SpecialCharTok{$}\NormalTok{fol2\_amtinvest[rosca}\SpecialCharTok{$}\NormalTok{encouragement}\SpecialCharTok{==} \DecValTok{1}\NormalTok{], }
                           \AttributeTok{na.rm=}\NormalTok{T)}
\NormalTok{diff.means }\OtherTok{\textless{}{-}}\NormalTok{ mean.safebox }\SpecialCharTok{{-}}\NormalTok{ mean.encouragement}
\NormalTok{diff.means}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 150.3816
\end{verbatim}

\textbf{\emph{5. Calculate the uncertainty around this estimate.}}

To get uncertainty when calculating a difference in means, we can use
the \texttt{t.test} function in R.

\begin{itemize}
\tightlist
\item
  The first input is the vector of values from one group.
\item
  The second input is the vector of values from the other group.
\end{itemize}

To get the t-statistic, underneath the hood of the function, R is
estimating the standard error by calculating the standard deviation in
the sample and the sample size (the number of people in each condition).

\begin{Shaded}
\begin{Highlighting}[]
\DocumentationTok{\#\# Compare amount saved for those in Safe Box vs. }
\DocumentationTok{\#\# Encouragement Only conditions}
\NormalTok{test }\OtherTok{\textless{}{-}} \FunctionTok{t.test}\NormalTok{(rosca}\SpecialCharTok{$}\NormalTok{fol2\_amtinvest[rosca}\SpecialCharTok{$}\NormalTok{safe\_box }\SpecialCharTok{==} \DecValTok{1}\NormalTok{],}
\NormalTok{               rosca}\SpecialCharTok{$}\NormalTok{fol2\_amtinvest[rosca}\SpecialCharTok{$}\NormalTok{encouragement}\SpecialCharTok{==} \DecValTok{1}\NormalTok{])}

\NormalTok{test}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}

    Welch Two Sample t-test

data:  rosca$fol2_amtinvest[rosca$safe_box == 1] and rosca$fol2_amtinvest[rosca$encouragement == 1]
t = 2.1083, df = 150.38, p-value = 0.03666
alternative hypothesis: true difference in means is not equal to 0
95 percent confidence interval:
   9.445604 291.317636
sample estimates:
mean of x mean of y 
 408.2150  257.8333 
\end{verbatim}

\textbf{\emph{6. Decide whether you can reject or fail to reject the
hypothesis of no difference}}

We can extract the group means, the p-value of the difference and
confidence interval of the difference.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{test}\SpecialCharTok{$}\NormalTok{estimate}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
mean of x mean of y 
 408.2150  257.8333 
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{test}\SpecialCharTok{$}\NormalTok{conf.int}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1]   9.445604 291.317636
attr(,"conf.level")
[1] 0.95
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{test}\SpecialCharTok{$}\NormalTok{p.value}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0.03666403
\end{verbatim}

Was the treatment significant? We say something is significant if the
p-value is small, such as less than 0.05. We also use this criteria to
assess if we should reject the null hypothesis.

\begin{itemize}
\tightlist
\item
  In a ``t test'', the t-statistic serves as the z-score. It is also a
  ratio of standard errors. The t-statistic and z-scores differ slightly
  in how we calculate the corresponding p-value, but with a large enough
  sample size, these are also very similar. The \texttt{t.test} function
  in R calculates the p-value for you.
\end{itemize}

\hypertarget{additional-applications}{%
\section{Additional Applications}\label{additional-applications}}

We will carry out the same type of hypothesis testing process for a
range of different scenarios. Though the process will remain very
similar, the underlying statistical test/calculation/R function will
change.

\begin{itemize}
\tightlist
\item
  If dependent variable is numeric / continuous, can use regression and
  \texttt{lm()} (type of independent variable does not matter)
\item
  If dependent variable is numeric and want to compare between two
  specific groups, can use \texttt{t.test()}
\item
  If dependent variable is binary, such as assessing the proportion of
  call back rates, and want to compare between two specific groups, can
  use \texttt{prop.test()}
\end{itemize}

Other tests exist for different situations

\hypertarget{example-using-regression}{%
\subsection{Example Using Regression}\label{example-using-regression}}

\textbf{\emph{1. Start with a research question}}

Do past election results help explain future election results?

\textbf{\emph{2. Develop a theory of how the world works}}

A third-party candidate's performance in one election will help us
predict the success of a future third-party candidate.

\textbf{\emph{3. Construct ``null'' and ``alternative'' hypotheses and
4. Carry out a test of the hypothesis, such as a regression.}}

In a regression, our key hypothesis test is about whether there is a
significant, non-zero relationship between an independent variable and
the outcome.

\begin{itemize}
\tightlist
\item
  The null hypothesis is that \(\beta = 0\). The alternative is that
  \(\beta \neq 0\).
\end{itemize}

Going back to our Florida example: The null hypothesis would be the 1996
Perot vote does not help us explain the Buchanan 2000 vote (that
\(\beta = 0\)). Our alternative is \(\beta \neq 0\), that there is some
relationship between 1996 Perot votes and the 2000 Buchanan vote in
Florida counties.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{florida }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"https://raw.githubusercontent.com/ktmccabe/teachingdata/main/florida.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

We estimate \(\hat \beta\): for every 1 additional vote Perot received
in 1996, we expect Buchanan to receive .036 additional votes in 2000.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fit }\OtherTok{\textless{}{-}} \FunctionTok{lm}\NormalTok{(Buchanan00 }\SpecialCharTok{\textasciitilde{}}\NormalTok{ Perot96, }\AttributeTok{data =}\NormalTok{ florida)}
\FunctionTok{coef}\NormalTok{(fit)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
(Intercept)     Perot96 
 1.34575212  0.03591504 
\end{verbatim}

Is that relationship significant? In other words, is it helpful to know
the Perot 1996 vote to help explain the Buchanan 2000 vote? Or should we
treat the 0.036 number as essentially 0, just noise?

Recall that the \(\hat \beta\) represents the estimated slope of the
relationship.

\includegraphics{10-Uncertainty_files/figure-pdf/unnamed-chunk-8-1.pdf}

We ask: Is that relationship (the slope) significant (i.e.,
statistically different from 0 slope)?

\textbf{\emph{5. Calculate the uncertainty around this estimate.}}

Our regression \texttt{lm} function will also generate estimates of
uncertainty related to hypothesis testing

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{round}\NormalTok{(}\FunctionTok{summary}\NormalTok{(fit)}\SpecialCharTok{$}\NormalTok{coefficients, }\AttributeTok{digits=}\DecValTok{4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
            Estimate Std. Error t value Pr(>|t|)
(Intercept)   1.3458    49.7593  0.0270   0.9785
Perot96       0.0359     0.0043  8.2752   0.0000
\end{verbatim}

\textbf{\emph{6. Decide whether you can reject or fail to reject the
hypothesis of no difference}}

We see the p-value for Perot96 is essentially 0-- well less than 0.05.
Therefore, it is highly unlikely we would observe a slope as big or
bigger (in magnitude) as 0.0359 if Perot96 and Buchanan00 were actually
unrelated.

\begin{itemize}
\tightlist
\item
  We consider the effect ``statistically significant.''
\item
  We reject a null hypothesis that the Perot 1996 vote is unrelated to
  the Buchanan 2000 vote.
\end{itemize}

In social science papers, regressions are often presented in tables:

\begin{verbatim}

=======================
             Model 1   
-----------------------
(Intercept)    1.35    
             (49.76)   
Perot96        0.04 ***
              (0.00)   
-----------------------
R^2            0.51    
Adj. R^2       0.51    
Num. obs.     67       
=======================
*** p < 0.001; ** p < 0.01; * p < 0.05
\end{verbatim}

\hypertarget{example-using-prop.test}{%
\subsection{Example Using prop.test()}\label{example-using-prop.test}}

Sometimes our outcomes are 0 vs.~1 variables, which become proportions
when we take the mean()

\begin{itemize}
\tightlist
\item
  For example, applicants who get a call back vs.~do not
\item
  For example, voters who turn out to vote vs.~do not
\end{itemize}

When you have this type of outcome variable, you may want to use a test
designed specifically for testing the differences in proportions of two
groups.

Experimental Example: Going Back to Resume and Race study

\textbf{\emph{1. Start with a research question}}

Does race influence hiring decisions?

\textbf{\emph{2. Develop a theory of how the world works}}

Theory: Black applicants face discrimination in hiring.

\textbf{\emph{3. Construct ``null'' and ``alternative'' hypotheses}}

We can conduct a two-sided hypothesis test

\begin{itemize}
\tightlist
\item
  \(H_o\): No difference in call back rates for Black and white
  applicants
\item
  \(H_a\): Some difference in call back rates for Black and white
  applicants
\end{itemize}

The two-sided means we aren't specifying a direction of our alternative
hypothesis. Instead, we are conducting test just trying to reject the
idea of no difference between racial groups. Sometimes researchers may
specify the alternative hypothesis in a directional way, such as Black
applicants will have a lower call back rate than white applicants.
However, it is more common to use a two-sided test, even if researchers
have a theoretical hypothesis in a particular direction.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resume }\OtherTok{\textless{}{-}} \FunctionTok{read.csv}\NormalTok{(}\StringTok{"https://raw.githubusercontent.com/ktmccabe/teachingdata/main/resume.csv"}\NormalTok{)}

\FunctionTok{head}\NormalTok{(resume)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
  firstname    sex  race call
1   Allison female white    0
2   Kristen female white    0
3   Lakisha female black    0
4   Latonya female black    0
5    Carrie female white    0
6       Jay   male white    0
\end{verbatim}

\textbf{\emph{4. Carry out a test of the hypothesis, such as a test of
proportions.}}

Does being black (vs.~white) decrease call backs?

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{table}\NormalTok{(resume}\SpecialCharTok{$}\NormalTok{race, resume}\SpecialCharTok{$}\NormalTok{call)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
       
           0    1
  black 2278  157
  white 2200  235
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{test }\OtherTok{\textless{}{-}} \FunctionTok{prop.test}\NormalTok{(}\AttributeTok{x=}\FunctionTok{c}\NormalTok{(}\DecValTok{157}\NormalTok{, }\DecValTok{235}\NormalTok{), }\AttributeTok{n=}\FunctionTok{c}\NormalTok{(}\DecValTok{157}\SpecialCharTok{+}\DecValTok{2278}\NormalTok{, }\DecValTok{235}\SpecialCharTok{+}\DecValTok{2200}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  The \texttt{prop.test()} function includes 4 inputs
\item
  The number of 1's from the first group, the number of 1's in the
  second group \texttt{c(n1,\ n2)}
\item
  The total observations from the first group, the total observations in
  the second group \texttt{c(total1,\ total2)}
\end{itemize}

\textbf{\emph{5. Calculate the uncertainty around this estimate.}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{test}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}

    2-sample test for equality of proportions with continuity correction

data:  c(157, 235) out of c(157 + 2278, 235 + 2200)
X-squared = 16.449, df = 1, p-value = 4.998e-05
alternative hypothesis: two.sided
95 percent confidence interval:
 -0.04769866 -0.01636705
sample estimates:
    prop 1     prop 2 
0.06447639 0.09650924 
\end{verbatim}

You can extract the p.value for the difference in proportions and
confidence interval

\textbf{\emph{6. Decide whether you can reject or fail to reject the
hypothesis of no difference}}

In the \texttt{prop.test} function, you see a X-squared statistic. You
can treat this like the z-score. When you are doing a test of two
groups, the X-squared is essentially the z-score squared. The X-squared
refers to a Chi-squared test. In our case, the equivalent z-score would
be about 4-- well more than our threshold of about 2.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{round}\NormalTok{(test}\SpecialCharTok{$}\NormalTok{p.value, }\AttributeTok{digits=}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
[1] 0
\end{verbatim}

What do you conclude about the hypothesis? Is it significant?

\hypertarget{in-class-exercise-questions}{%
\section{In-Class Exercise
Questions}\label{in-class-exercise-questions}}

Do negative ads increase voter turnout? In an experiment, suppose
researchers found that a negative political ad intending to make voters
angry toward the opposing candidate increased voter turnout by 5
percentage points relative to a control condition in which a
non-political ad was shown. The difference between treatment and control
had a p-value of 0.25, and the confidence interval was -1 to 11
percentage points.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  What are the implied null and alternative hypotheses?
\item
  What is the difference in voter turnout between the groups?
\item
  What do you conclude about the results? Is it significant? Do you
  reject or fail to reject the null hypothesis?
\item
  How do you interpret the p-value?
\end{enumerate}

If we imagine that we could conduct the negative advertising study over
and over again, estimating voter turnout each time. The set of estimates
of voter turnout across these hypothetical studies would be called the
(circle one):

\begin{enumerate}
\def\labelenumi{\Alph{enumi}.}
\tightlist
\item
  Standard error
\item
  Sampling distribution
\item
  Confidence Interval
\item
  Standard deviation
\end{enumerate}

Are natural resources like oil negatively related to how democratic a
country is? In a study, researchers looked at the correlation between
the amount of oil available to a country and how democratic the country
is according to expert ratings of democracy. The researchers ran a
regression analysis and found that for every one-unit increase in the
amount of oil a country has, the country has a b=.3 decrease in its
democracy rating. The standard error of the coefficient is se = 0.05.
The t-statistic is 6, with a p-value \textless{} 0.001.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  What are the implied null and alternative hypotheses?
\item
  What do you conclude about the results? Is it significant? Do you
  reject or fail to reject the null hypothesis?
\end{enumerate}



\end{document}
